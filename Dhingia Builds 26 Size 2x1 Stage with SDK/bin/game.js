"use strict";const getGlobalThis=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==this)return this;throw new Error("Unable to locate global `this`")},globalObject=getGlobalThis();var loader;!function(v){const S=1,A=2;let E=0;const R=[],O=[],M={baseUrl:""},B={};function c(v,A,R){let O=null,M={},W=null;"function"==typeof v?M=v:"string"==typeof v?(O=v,"function"==typeof A?M=A:A instanceof Array&&(W=A,M=R)):v instanceof Array&&(W=v,"function"==typeof A&&(M=A)),W=W||["require","exports","module"],null===O&&(O="unnamed-module-"+E++),O=g(O),W=(W||[]).map((v=>function(v,S){return v?b(S,v):S}(O,v))),B[O]||(B[O]={name:O,parent:null,dclamd:S,dependencies:W,handlers:[],exports:{},dependants:new Set}),B[O].dependencies=W,p(W,(function(v){const S=B[O];if(!S)throw new Error("Could not access registered module "+O);let A=S.exports;A="function"==typeof M?M.apply(globalObject,v)||A:M,S.exports=A,d(O)}),(v=>{if("function"!=typeof onerror)throw v;onerror(v)}),O)}function d(v){const S=B[v];if(!S)throw new Error("Could not access registered module "+v);S.dclamd=A;const E=S.handlers;if(E&&E.length)for(let S=0;S<E.length;S++)E[S](B[v])}function u(v,S,A){if(!B[v])return null;if(v===S||50===A)return[v];const E=B[v].dependencies;for(let R=0,O=E.length;R<O;R++){const O=u(E[R],S,A+1);if(null!==O)return O.push(v),O}return null}function a(v,S){const A=B[v];if(!A)return!1;const E={};for(const v in B)E[v]=!1;const R=[];for(R.push(A),E[v]=!0;R.length>0;){const v=R.shift().dependencies;if(v)for(let A=0,O=v.length;A<O;A++){const O=v[A];if(O===S)return!0;const M=B[O];M&&!E[O]&&(E[O]=!0,R.push(M))}}return!1}function p(v,A,E,R){const M=new Array(v.length).fill(null);let W=0,H=!1;if("string"==typeof v){if(B[v]){if(B[v].dclamd===S)throw new Error(`Trying to load ${v} from ${R}. The first module is still loading.`);return B[v]}throw new Error(v+" has not been defined. Please include it as a dependency in "+R+"'s define()")}const V=v.length;for(let S=0;S<V;S++)switch(v[S]){case"require":const h=function(v,S,A){return p(v,S,A,R)};h.toUrl=function(v){return b(v,R)},M[S]=h,W++;break;case"exports":if(!B[R])throw new Error("Parent module "+R+" not registered yet");M[S]=B[R].exports,W++;break;case"module":M[S]={id:R,uri:b(R)},W++;break;default:{const X=v[S],m=()=>{M[S]=B[X].exports,W++,W===V&&A&&(H=!0,A(M))};if(a(X,R)){const v=u(X,R,0);v&&(v.reverse(),v.push(X),O.push(v)),w(X,(()=>{}),E,R),m()}else w(X,m,E,R);break}}!H&&W===V&&A&&A(M)}function h(v,S){return function(){return dcl.callRpc(v,S.name,R.slice.call(arguments,0))}}function w(v,A,E,R){if(B[v])return B[v].dependants.add(R),void(B[v].dclamd===S?A&&B[v].handlers.push(A):A&&A(B[v]));if(B[v]={name:v,parent:R,dclamd:S,handlers:[A],dependencies:[],dependants:new Set([R]),exports:{}},0===v.indexOf("@")){const S=B[v].exports;if("function"!=typeof dcl.loadModule)throw new Error("Asynchronous modules will not work because loadModule function is not present");dcl.loadModule(v,S).then((A=>{for(const v in A.methods){const E=A.methods[v];S[E.name]=h(A.rpcHandle,E)}d(v)})).catch((v=>{E(v)}))}}function g(v){let S,A=v;for(S=/\/\.\//;S.test(A);)A=A.replace(S,"/");for(A=A.replace(/^\.\//g,""),S=/\/(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//;S.test(A);)A=A.replace(S,"/");return A=A.replace(/^(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//,""),A=A.replace(/^\//g,""),A}function b(v,S){switch(v){case"require":case"exports":case"module":return v}return S?function(v,S){let A=v;if(!A.startsWith("@")&&(A.startsWith("./")||A.startsWith("../"))){const v=S.split("/");v.pop(),A=g(v.join("/")+"/"+A)}return A}(v,S):g(v)}v.config=function(v){if("object"==typeof v)for(const S in v)v.hasOwnProperty(S)&&(M[S]=v[S])},v.define=c,function(v){v.amd={},v.modules=B}(c=v.define||(v.define={})),v.require=p,"undefined"!=typeof dcl&&dcl.onStart((()=>{const v=new Set,A=[];for(const E in B)B[E]&&(B[E].dclamd===S&&A.push(B[E]),B[E].dependencies.forEach((S=>{"require"!==S&&"exports"!==S&&"module"!==S&&(B[S]||v.add(S))})));const E=[];if(O.length&&E.push(`\n> Cyclic dependencies: ${O.map((v=>"\n  - "+v.join(" -> "))).join("")}`),v.size&&E.push(`\n> Undeclared/unknown modules: ${Array.from(v).map((v=>"\n  - "+v)).join("")}`),A.length&&E.push(`\n> These modules didn't load: ${A.map((v=>"\n  - "+v.name)).join("")}.\n`),E.length)throw new Error(E.join("\n"))})),p.toUrl=b}(loader||(loader={})),globalObject.define=loader.define,globalObject.dclamd=loader,function(v){var S=function(){function t(){}return t.AVATAR={getEntityRepresentation:function(v){return v.avatarEntity}},t.FIRST_PERSON_CAMERA={getEntityRepresentation:function(v){return v.firstPersonCameraEntity}},t}(),n=function(v,S){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,S){v.__proto__=S}||function(v,S){for(var A in S)Object.prototype.hasOwnProperty.call(S,A)&&(v[A]=S[A])},n(v,S)
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */};function i(v,S){if("function"!=typeof S&&null!==S)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function i(){this.constructor=v}n(v,S),v.prototype=null===S?Object.create(S):(i.prototype=S.prototype,new i)}var o=function(){return o=Object.assign||function(v){for(var S,A=1,E=arguments.length;A<E;A++)for(var R in S=arguments[A])Object.prototype.hasOwnProperty.call(S,R)&&(v[R]=S[R]);return v},o.apply(this,arguments)};function r(v,S,A,E){var R,O=arguments.length,M=O<3?S:null===E?E=Object.getOwnPropertyDescriptor(S,A):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)M=Reflect.decorate(v,S,A,E);else for(var B=v.length-1;B>=0;B--)(R=v[B])&&(M=(O<3?R(M):O>3?R(S,A,M):R(S,A))||M);return O>3&&M&&Object.defineProperty(S,A,M),M}function s(v,S){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(v,S)}function h(v){var S="function"==typeof Symbol&&Symbol.iterator,A=S&&v[S],E=0;if(A)return A.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(v,S){var A="function"==typeof Symbol&&v[Symbol.iterator];if(!A)return v;var E,R,O=A.call(v),M=[];try{for(;(void 0===S||S-- >0)&&!(E=O.next()).done;)M.push(E.value)}catch(v){R={error:v}}finally{try{E&&!E.done&&(A=O.return)&&A.call(O)}finally{if(R)throw R.error}}return M}function p(v,S){for(var A=0,E=S.length,R=v.length;A<E;A++,R++)v[R]=S[A];return v}var A=0;function u(){for(var v=[],S=0;S<arguments.length;S++)v[S]=arguments[S];"undefined"!=typeof dcl?dcl.log.apply(dcl,p([],l(v))):console.log.apply(console,p(["DEBUG:"],l(v)))}function y(v,S){"undefined"!=typeof dcl?dcl.error(v,S):console.error("ERROR:",v,S)}function f(v){if(A++,0===v.length)throw new Error("newId(type: string): type cannot be empty");return v+A.toString(36)}function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(v){var S=16*Math.random()|0;return("x"===v?S:3&S|8).toString(16)}))}var E=[];function _(v){if(!("__event_name__"in v)||"string"!=typeof v.__event_name__)throw new Error("The EventConstructor is not registered");return v.__event_name__}var R=function(){function t(){this.listeners={}}return t.prototype.addListener=function(v,S,A){if(!v||"function"!=typeof v)throw new Error("Invalid EventConstructor");var E=_(v),R=this.listeners[E];R||(R=this.listeners[E]=[]);for(var O=0;O<R.length;O++)if(R[O].listener===S)throw new Error("The provided listener is already registered");return R.push({listener:S,fn:A}),this},t.prototype.removeListener=function(v,S){if(!S||"function"!=typeof S)throw new Error("Invalid EventConstructor");var A=_(S),E=this.listeners[A];if(!E)return!1;for(var R=0;R<E.length;R++)if(E[R].listener===v)return E.splice(R,1),!0;return!1},t.prototype.fireEvent=function(v){var S=_(v.constructor),A=this.listeners[S];if(A)for(var E=0;E<A.length;E++)try{var R=A[E];R.fn.call(R.listener,v)}catch(v){y(v)}return this},t}();function x(){var v=f("EV");if(-1!==E.indexOf(v))throw new Error("The event name ".concat(v," is already taken"));return E.push(v),function(S){return S.__event_name__=v,S}}var O,M=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,S,A){this.entity=v,this.componentName=S,this.component=A})),B=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,S,A){this.entity=v,this.componentName=S,this.classId=A})),W=r([x(),s("design:paramtypes",[Object,Object])],(function(v,S){this.entity=v,this.parent=S}));v.UIValueType=void 0,(O=v.UIValueType||(v.UIValueType={}))[O.PERCENT=0]="PERCENT",O[O.PIXELS=1]="PIXELS";var H=function(){function e(S){if(this.type=v.UIValueType.PIXELS,"string"==typeof S){var A=S;A.indexOf("px")>-1?this.type=v.UIValueType.PIXELS:A.indexOf("%")>-1&&(this.type=v.UIValueType.PERCENT),this.value=parseFloat(A)}else this.value=S}return e.prototype.toString=function(){var S=this.value.toString();return this.type===v.UIValueType.PERCENT?S+="%":S+="px",S},e}(),V="__name__symbol_",X="__classId__symbol_",Q="__component__id_",Z=r([x(),s("design:paramtypes",[String,String,Number])],(function(v,S,A){this.componentId=v,this.componentName=S,this.classId=A})),K=r([x(),s("design:paramtypes",[String])],(function(v){this.componentId=v})),J=r([x(),s("design:paramtypes",[String,Object])],(function(v,S){this.componentId=v,this.component=S}));function P(v,S){return function(A){if(A.isComponent)throw new TypeError("You cannot extend a component. Trying to extend ".concat(A.originalClassName," with: ").concat(v));var E=A,o=function(){var A=Array.prototype.slice.call(arguments),R=new(E.bind.apply(E,p([void 0],l(A))));return Object.defineProperty(R,V,{enumerable:!1,writable:!1,configurable:!1,value:v}),void 0!==S&&Object.defineProperty(R,X,{enumerable:!1,writable:!1,configurable:!1,value:S}),R};return void 0!==S&&(o.__classId__symbol_=S),o.__name__symbol_=v,o.isComponent=!0,o.originalClassName=v,(o.prototype=A.prototype).constructor=A,o}}function N(v,S){return function(A){if(A.isComponent)throw new TypeError("You cannot extend a component. Trying to extend ".concat(A.originalClassName," with: ").concat(v));if("number"!=typeof S||isNaN(S))throw new Error("classId: ".concat(S," is an invalid integer"));var E=A,o=function(){if(!N.engine)throw new Error("You need to set a DisposableComponent.engine before creating disposable components");var A=Array.prototype.slice.call(arguments),R=new(E.bind.apply(E,p([void 0],l(A)))),O=f("C");return Object.defineProperty(R,V,{enumerable:!1,writable:!1,configurable:!1,value:v}),Object.defineProperty(R,Q,{enumerable:!1,writable:!1,configurable:!1,value:O}),void 0!==S&&Object.defineProperty(R,X,{enumerable:!1,writable:!1,configurable:!1,value:S}),N.engine&&N.engine.registerComponent(R),R};return void 0!==S&&(o.__classId__symbol_=S),o.__name__symbol_=v,o.isComponent=!0,o.isDisposableComponent=!0,o.originalClassName=v,(o.prototype=A.prototype).constructor=A,o}}function F(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__name__symbol_)return v.__name__symbol_;throw new TypeError(v+" is not a registered component.")}function L(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__classId__symbol_)return v.__classId__symbol_;if(!v.__name__symbol_)throw new TypeError(v+" is not a registered component.");return null}function D(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__component__id_)return v.__component__id_;throw new TypeError(v+" is not a registered disposable component.")}!function(v){v.engine=null}(N||(N={}));var $=function(){function t(){this.dirty=!1,this.data={},this.subscriptions=[]}return t.component=function(v,S){if(delete v[S]){var A=S+"_"+Math.random();v[A]=void 0,Object.defineProperty(v,A,o(o({},Object.getOwnPropertyDescriptor(v,A)),{enumerable:!1})),Object.defineProperty(v,S.toString(),{get:function(){return this[A]},set:function(v){var E=this[A];if(this.data[S]=v?D(v):null,this[A]=v,v!==E){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](S,v,E)}},enumerable:!0})}},t.field=function(v,S){delete v[S]&&Object.defineProperty(v,S.toString(),{get:function(){return this.data[S]},set:function(v){var A=this.data[S];if(this.data[S]=v,v!==A){this.dirty=!0;for(var E=0;E<this.subscriptions.length;E++)this.subscriptions[E](S,v,A)}},enumerable:!0})},t.uiValue=function(v,S){delete v[S]&&Object.defineProperty(v,S.toString(),{get:function(){return this.data[S].toString()},set:function(v){var A=this.data[S],E=new H(v);if(this.data[S]=E,E!==A){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](S,E,A)}},enumerable:!0})},t.readonly=function(v,S){delete v[S]&&Object.defineProperty(v,S.toString(),{get:function(){if(S in this.data==0)throw new Error("The field ".concat(S," is uninitialized"));return this.data[S]},set:function(v){if(S in this.data)throw new Error("The field ".concat(S," is readonly"));this.data[S]=v,this.dirty=!0},enumerable:!0,configurable:!1})},t.prototype.onChange=function(v){return this.subscriptions.push(v),this},t.prototype.toJSON=function(){return this.data},t}();function U(v){return Q in v}var et=function(){function t(){for(var v=[],S=0;S<arguments.length;S++)v[S]=arguments[S];if(this.entities=[],this.active=!1,this._requiresNames=[],!v)throw new Error("ComponentGroup: Could not load the requires list");if(!(v instanceof Array))throw new Error("ComponentGroup: requires list is not an Array");Object.defineProperty(this,"requires",{get:function(){return v.slice()}}),Object.defineProperty(this,"requiresNames",{get:function(){return this._requiresNames.slice()}});for(var n=function(S){var E=v[S],R=null;if(!E)throw new Error("ComponentGroup: the required component at location ".concat(S," is invalid"));try{R=F(E)}catch(v){throw new Error("ComponentGroup: the required component at location ".concat(S," is not registered as a @Component. Remember to provide the class of the component, not the name"))}if(A._requiresNames.some((function(v){return v===R})))throw new Error("ComponentGroup: the required component list has a repeated name ".concat(R));A._requiresNames.push(R)},A=this,E=0;E<v.length;E++)n(E)}return t.prototype.hasEntity=function(v){return!!v.isAddedToEngine()&&-1!==this.entities.indexOf(v)},t.prototype.addEntity=function(v){if(!v.isAddedToEngine())throw new TypeError("ComponentGroup: Cannot add a entity that is not added to the engine");-1===this.entities.indexOf(v)&&this.entities.push(v)},t.prototype.removeEntity=function(v){var S=this.entities.indexOf(v);-1!==S&&this.entities.splice(S,1)},t.prototype.componentRemoved=function(v,S){-1!==this._requiresNames.indexOf(S)&&this.removeEntity(v)},t.prototype.meetsRequirements=function(v){for(var S=0;S<this._requiresNames.length;S++)if(!(this._requiresNames[S]in v.components))return!1;return!0},t}(),nt=function(){function t(v){this.name=v,this.children={},this.eventManager=null,this.alive=!1,this.uuid=f("E"),this.components={},this.engine=null,this._parent=null}return t.prototype.addComponentOrReplace=function(v){if("function"==typeof v)throw new Error("You passed a function or class as a component, an instance of component is expected");if("object"!=typeof v)throw new Error("You passed a ".concat(typeof v,", an instance of component is expected"));var S=F(v);if(this.components[S]){if(this.components[S]===v)return v;this.removeComponent(this.components[S],!1)}return this.addComponent(v)},t.prototype.hasComponent=function(v){var S=typeof v;if("string"!==S&&"object"!==S&&"function"!==S)throw new Error("Entity#has(component): component is not a class, name or instance");if(null===v)return!1;var A="string"===S?v:F(v),E=this.components[A];return!!E&&("object"===S?E===v:"function"!==S||E instanceof v)},t.prototype.getComponent=function(v){var S=typeof v;if("string"!==S&&"function"!==S)throw new Error("Entity#get(component): component is not a class or name");var A="string"===S?v:F(v),E=this.components[A];if(!E)throw new Error('Can not get component "'.concat(A,'" from entity "').concat(this.identifier,'"'));if("function"===S){if(E instanceof v)return E;throw new Error('Can not get component "'.concat(A,'" from entity "').concat(this.identifier,'" (by instance)'))}return E},t.prototype.getComponentOrNull=function(v){var S=typeof v;if("string"!==S&&"function"!==S)throw new Error("Entity#getOrNull(component): component is not a class or name");var A="string"===S?v:F(v),E=this.components[A];return E?"function"===S?E instanceof v?E:null:E:null},t.prototype.getComponentOrCreate=function(v){if("function"!=typeof v)throw new Error("Entity#getOrCreate(component): component is not a class");var S=this.getComponentOrNull(v);return S||(F(S=new v),this.addComponentOrReplace(S)),S},t.prototype.addComponent=function(v){if("object"!=typeof v)throw new Error("Entity#add(component): You passed a function or class as a component, an instance of component is expected");var S=F(v),A=L(v);if(this.components[S])throw new Error('A component of type "'.concat(S,'" is already present in entity "').concat(this.identifier,'"'));this.components[S]=v,this.eventManager&&this.eventManager.fireEvent(new B(this,S,A));var E=v;return"function"==typeof E.addedToEntity&&E.addedToEntity(this),v},t.prototype.removeComponent=function(v,S){void 0===S&&(S=!0);var A=typeof v;if("string"!==A&&"function"!==A&&"object"!==A)throw new Error("Entity#remove(component): component is not a class, class or name");var E="string"===A?v:F(v),R=this.components[E];if(R){if("function"===A)return R instanceof v?(delete this.components[E],void(R&&(S&&this.eventManager&&this.eventManager.fireEvent(new M(this,E,R)),"function"==typeof R.removedFromEntity&&R.removedFromEntity(this)))):void u('Entity Warning: Trying to remove wrong (by constructor) component "'.concat(E,'" from entity "').concat(this.identifier,'"'));delete this.components[E],R&&(S&&this.eventManager&&this.eventManager.fireEvent(new M(this,E,R)),"function"==typeof R.removedFromEntity&&R.removedFromEntity(this))}else u('Entity Warning: Trying to remove inexisting component "'.concat(E,'" from entity "').concat(this.identifier,'"'))},t.prototype.isAddedToEngine=function(){return!(!this.engine||!(this.uuid in this.engine.entities)&&this.engine.rootEntity!==this)},t.prototype.setParent=function(v){var S;if(v&&"getEntityRepresentation"in v){if(!this.engine)throw new Error("In order to set an attachable as parent, you first need to add the entity to the engine.");S=v.getEntityRepresentation(this.engine)}else S=!v&&this.engine?this.engine.rootEntity:v;var A=this.getParent();if(S===this)throw new Error('Failed to set parent for entity "'.concat(this.identifier,"\": An entity can't set itself as a its own parent"));if(S===A)return this;var E=this.getCircularAncestor(S);if(E)throw new Error('Failed to set parent for entity "'.concat(this.identifier,'": Circular parent references are not allowed (See entity "').concat(E,'")'));return A&&delete A.children[this.uuid],null!==S&&"0"!==S.uuid&&(!S.isAddedToEngine()&&this.isAddedToEngine()&&this.engine.removeEntity(this),S.isAddedToEngine()&&!this.isAddedToEngine()&&S.engine.addEntity(this)),this._parent=S||null,this.registerAsChild(),this.eventManager&&this.engine&&this.eventManager.fireEvent(new W(this,S)),this},t.prototype.getParent=function(){return this._parent},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.name||this.uuid},enumerable:!1,configurable:!0}),t.prototype.getCircularAncestor=function(v){for(var S=this.engine?this.engine.rootEntity:null,A=v;A&&A!==S;){var E=A.getParent();if(E===this)return A.uuid;A=E}return null},t.prototype.registerAsChild=function(){var v=this.getParent();this.uuid&&v&&(v.children[this.uuid]=this)},t}(),it=function(){function t(v){this.eventManager=new R,this.systems=[],this.entityLists={},this.addedSystems=[],this._entities={},this._disposableComponents={},this._componentGroups={},this.simpleSystems=[],this.eventManager.addListener(B,this,this.componentAddedHandler),this.eventManager.addListener(M,this,this.componentRemovedHandler),this.rootEntity=v,this.firstPersonCameraEntity=new nt,this.firstPersonCameraEntity.uuid="FirstPersonCameraEntityReference",this.addEntity(this.firstPersonCameraEntity),this.avatarEntity=new nt,this.avatarEntity.uuid="AvatarEntityReference",this.addEntity(this.avatarEntity)}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._entities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposableComponents",{get:function(){return this._disposableComponents},enumerable:!1,configurable:!0}),t.prototype.addEntity=function(v){var S=v.getParent();if(v.isAddedToEngine())return v;for(var A in v.eventManager=this.eventManager,v.engine=this,this._entities[v.uuid]=v,this.checkRequirementsAndAdd(v),S?S.isAddedToEngine()||S===this.rootEntity||u("Engine: warning, added an entity with a parent not present in the engine. Parent id: "+S.uuid):v.setParent(this.rootEntity),v.alive=!0,v.children){var E=v.children[A];E&&(E.isAddedToEngine()||this.addEntity(E))}return v},t.prototype.removeEntity=function(v){var S=v.uuid;if(v.isAddedToEngine()){for(var A in v.components){var E=this._componentGroups[A];if(E)for(var R in E)E[R].removeEntity(v);delete this.entityLists[A][S]}for(var O=0;O<this.simpleSystems.length;O++){var M=this.simpleSystems[O];M.onRemoveEntity&&M.onRemoveEntity(v)}for(var O in v.children){var B=v.children[O];B&&this.removeEntity(B)}return v.alive=!1,v.eventManager=null,delete this._entities[S],!0}for(var A in u("Engine: Trying to remove non existent entity from engine."),v.isAddedToEngine()?u("Engine: Entity id: "+S):u('Engine: Entity "'.concat(v.uuid,'" has not been added to any engine yet.')),u("Engine: Entity's components:"),v.components)u(A);return!1},t.prototype.addSystem=function(v,S){if(void 0===S&&(S=0),-1!==this.addedSystems.indexOf(v))return u("Engine: Trying to add a system that is already added. Aborting"),v;if(this.systems.length>0)for(var A=0;A<this.systems.length;A++){var E=this.systems[A],R=A===this.systems.length-1;if(E.priority>S){this.addedSystems.push(v),this.systems.splice(A,0,{system:v,priority:S});break}if(R){this.addedSystems.push(v),this.systems.splice(A+1,0,{system:v,priority:S});break}}else this.addedSystems.push(v),this.systems.splice(1,0,{system:v,priority:S});return this.registerSystem(v),v},t.prototype.removeSystem=function(v){var S=this.addedSystems.indexOf(v);if(-1!==S){v.active=!1,v.deactivate&&v.deactivate(),this.addedSystems.splice(S,1);for(var A=0;A<this.systems.length;A++)this.systems[A].system===v&&this.systems.splice(A,1);return!0}return!1},t.prototype.update=function(v){for(var S in this.systems){var A=this.systems[S].system;if(A.active&&A.update)try{A.update(v)}catch(v){y(v)}}return this},t.prototype.getEntitiesWithComponent=function(v){var S="string"==typeof v?v:F(v);return S in this.entityLists?this.entityLists[S]:this.entityLists[S]={}},t.prototype.registerComponent=function(v){var S=D(v),A=F(v),E=L(v);this._disposableComponents[S]=v,null!==E&&(this.eventManager.fireEvent(new Z(S,A,E)),this.eventManager.fireEvent(new J(S,v)))},t.prototype.disposeComponent=function(v){var S=D(v);return delete this._disposableComponents[S]&&(this.eventManager.fireEvent(new K(S)),v.onDispose&&v.onDispose(),!0)},t.prototype.updateComponent=function(v){this.eventManager.fireEvent(new J(D(v),v))},t.prototype.getComponentGroup=function(){for(var v=[],S=0;S<arguments.length;S++)v[S]=arguments[S];var A=void 0;if(v.length>0&&(W=this._componentGroups[F(v[0])]))for(var E=v.slice(),R=0;R<W.length;R++){var O=W[R];if(E.length===O.requires.length){for(var M=0;M<E.length&&-1!==O.requires.indexOf(E[M]);M++)M===E.length-1&&(A=O);if(A)break}}if(A)return A;(A=new(et.bind.apply(et,p([void 0],l(v))))).active=!0;var B=A.requiresNames;for(R=0;R<B.length;R++){var W,H=B[R];(W=this._componentGroups[H])||(this._componentGroups[H]=W=[]),-1===W.indexOf(A)&&W.push(A)}for(var V in this._entities)this.checkRequirements(this._entities[V],A);return A},t.prototype.removeComponentGroup=function(v){if(v.active){v.active=!1;for(var S=v.requiresNames,A=0;A<S.length;A++){var E=S[A],R=this._componentGroups[E];if(R){var O=R.indexOf(v);-1!==O&&R.splice(O,1)}}return!0}return!1},t.prototype.registerSystem=function(v){v.active=!0,v.activate&&v.activate(this),this.simpleSystems.push(v)},t.prototype.checkRequirementsAndAdd=function(v){if(v.isAddedToEngine()){for(var S in v.components){S in this.entityLists||(this.entityLists[S]={}),this.entityLists[S][v.uuid]=v;var A=this._componentGroups[S];if(A)for(var E in A)this.checkRequirements(v,A[E])}for(var R=0;R<this.simpleSystems.length;R++){var O=this.simpleSystems[R];O.onAddEntity&&O.onAddEntity(v)}}},t.prototype.checkRequirements=function(v,S){S.meetsRequirements(v)?S.hasEntity(v)||S.addEntity(v):S.hasEntity(v)&&S.removeEntity(v)},t.prototype.componentAddedHandler=function(v){var S,A=v.entity,E=v.componentName;if(A.isAddedToEngine()){this.entityLists[E]?this.entityLists[E][A.uuid]=A:this.entityLists[E]=((S={})[A.uuid]=A,S);var R=this._componentGroups[E];if(R)for(var O in R)this.checkRequirements(A,R[O])}},t.prototype.componentRemovedHandler=function(v){var S=v.entity,A=v.componentName;if(S.isAddedToEngine()){delete this.entityLists[A][S.uuid];var E=this._componentGroups[A];if(E)for(var R in E)this.checkRequirements(S,E[R])}},t}(),ot=Promise.resolve().then.bind(Promise.resolve());function G(v){var S=ot(v);return S.isComplete=!1,S.then((function(v){S.isComplete=!0,S.result=v,S.didFail=!1})).catch((function(v){S.isComplete=!0,S.error=v,S.didFail=!0,y("executeTask: FAILED "+v.toString(),v)})),S}var rt,st,at=function(){function t(v,S,A,E){void 0===S&&(S=!1),this.initalize(v,S,A,E)}return t.prototype.initalize=function(v,S,A,E){return void 0===S&&(S=!1),this.mask=v,this.skipNextObservers=S,this.target=A,this.currentTarget=E,this},t}(),Y=function(v,S,A){void 0===A&&(A=null),this.callback=v,this.mask=S,this.scope=A,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1},ht=function(){function t(){this._observers=null,this._observables=null}return t.Watch=function(v,S,A,E){var R,O;void 0===A&&(A=-1),void 0===E&&(E=null);var M=new t;M._observers=new Array,M._observables=v;try{for(var B=h(v),W=B.next();!W.done;W=B.next()){var H=W.value.add(S,A,!1,E);H&&M._observers.push(H)}}catch(v){R={error:v}}finally{try{W&&!W.done&&(O=B.return)&&O.call(B)}finally{if(R)throw R.error}}return M},t.prototype.dispose=function(){if(this._observers&&this._observables)for(var v=0;v<this._observers.length;v++)this._observables[v].remove(this._observers[v]);this._observers=null,this._observables=null},t}(),ut=function(){function t(v){this._observers=new Array,this._onObserverAdded=null,this._eventState=new at(0),v&&(this._onObserverAdded=v)}return t.prototype.add=function(v,S,A,E,R){if(void 0===S&&(S=-1),void 0===A&&(A=!1),void 0===E&&(E=null),void 0===R&&(R=!1),!v)return null;var O=new Y(v,S,E);return O.unregisterOnNextCall=R,A?this._observers.unshift(O):this._observers.push(O),this._onObserverAdded&&this._onObserverAdded(O),O},t.prototype.addOnce=function(v){return this.add(v,void 0,void 0,void 0,!0)},t.prototype.remove=function(v){return!!v&&-1!==this._observers.indexOf(v)&&(this._deferUnregister(v),!0)},t.prototype.removeCallback=function(v,S){for(var A=0;A<this._observers.length;A++)if(this._observers[A].callback===v&&(!S||S===this._observers[A].scope))return this._deferUnregister(this._observers[A]),!0;return!1},t.prototype.notifyObservers=function(v,S,A,E){var R,O;if(void 0===S&&(S=-1),!this._observers.length)return!0;var M=this._eventState;M.mask=S,M.target=A,M.currentTarget=E,M.skipNextObservers=!1,M.lastReturnValue=v;try{for(var B=h(this._observers),W=B.next();!W.done;W=B.next()){var H=W.value;if(!H._willBeUnregistered&&(H.mask&S&&(H.scope?M.lastReturnValue=H.callback.apply(H.scope,[v,M]):M.lastReturnValue=H.callback(v,M),H.unregisterOnNextCall&&this._deferUnregister(H)),M.skipNextObservers))return!1}}catch(v){R={error:v}}finally{try{W&&!W.done&&(O=B.return)&&O.call(B)}finally{if(R)throw R.error}}return!0},t.prototype.notifyObserversWithPromise=function(v,S,A,E){var R=this;void 0===S&&(S=-1);var O=Promise.resolve(v);if(!this._observers.length)return O;var M=this._eventState;return M.mask=S,M.target=A,M.currentTarget=E,M.skipNextObservers=!1,this._observers.forEach((function(A){M.skipNextObservers||A._willBeUnregistered||A.mask&S&&(O=A.scope?O.then((function(S){return M.lastReturnValue=S,A.callback.apply(A.scope,[v,M])})):O.then((function(S){return M.lastReturnValue=S,A.callback(v,M)})),A.unregisterOnNextCall&&R._deferUnregister(A))})),O.then((function(){return v}))},t.prototype.notifyObserver=function(v,S,A){void 0===A&&(A=-1);var E=this._eventState;E.mask=A,E.skipNextObservers=!1,v.callback(S,E)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var v=new t;return v._observers=this._observers.slice(0),v},t.prototype.hasSpecificMask=function(v){var S,A;void 0===v&&(v=-1);try{for(var E=h(this._observers),R=E.next();!R.done;R=E.next()){var O=R.value;if(O.mask&v||O.mask===v)return!0}}catch(v){S={error:v}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}return!1},t.prototype._deferUnregister=function(v){var S=this;v.unregisterOnNextCall=!1,v._willBeUnregistered=!0,G((function(){return function(v,S,A,E){return new(A||(A=Promise))((function(S,R){function s(v){try{d(E.next(v))}catch(v){R(v)}}function a(v){try{d(E.throw(v))}catch(v){R(v)}}function d(v){var E;v.done?S(v.value):(E=v.value,E instanceof A?E:new A((function(v){v(E)}))).then(s,a)}d((E=E.apply(v,[])).next())}))}(S,0,void 0,(function(){return function(v,S){var A,E,R,O,M={label:0,sent:function(){if(1&R[0])throw R[1];return R[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(B){return function(O){if(A)throw new TypeError("Generator is already executing.");for(;M;)try{if(A=1,E&&(R=2&O[0]?E.return:O[0]?E.throw||((R=E.return)&&R.call(E),0):E.next)&&!(R=R.call(E,O[1])).done)return R;switch(E=0,R&&(O=[2&O[0],R.value]),O[0]){case 0:case 1:R=O;break;case 4:return M.label++,{value:O[1],done:!1};case 5:M.label++,E=O[1],O=[0];continue;case 7:O=M.ops.pop(),M.trys.pop();continue;default:if(!((R=(R=M.trys).length>0&&R[R.length-1])||6!==O[0]&&2!==O[0])){M=0;continue}if(3===O[0]&&(!R||O[1]>R[0]&&O[1]<R[3])){M.label=O[1];break}if(6===O[0]&&M.label<R[1]){M.label=R[1],R=O;break}if(R&&M.label<R[2]){M.label=R[2],M.ops.push(O);break}R[2]&&M.ops.pop(),M.trys.pop();continue}O=S.call(v,M)}catch(v){O=[6,v],E=0}finally{A=R=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,B])}}}(this,(function(S){return[2,this._remove(v)]}))}))}))},t.prototype._remove=function(v){if(!v)return!1;var S=this._observers.indexOf(v);return-1!==S&&(this._observers.splice(S,1),!0)},t}(),lt=r([x(),s("design:paramtypes",[String,Object])],(function(v,S){this.uuid=v,this.payload=S})),ct=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v})),pt=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v}));function tt(v){return function(){st&&st.subscribe(v)}}var dt=new ut(tt("cameraModeChanged")),gt=new ut(tt("idleStateChanged")),yt=new ut(tt("onEnterScene")),ft=yt,vt=new ut(tt("onLeaveScene")),bt=vt,Tt=new ut(tt("sceneStart")),xt=new ut(tt("playerExpression")),Ct=new ut(tt("onPointerLock")),wt=new ut(tt("videoEvent")),St=new ut(tt("profileChanged")),At=new ut(tt("playerConnected")),_t=new ut(tt("playerDisconnected")),It=new ut(tt("onRealmChanged")),Rt=new ut(tt("playerClicked"));function mt(v){(st=v)&&st.onEvent((function(v){switch(v.type){case"onEnterScene":return void yt.notifyObservers(v.data);case"onLeaveScene":return void vt.notifyObservers(v.data);case"cameraModeChanged":return void dt.notifyObservers(v.data);case"idleStateChanged":return void gt.notifyObservers(v.data);case"sceneStart":return void Tt.notifyObservers(v.data);case"playerExpression":return void xt.notifyObservers(v.data);case"videoEvent":var S=v.data,A=N.engine.disposableComponents[S.componentId];return A&&A.update(S),void wt.notifyObservers(S);case"profileChanged":return void St.notifyObservers(v.data);case"onPointerLock":return void Ct.notifyObservers(v.data);case"playerConnected":return void At.notifyObservers(v.data);case"playerDisconnected":return void _t.notifyObservers(v.data);case"onRealmChanged":return void It.notifyObservers(v.data);case"playerClicked":return void Rt.notifyObservers(v.data)}}))}var Pt=function(){function t(v){this.dcl=v,this.cachedComponents={}}return t.prototype.activate=function(v){var S=this;this.engine=v,v.eventManager.addListener(B,this,this.componentAdded),v.eventManager.addListener(M,this,this.componentRemoved),v.eventManager.addListener(Z,this,this.disposableComponentCreated),v.eventManager.addListener(K,this,this.disposableComponentRemoved),v.eventManager.addListener(J,this,this.disposableComponentUpdated),v.eventManager.addListener(W,this,this.parentChanged);var A=v.rootEntity.uuid;this.dcl.addEntity(A),this.dcl.onUpdate((function(A){v.update(A),S.presentEntities()})),this.dcl.onEvent((function(S){var A=S.data;switch(S.type){case"uuidEvent":v.eventManager.fireEvent(new lt(A.uuid,A.payload));break;case"raycastResponse":("HitFirst"===A.queryType||"HitAll"===A.queryType)&&v.eventManager.fireEvent(new ct(A));break;case"actionButtonEvent":v.eventManager.fireEvent(new pt(A.payload))}}))},t.prototype.onAddEntity=function(v){if(v&&v.isAddedToEngine()){var S=v.uuid,A=v.getParent();for(var E in this.dcl.addEntity(S),A&&this.dcl.setParent(S,A.uuid),this.cachedComponents[S]={},v.components){var R=v.components[E],O=L(R);if(null!==O)if(U(R))this.dcl.attachEntityComponent(v.uuid,E,D(R));else{var M=JSON.stringify(R);this.dcl.updateEntityComponent(S,E,O,M),this.cachedComponents[S][E]=M}}}},t.prototype.onRemoveEntity=function(v){if(v.isAddedToEngine()){var S=v.uuid;this.dcl.removeEntity(S),delete this.cachedComponents[S]}},t.prototype.presentEntities=function(){for(var v in this.engine.entities){var S=this.engine.entities[v];for(var A in S.components){var E=L(M=S.components[A]);if(null!==E&&!U(M)){var R=this.getJsonIfDirty(S.uuid,A,M);R&&(this.dcl.updateEntityComponent(S.uuid,A,E,R),this.clearDirty(S.uuid,A,M,R))}}}for(var O in this.engine.disposableComponents){var M;(M=this.engine.disposableComponents[O])instanceof $&&M.dirty&&(this.dcl.componentUpdated(O,JSON.stringify(M)),M.dirty=!1)}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var S=v.entity.components[v.componentName];if(U(S))this.dcl.attachEntityComponent(v.entity.uuid,v.componentName,D(S));else if(null!==v.classId){var A=JSON.stringify(S);this.dcl.updateEntityComponent(v.entity.uuid,v.componentName,v.classId,A),this.cachedComponents[v.entity.uuid][v.componentName]=A}}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&(this.dcl.removeEntityComponent(v.entity.uuid,v.componentName),delete this.cachedComponents[v.entity.uuid][v.componentName])},t.prototype.disposableComponentCreated=function(v){this.dcl.componentCreated(v.componentId,v.componentName,v.classId)},t.prototype.disposableComponentRemoved=function(v){this.dcl.componentDisposed(v.componentId)},t.prototype.disposableComponentUpdated=function(v){this.dcl.componentUpdated(v.componentId,JSON.stringify(v.component))},t.prototype.parentChanged=function(v){this.dcl.setParent(v.entity.uuid,v.parent?v.parent.uuid:"0")},t.prototype.getJsonIfDirty=function(v,S,A){var E=JSON.stringify(A);return E!==this.cachedComponents[v][S]&&E},t.prototype.clearDirty=function(v,S,A,E){this.cachedComponents[v][S]=E},t}(),Ot="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Nt={},zt={};!function(v){var S,A;Object.defineProperty(v,"__esModule",{value:!0}),v.RAD2DEG=v.DEG2RAD=v.Epsilon=v.ToLinearSpace=v.ToGammaSpace=v.Space=v.Orientation=void 0,(S=v.Orientation||(v.Orientation={}))[S.CW=0]="CW",S[S.CCW=1]="CCW",(A=v.Space||(v.Space={}))[A.LOCAL=0]="LOCAL",A[A.WORLD=1]="WORLD",A[A.BONE=2]="BONE",v.ToGammaSpace=1/2.2,v.ToLinearSpace=2.2,v.Epsilon=1e-6,v.DEG2RAD=Math.PI/180,v.RAD2DEG=360/(2*Math.PI)}(zt);var Lt={},Ft={};Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.buildArray=void 0,Ft.buildArray=function(v,S){const A=[];for(let E=0;E<v;++E)A.push(S());return A};var kt={},Bt={},Ut={},Wt={},Ht={};Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.Scalar=void 0;class Et{static WithinEpsilon(v,S,A=1401298e-51){const E=v-S;return-A<=E&&E<=A}static ToHex(v){const S=v.toString(16);return v<=15?("0"+S).toUpperCase():S.toUpperCase()}static Sign(v){const S=+v;return 0===S||isNaN(S)?S:S>0?1:-1}static Clamp(v,S=0,A=1){return Math.min(A,Math.max(S,v))}static Log2(v){return Math.log(v)*Math.LOG2E}static Repeat(v,S){return v-Math.floor(v/S)*S}static Normalize(v,S,A){return(v-S)/(A-S)}static Denormalize(v,S,A){return v*(A-S)+S}static DeltaAngle(v,S){let A=Et.Repeat(S-v,360);return A>180&&(A-=360),A}static PingPong(v,S){const A=Et.Repeat(v,2*S);return S-Math.abs(A-S)}static SmoothStep(v,S,A){let E=Et.Clamp(A);return E=-2*E*E*E+3*E*E,S*E+v*(1-E)}static MoveTowards(v,S,A){let E=0;return E=Math.abs(S-v)<=A?S:v+Et.Sign(S-v)*A,E}static MoveTowardsAngle(v,S,A){const E=Et.DeltaAngle(v,S);let R=0;return R=-A<E&&E<A?S:Et.MoveTowards(v,v+E,A),R}static Lerp(v,S,A){return v+(S-v)*A}static LerpAngle(v,S,A){let E=Et.Repeat(S-v,360);return E>180&&(E-=360),v+E*Et.Clamp(A)}static InverseLerp(v,S,A){let E=0;return E=v!==S?Et.Clamp((A-v)/(S-v)):0,E}static Hermite(v,S,A,E,R){const O=R*R,M=R*O;return v*(2*M-3*O+1)+A*(-2*M+3*O)+S*(M-2*O+R)+E*(M-O)}static RandomRange(v,S){return v===S?v:Math.random()*(S-v)+v}static RangeToPercent(v,S,A){return(v-S)/(A-S)}static PercentToRange(v,S,A){return(A-S)*v+S}static NormalizeRadians(v){return v-Et.TwoPi*Math.floor((v+Math.PI)/Et.TwoPi)}}Ht.Scalar=Et,Et.TwoPi=2*Math.PI,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.Vector4=void 0;const Vt=zt,qt=Ht,Gt=kt;class Mt{constructor(v,S,A,E){this.x=v,this.y=S,this.z=A,this.w=E}static Add(v,S){return new Mt(v.x,v.y,v.z,v.w).addInPlace(S)}static FromArray(v,S=0){return new Mt(v[S],v[S+1],v[S+2],v[S+3])}static FromArrayToRef(v,S,A){A.x=v[S],A.y=v[S+1],A.z=v[S+2],A.w=v[S+3]}static FromFloatArrayToRef(v,S,A){Mt.FromArrayToRef(v,S,A)}static FromFloatsToRef(v,S,A,E,R){R.x=v,R.y=S,R.z=A,R.w=E}static Zero(){return new Mt(0,0,0,0)}static One(){return new Mt(1,1,1,1)}static Normalize(v){const S=Mt.Zero();return Mt.NormalizeToRef(v,S),S}static NormalizeToRef(v,S){S.copyFrom(v),S.normalize()}static Minimize(v,S){const A=new Mt(v.x,v.y,v.z,v.w);return A.minimizeInPlace(S),A}static Maximize(v,S){const A=new Mt(v.x,v.y,v.z,v.w);return A.maximizeInPlace(S),A}static Distance(v,S){return Math.sqrt(Mt.DistanceSquared(v,S))}static DistanceSquared(v,S){const A=v.x-S.x,E=v.y-S.y,R=v.z-S.z,O=v.w-S.w;return A*A+E*E+R*R+O*O}static Center(v,S){const A=Mt.Add(v,S);return A.scaleInPlace(.5),A}static TransformNormal(v,S){const A=Mt.Zero();return Mt.TransformNormalToRef(v,S,A),A}static TransformNormalToRef(v,S,A){const E=S.m,R=v.x*E[0]+v.y*E[4]+v.z*E[8],O=v.x*E[1]+v.y*E[5]+v.z*E[9],M=v.x*E[2]+v.y*E[6]+v.z*E[10];A.x=R,A.y=O,A.z=M,A.w=v.w}static TransformNormalFromFloatsToRef(v,S,A,E,R,O){const M=R.m;O.x=v*M[0]+S*M[4]+A*M[8],O.y=v*M[1]+S*M[5]+A*M[9],O.z=v*M[2]+S*M[6]+A*M[10],O.w=E}toString(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"}getClassName(){return"Vector4"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,S=0){return v[S]=this.x,v[S+1]=this.y,v[S+2]=this.z,v[S+3]=this.w,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}add(v){return new Mt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addToRef(v,S){return S.x=this.x+v.x,S.y=this.y+v.y,S.z=this.z+v.z,S.w=this.w+v.w,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this.w-=v.w,this}subtract(v){return new Mt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}subtractToRef(v,S){return S.x=this.x-v.x,S.y=this.y-v.y,S.z=this.z-v.z,S.w=this.w-v.w,this}subtractFromFloats(v,S,A,E){return new Mt(this.x-v,this.y-S,this.z-A,this.w-E)}subtractFromFloatsToRef(v,S,A,E,R){return R.x=this.x-v,R.y=this.y-S,R.z=this.z-A,R.w=this.w-E,this}negate(){return new Mt(-this.x,-this.y,-this.z,-this.w)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scale(v){return new Mt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,S){return S.x=this.x*v,S.y=this.y*v,S.z=this.z*v,S.w=this.w*v,this}scaleAndAddToRef(v,S){return S.x+=this.x*v,S.y+=this.y*v,S.z+=this.z*v,S.w+=this.w*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}equalsWithEpsilon(v,S=Vt.Epsilon){return v&&qt.Scalar.WithinEpsilon(this.x,v.x,S)&&qt.Scalar.WithinEpsilon(this.y,v.y,S)&&qt.Scalar.WithinEpsilon(this.z,v.z,S)&&qt.Scalar.WithinEpsilon(this.w,v.w,S)}equalsToFloats(v,S,A,E){return this.x===v&&this.y===S&&this.z===A&&this.w===E}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this.w*=v.w,this}multiply(v){return new Mt(this.x*v.x,this.y*v.y,this.z*v.z,this.w*v.w)}multiplyToRef(v,S){return S.x=this.x*v.x,S.y=this.y*v.y,S.z=this.z*v.z,S.w=this.w*v.w,this}multiplyByFloats(v,S,A,E){return new Mt(this.x*v,this.y*S,this.z*A,this.w*E)}divide(v){return new Mt(this.x/v.x,this.y/v.y,this.z/v.z,this.w/v.w)}divideToRef(v,S){return S.x=this.x/v.x,S.y=this.y/v.y,S.z=this.z/v.z,S.w=this.w/v.w,this}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return v.x<this.x&&(this.x=v.x),v.y<this.y&&(this.y=v.y),v.z<this.z&&(this.z=v.z),v.w<this.w&&(this.w=v.w),this}maximizeInPlace(v){return v.x>this.x&&(this.x=v.x),v.y>this.y&&(this.y=v.y),v.z>this.z&&(this.z=v.z),v.w>this.w&&(this.w=v.w),this}floor(){return new Mt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fract(){return new Mt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){const v=this.length();return 0===v?this:this.scaleInPlace(1/v)}toVector3(){return new Gt.Vector3(this.x,this.y,this.z)}clone(){return new Mt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,S,A,E){return this.x=v,this.y=S,this.z=A,this.w=E,this}set(v,S,A,E){return this.copyFromFloats(v,S,A,E)}setAll(v){return this.x=this.y=this.z=this.w=v,this}}Wt.Vector4=Mt,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.Matrix=void 0;const Yt=kt,Qt=Bt,Zt=Lt,Kt=Wt;class Dt{constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this._m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._updateIdentityStatus(!1)}get m(){return this._m}static get IdentityReadOnly(){return Dt._identityReadOnly}static FromArray(v,S=0){const A=new Dt;return Dt.FromArrayToRef(v,S,A),A}static FromArrayToRef(v,S,A){for(let E=0;E<16;E++)A._m[E]=v[E+S];A._markAsUpdated()}static FromFloatArrayToRefScaled(v,S,A,E){for(let R=0;R<16;R++)E._m[R]=v[R+S]*A;E._markAsUpdated()}static FromValuesToRef(v,S,A,E,R,O,M,B,W,H,V,X,Q,Z,K,J,$){const et=$._m;et[0]=v,et[1]=S,et[2]=A,et[3]=E,et[4]=R,et[5]=O,et[6]=M,et[7]=B,et[8]=W,et[9]=H,et[10]=V,et[11]=X,et[12]=Q,et[13]=Z,et[14]=K,et[15]=J,$._markAsUpdated()}static FromValues(v,S,A,E,R,O,M,B,W,H,V,X,Q,Z,K,J){const $=new Dt,et=$._m;return et[0]=v,et[1]=S,et[2]=A,et[3]=E,et[4]=R,et[5]=O,et[6]=M,et[7]=B,et[8]=W,et[9]=H,et[10]=V,et[11]=X,et[12]=Q,et[13]=Z,et[14]=K,et[15]=J,$._markAsUpdated(),$}static Compose(v,S,A){const E=new Dt;return Dt.ComposeToRef(v,S,A,E),E}static ComposeToRef(v,S,A,E){Dt.ScalingToRef(v.x,v.y,v.z,Zt.MathTmp.Matrix[1]),S.toRotationMatrix(Zt.MathTmp.Matrix[0]),Zt.MathTmp.Matrix[1].multiplyToRef(Zt.MathTmp.Matrix[0],E),E.setTranslation(A)}static Identity(){const v=Dt.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return v._updateIdentityStatus(!0),v}static IdentityToRef(v){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,v),v._updateIdentityStatus(!0)}static Zero(){const v=Dt.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return v._updateIdentityStatus(!1),v}static RotationX(v){const S=new Dt;return Dt.RotationXToRef(v,S),S}static Invert(v){const S=new Dt;return v.invertToRef(S),S}static RotationXToRef(v,S){const A=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(1,0,0,0,0,E,A,0,0,-A,E,0,0,0,0,1,S),S._updateIdentityStatus(1===E&&0===A)}static RotationY(v){const S=new Dt;return Dt.RotationYToRef(v,S),S}static RotationYToRef(v,S){const A=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(E,0,-A,0,0,1,0,0,A,0,E,0,0,0,0,1,S),S._updateIdentityStatus(1===E&&0===A)}static RotationZ(v){const S=new Dt;return Dt.RotationZToRef(v,S),S}static RotationZToRef(v,S){const A=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(E,A,0,0,-A,E,0,0,0,0,1,0,0,0,0,1,S),S._updateIdentityStatus(1===E&&0===A)}static RotationAxis(v,S){const A=new Dt;return Dt.RotationAxisToRef(v,S,A),A}static RotationAxisToRef(v,S,A){const E=Math.sin(-S),R=Math.cos(-S),O=1-R;v.normalize();const M=A._m;M[0]=v.x*v.x*O+R,M[1]=v.x*v.y*O-v.z*E,M[2]=v.x*v.z*O+v.y*E,M[3]=0,M[4]=v.y*v.x*O+v.z*E,M[5]=v.y*v.y*O+R,M[6]=v.y*v.z*O-v.x*E,M[7]=0,M[8]=v.z*v.x*O-v.y*E,M[9]=v.z*v.y*O+v.x*E,M[10]=v.z*v.z*O+R,M[11]=0,M[12]=0,M[13]=0,M[14]=0,M[15]=1,A._markAsUpdated()}static RotationYawPitchRoll(v,S,A){const E=new Dt;return Dt.RotationYawPitchRollToRef(v,S,A,E),E}static RotationYawPitchRollToRef(v,S,A,E){Qt.Quaternion.RotationYawPitchRollToRef(v,S,A,Zt.MathTmp.Quaternion[0]),Zt.MathTmp.Quaternion[0].toRotationMatrix(E)}static Scaling(v,S,A){const E=new Dt;return Dt.ScalingToRef(v,S,A,E),E}static ScalingToRef(v,S,A,E){Dt.FromValuesToRef(v,0,0,0,0,S,0,0,0,0,A,0,0,0,0,1,E),E._updateIdentityStatus(1===v&&1===S&&1===A)}static Translation(v,S,A){const E=new Dt;return Dt.TranslationToRef(v,S,A,E),E}static TranslationToRef(v,S,A,E){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v,S,A,1,E),E._updateIdentityStatus(0===v&&0===S&&0===A)}static Lerp(v,S,A){const E=new Dt;return Dt.LerpToRef(v,S,A,E),E}static LerpToRef(v,S,A,E){for(let R=0;R<16;R++)E._m[R]=v._m[R]*(1-A)+S._m[R]*A;E._markAsUpdated()}static DecomposeLerp(v,S,A){const E=new Dt;return Dt.DecomposeLerpToRef(v,S,A,E),E}static DecomposeLerpToRef(v,S,A,E){const R=Zt.MathTmp.Vector3[0],O=Zt.MathTmp.Quaternion[0],M=Zt.MathTmp.Vector3[1];v.decompose(R,O,M);const B=Zt.MathTmp.Vector3[2],W=Zt.MathTmp.Quaternion[1],H=Zt.MathTmp.Vector3[3];S.decompose(B,W,H);const V=Zt.MathTmp.Vector3[4];Yt.Vector3.LerpToRef(R,B,A,V);const X=Zt.MathTmp.Quaternion[2];Qt.Quaternion.SlerpToRef(O,W,A,X);const Q=Zt.MathTmp.Vector3[5];Yt.Vector3.LerpToRef(M,H,A,Q),Dt.ComposeToRef(V,X,Q,E)}static LookAtLH(v,S,A){const E=new Dt;return Dt.LookAtLHToRef(v,S,A,E),E}static LookAtLHToRef(v,S,A,E){const R=Zt.MathTmp.Vector3[0],O=Zt.MathTmp.Vector3[1],M=Zt.MathTmp.Vector3[2];S.subtractToRef(v,M),M.normalize(),Yt.Vector3.CrossToRef(A,M,R);const B=R.lengthSquared();0===B?R.x=1:R.normalizeFromLength(Math.sqrt(B)),Yt.Vector3.CrossToRef(M,R,O),O.normalize();const W=-Yt.Vector3.Dot(R,v),H=-Yt.Vector3.Dot(O,v),V=-Yt.Vector3.Dot(M,v);Dt.FromValuesToRef(R.x,O.x,M.x,0,R.y,O.y,M.y,0,R.z,O.z,M.z,0,W,H,V,1,E)}static LookAtRH(v,S,A){const E=new Dt;return Dt.LookAtRHToRef(v,S,A,E),E}static LookAtRHToRef(v,S,A,E){const R=Zt.MathTmp.Vector3[0],O=Zt.MathTmp.Vector3[1],M=Zt.MathTmp.Vector3[2];v.subtractToRef(S,M),M.normalize(),Yt.Vector3.CrossToRef(A,M,R);const B=R.lengthSquared();0===B?R.x=1:R.normalizeFromLength(Math.sqrt(B)),Yt.Vector3.CrossToRef(M,R,O),O.normalize();const W=-Yt.Vector3.Dot(R,v),H=-Yt.Vector3.Dot(O,v),V=-Yt.Vector3.Dot(M,v);Dt.FromValuesToRef(R.x,O.x,M.x,0,R.y,O.y,M.y,0,R.z,O.z,M.z,0,W,H,V,1,E)}static OrthoLH(v,S,A,E){const R=new Dt;return Dt.OrthoLHToRef(v,S,A,E,R),R}static OrthoLHToRef(v,S,A,E,R){const O=2/v,M=2/S,B=2/(E-A),W=-(E+A)/(E-A);Dt.FromValuesToRef(O,0,0,0,0,M,0,0,0,0,B,0,0,0,W,1,R),R._updateIdentityStatus(1===O&&1===M&&1===B&&0===W)}static OrthoOffCenterLH(v,S,A,E,R,O){const M=new Dt;return Dt.OrthoOffCenterLHToRef(v,S,A,E,R,O,M),M}static OrthoOffCenterLHToRef(v,S,A,E,R,O,M){const B=2/(S-v),W=2/(E-A),H=2/(O-R),V=-(O+R)/(O-R),X=(v+S)/(v-S),Q=(E+A)/(A-E);Dt.FromValuesToRef(B,0,0,0,0,W,0,0,0,0,H,0,X,Q,V,1,M),M._markAsUpdated()}static OrthoOffCenterRH(v,S,A,E,R,O){const M=new Dt;return Dt.OrthoOffCenterRHToRef(v,S,A,E,R,O,M),M}static OrthoOffCenterRHToRef(v,S,A,E,R,O,M){Dt.OrthoOffCenterLHToRef(v,S,A,E,R,O,M),M._m[10]*=-1}static PerspectiveLH(v,S,A,E){const R=new Dt,O=2*A/v,M=2*A/S,B=(E+A)/(E-A),W=-2*E*A/(E-A);return Dt.FromValuesToRef(O,0,0,0,0,M,0,0,0,0,B,1,0,0,W,0,R),R._updateIdentityStatus(!1),R}static PerspectiveFovLH(v,S,A,E){const R=new Dt;return Dt.PerspectiveFovLHToRef(v,S,A,E,R),R}static PerspectiveFovLHToRef(v,S,A,E,R,O=!0){const M=A,B=E,W=1/Math.tan(.5*v),H=O?W/S:W,V=O?W:W*S,X=(B+M)/(B-M),Q=-2*B*M/(B-M);Dt.FromValuesToRef(H,0,0,0,0,V,0,0,0,0,X,1,0,0,Q,0,R),R._updateIdentityStatus(!1)}static PerspectiveFovRH(v,S,A,E){const R=new Dt;return Dt.PerspectiveFovRHToRef(v,S,A,E,R),R}static PerspectiveFovRHToRef(v,S,A,E,R,O=!0){const M=A,B=E,W=1/Math.tan(.5*v),H=O?W/S:W,V=O?W:W*S,X=-(B+M)/(B-M),Q=-2*B*M/(B-M);Dt.FromValuesToRef(H,0,0,0,0,V,0,0,0,0,X,-1,0,0,Q,0,R),R._updateIdentityStatus(!1)}static PerspectiveFovWebVRToRef(v,S,A,E,R=!1){const O=R?-1:1,M=Math.tan(v.upDegrees*Math.PI/180),B=Math.tan(v.downDegrees*Math.PI/180),W=Math.tan(v.leftDegrees*Math.PI/180),H=Math.tan(v.rightDegrees*Math.PI/180),V=2/(W+H),X=2/(M+B),Q=E._m;Q[0]=V,Q[1]=Q[2]=Q[3]=Q[4]=0,Q[5]=X,Q[6]=Q[7]=0,Q[8]=(W-H)*V*.5,Q[9]=-(M-B)*X*.5,Q[10]=-A/(S-A),Q[11]=1*O,Q[12]=Q[13]=Q[15]=0,Q[14]=-2*A*S/(A-S),E._markAsUpdated()}static GetAsMatrix2x2(v){return[v._m[0],v._m[1],v._m[4],v._m[5]]}static GetAsMatrix3x3(v){return[v._m[0],v._m[1],v._m[2],v._m[4],v._m[5],v._m[6],v._m[8],v._m[9],v._m[10]]}static Transpose(v){const S=new Dt;return Dt.TransposeToRef(v,S),S}static TransposeToRef(v,S){const A=S._m,E=v._m;A[0]=E[0],A[1]=E[4],A[2]=E[8],A[3]=E[12],A[4]=E[1],A[5]=E[5],A[6]=E[9],A[7]=E[13],A[8]=E[2],A[9]=E[6],A[10]=E[10],A[11]=E[14],A[12]=E[3],A[13]=E[7],A[14]=E[11],A[15]=E[15],S._updateIdentityStatus(v._isIdentity,v._isIdentityDirty)}static Reflection(v){const S=new Dt;return Dt.ReflectionToRef(v,S),S}static ReflectionToRef(v,S){v.normalize();const A=v.normal.x,E=v.normal.y,R=v.normal.z,O=-2*A,M=-2*E,B=-2*R;Dt.FromValuesToRef(O*A+1,M*A,B*A,0,O*E,M*E+1,B*E,0,O*R,M*R,B*R+1,0,O*v.d,M*v.d,B*v.d,1,S)}static FromXYZAxesToRef(v,S,A,E){Dt.FromValuesToRef(v.x,v.y,v.z,0,S.x,S.y,S.z,0,A.x,A.y,A.z,0,0,0,0,1,E)}static FromQuaternionToRef(v,S){const A=v.x*v.x,E=v.y*v.y,R=v.z*v.z,O=v.x*v.y,M=v.z*v.w,B=v.z*v.x,W=v.y*v.w,H=v.y*v.z,V=v.x*v.w;S._m[0]=1-2*(E+R),S._m[1]=2*(O+M),S._m[2]=2*(B-W),S._m[3]=0,S._m[4]=2*(O-M),S._m[5]=1-2*(R+A),S._m[6]=2*(H+V),S._m[7]=0,S._m[8]=2*(B+W),S._m[9]=2*(H-V),S._m[10]=1-2*(E+A),S._m[11]=0,S._m[12]=0,S._m[13]=0,S._m[14]=0,S._m[15]=1,S._markAsUpdated()}_markAsUpdated(){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const v=this._m;this._isIdentity=1===v[0]&&0===v[1]&&0===v[2]&&0===v[3]&&0===v[4]&&1===v[5]&&0===v[6]&&0===v[7]&&0===v[8]&&0===v[9]&&1===v[10]&&0===v[11]&&0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const v=this._m,S=v[0],A=v[1],E=v[2],R=v[3],O=v[4],M=v[5],B=v[6],W=v[7],H=v[8],V=v[9],X=v[10],Q=v[11],Z=v[12],K=v[13],J=v[14],$=v[15],et=X*$-J*Q,nt=V*$-K*Q,it=V*J-K*X,ot=H*$-Z*Q,rt=H*J-X*Z,st=H*K-Z*V;return S*+(M*et-B*nt+W*it)+A*-(O*et-B*ot+W*rt)+E*+(O*nt-M*ot+W*st)+R*-(O*it-M*rt+B*st)}toArray(){return this._m}asArray(){return this._m}invert(){return this.invertToRef(this),this}reset(){return Dt.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(v){const S=new Dt;return this.addToRef(v,S),S}addToRef(v,S){for(let A=0;A<16;A++)S._m[A]=this._m[A]+v._m[A];return S._markAsUpdated(),this}addToSelf(v){for(let S=0;S<16;S++)this._m[S]+=v._m[S];return this._markAsUpdated(),this}invertToRef(v){if(!0===this._isIdentity)return Dt.IdentityToRef(v),this;const S=this._m,A=S[0],E=S[1],R=S[2],O=S[3],M=S[4],B=S[5],W=S[6],H=S[7],V=S[8],X=S[9],Q=S[10],Z=S[11],K=S[12],J=S[13],$=S[14],et=S[15],nt=Q*et-$*Z,it=X*et-J*Z,ot=X*$-J*Q,rt=V*et-K*Z,st=V*$-Q*K,at=V*J-K*X,ht=+(B*nt-W*it+H*ot),ut=-(M*nt-W*rt+H*st),lt=+(M*it-B*rt+H*at),ct=-(M*ot-B*st+W*at),pt=A*ht+E*ut+R*lt+O*ct;if(0===pt)return v.copyFrom(this),this;const dt=1/pt,gt=W*et-$*H,yt=B*et-J*H,ft=B*$-J*W,vt=M*et-K*H,bt=M*$-K*W,Tt=M*J-K*B,xt=W*Z-Q*H,Ct=B*Z-X*H,wt=B*Q-X*W,St=M*Z-V*H,At=M*Q-V*W,_t=M*X-V*B,It=-(E*nt-R*it+O*ot),Rt=+(A*nt-R*rt+O*st),Pt=-(A*it-E*rt+O*at),Ot=+(A*ot-E*st+R*at),Nt=+(E*gt-R*yt+O*ft),zt=-(A*gt-R*vt+O*bt),Lt=+(A*yt-E*vt+O*Tt),Ft=-(A*ft-E*bt+R*Tt),kt=-(E*xt-R*Ct+O*wt),Bt=+(A*xt-R*St+O*At),Ut=-(A*Ct-E*St+O*_t),Wt=+(A*wt-E*At+R*_t);return Dt.FromValuesToRef(ht*dt,It*dt,Nt*dt,kt*dt,ut*dt,Rt*dt,zt*dt,Bt*dt,lt*dt,Pt*dt,Lt*dt,Ut*dt,ct*dt,Ot*dt,Ft*dt,Wt*dt,v),this}addAtIndex(v,S){return this._m[v]+=S,this._markAsUpdated(),this}multiplyAtIndex(v,S){return this._m[v]*=S,this._markAsUpdated(),this}setTranslationFromFloats(v,S,A){return this._m[12]=v,this._m[13]=S,this._m[14]=A,this._markAsUpdated(),this}setTranslation(v){return this.setTranslationFromFloats(v.x,v.y,v.z)}getTranslation(){return new Yt.Vector3(this._m[12],this._m[13],this._m[14])}getTranslationToRef(v){return v.x=this._m[12],v.y=this._m[13],v.z=this._m[14],this}removeRotationAndScaling(){const v=this.m;return Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v[12],v[13],v[14],v[15],this),this._updateIdentityStatus(0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]),this}multiply(v){const S=new Dt;return this.multiplyToRef(v,S),S}copyFrom(v){v.copyToArray(this._m);const S=v;return this._updateIdentityStatus(S._isIdentity,S._isIdentityDirty,S._isIdentity3x2,S._isIdentity3x2Dirty),this}copyToArray(v,S=0){for(let A=0;A<16;A++)v[S+A]=this._m[A];return this}multiplyToRef(v,S){return this._isIdentity?(S.copyFrom(v),this):v._isIdentity?(S.copyFrom(this),this):(this.multiplyToArray(v,S._m,0),S._markAsUpdated(),this)}multiplyToArray(v,S,A){const E=this._m,R=v.m,O=E[0],M=E[1],B=E[2],W=E[3],H=E[4],V=E[5],X=E[6],Q=E[7],Z=E[8],K=E[9],J=E[10],$=E[11],et=E[12],nt=E[13],it=E[14],ot=E[15],rt=R[0],st=R[1],at=R[2],ht=R[3],ut=R[4],lt=R[5],ct=R[6],pt=R[7],dt=R[8],gt=R[9],yt=R[10],ft=R[11],vt=R[12],bt=R[13],Tt=R[14],xt=R[15];return S[A]=O*rt+M*ut+B*dt+W*vt,S[A+1]=O*st+M*lt+B*gt+W*bt,S[A+2]=O*at+M*ct+B*yt+W*Tt,S[A+3]=O*ht+M*pt+B*ft+W*xt,S[A+4]=H*rt+V*ut+X*dt+Q*vt,S[A+5]=H*st+V*lt+X*gt+Q*bt,S[A+6]=H*at+V*ct+X*yt+Q*Tt,S[A+7]=H*ht+V*pt+X*ft+Q*xt,S[A+8]=Z*rt+K*ut+J*dt+$*vt,S[A+9]=Z*st+K*lt+J*gt+$*bt,S[A+10]=Z*at+K*ct+J*yt+$*Tt,S[A+11]=Z*ht+K*pt+J*ft+$*xt,S[A+12]=et*rt+nt*ut+it*dt+ot*vt,S[A+13]=et*st+nt*lt+it*gt+ot*bt,S[A+14]=et*at+nt*ct+it*yt+ot*Tt,S[A+15]=et*ht+nt*pt+it*ft+ot*xt,this}equals(v){const S=v;if(!S)return!1;if((this._isIdentity||S._isIdentity)&&!this._isIdentityDirty&&!S._isIdentityDirty)return this._isIdentity&&S._isIdentity;const A=this.m,E=S.m;return A[0]===E[0]&&A[1]===E[1]&&A[2]===E[2]&&A[3]===E[3]&&A[4]===E[4]&&A[5]===E[5]&&A[6]===E[6]&&A[7]===E[7]&&A[8]===E[8]&&A[9]===E[9]&&A[10]===E[10]&&A[11]===E[11]&&A[12]===E[12]&&A[13]===E[13]&&A[14]===E[14]&&A[15]===E[15]}clone(){const v=new Dt;return v.copyFrom(this),v}getClassName(){return"Matrix"}getHashCode(){let v=this._m[0]||0;for(let S=1;S<16;S++)v=397*v^(this._m[S]||0);return v}decompose(v,S,A){if(this._isIdentity)return A&&A.setAll(0),v&&v.setAll(1),S&&S.copyFromFloats(0,0,0,1),!0;const E=this._m;A&&A.copyFromFloats(E[12],E[13],E[14]);const R=v||Zt.MathTmp.Vector3[0];if(R.x=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]),R.y=Math.sqrt(E[4]*E[4]+E[5]*E[5]+E[6]*E[6]),R.z=Math.sqrt(E[8]*E[8]+E[9]*E[9]+E[10]*E[10]),this.determinant()<=0&&(R.y*=-1),0===R.x||0===R.y||0===R.z)return S&&S.copyFromFloats(0,0,0,1),!1;if(S){const v=1/R.x,A=1/R.y,O=1/R.z;Dt.FromValuesToRef(E[0]*v,E[1]*v,E[2]*v,0,E[4]*A,E[5]*A,E[6]*A,0,E[8]*O,E[9]*O,E[10]*O,0,0,0,0,1,Zt.MathTmp.Matrix[0]),Qt.Quaternion.FromRotationMatrixToRef(Zt.MathTmp.Matrix[0],S)}return!0}getRow(v){if(v<0||v>3)return null;const S=4*v;return new Kt.Vector4(this._m[S+0],this._m[S+1],this._m[S+2],this._m[S+3])}setRow(v,S){return this.setRowFromFloats(v,S.x,S.y,S.z,S.w)}transpose(){return Dt.Transpose(this)}transposeToRef(v){return Dt.TransposeToRef(this,v),this}setRowFromFloats(v,S,A,E,R){if(v<0||v>3)return this;const O=4*v;return this._m[O+0]=S,this._m[O+1]=A,this._m[O+2]=E,this._m[O+3]=R,this._markAsUpdated(),this}scale(v){const S=new Dt;return this.scaleToRef(v,S),S}scaleToRef(v,S){for(let A=0;A<16;A++)S._m[A]=this._m[A]*v;return S._markAsUpdated(),this}scaleAndAddToRef(v,S){for(let A=0;A<16;A++)S._m[A]+=this._m[A]*v;return S._markAsUpdated(),this}toNormalMatrix(v){const S=Zt.MathTmp.Matrix[0];this.invertToRef(S),S.transposeToRef(v);const A=v._m;Dt.FromValuesToRef(A[0],A[1],A[2],0,A[4],A[5],A[6],0,A[8],A[9],A[10],0,0,0,0,1,v)}getRotationMatrix(){const v=new Dt;return this.getRotationMatrixToRef(v),v}getRotationMatrixToRef(v){const S=Zt.MathTmp.Vector3[0];if(!this.decompose(S))return Dt.IdentityToRef(v),this;const A=this._m,E=1/S.x,R=1/S.y,O=1/S.z;return Dt.FromValuesToRef(A[0]*E,A[1]*E,A[2]*E,0,A[4]*R,A[5]*R,A[6]*R,0,A[8]*O,A[9]*O,A[10]*O,0,0,0,0,1,v),this}toggleModelMatrixHandInPlace(){const v=this._m;v[2]*=-1,v[6]*=-1,v[8]*=-1,v[9]*=-1,v[14]*=-1,this._markAsUpdated()}toggleProjectionMatrixHandInPlace(){const v=this._m;v[8]*=-1,v[9]*=-1,v[10]*=-1,v[11]*=-1,this._markAsUpdated()}_updateIdentityStatus(v,S=!1,A=!1,E=!0){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=v,this._isIdentity3x2=v||A,this._isIdentityDirty=!this._isIdentity&&S,this._isIdentity3x2Dirty=!this._isIdentity3x2&&E}}Ut.Matrix=Dt,Dt._updateFlagSeed=0,Dt._identityReadOnly=Dt.Identity(),Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.Quaternion=void 0;const Jt=Ut,$t=kt,ee=Lt,ne=zt,ie=Ht;class jt{constructor(v=0,S=0,A=0,E=1){this.x=v,this.y=S,this.z=A,this.w=E}static FromRotationMatrix(v){const S=new jt;return jt.FromRotationMatrixToRef(v,S),S}static FromRotationMatrixToRef(v,S){const A=v.m,E=A[0],R=A[4],O=A[8],M=A[1],B=A[5],W=A[9],H=A[2],V=A[6],X=A[10],Q=E+B+X;let Z;Q>0?(Z=.5/Math.sqrt(Q+1),S.w=.25/Z,S.x=(V-W)*Z,S.y=(O-H)*Z,S.z=(M-R)*Z):E>B&&E>X?(Z=2*Math.sqrt(1+E-B-X),S.w=(V-W)/Z,S.x=.25*Z,S.y=(R+M)/Z,S.z=(O+H)/Z):B>X?(Z=2*Math.sqrt(1+B-E-X),S.w=(O-H)/Z,S.x=(R+M)/Z,S.y=.25*Z,S.z=(W+V)/Z):(Z=2*Math.sqrt(1+X-E-B),S.w=(M-R)/Z,S.x=(O+H)/Z,S.y=(W+V)/Z,S.z=.25*Z)}static Dot(v,S){return v.x*S.x+v.y*S.y+v.z*S.z+v.w*S.w}static AreClose(v,S){return jt.Dot(v,S)>=0}static Zero(){return new jt(0,0,0,0)}static Inverse(v){return new jt(-v.x,-v.y,-v.z,v.w)}static IsIdentity(v){return v&&0===v.x&&0===v.y&&0===v.z&&1===v.w}static RotationAxis(v,S){const A=S*ne.DEG2RAD;return jt.RotationAxisToRef(v,A,new jt)}static RotationAxisToRef(v,S,A){const E=S*ne.DEG2RAD,R=Math.sin(E/2);return v.normalize(),A.w=Math.cos(E/2),A.x=v.x*R,A.y=v.y*R,A.z=v.z*R,A}static FromArray(v,S=0){return new jt(v[S],v[S+1],v[S+2],v[S+3])}static FromEulerAnglesRef(v,S,A,E){return jt.RotationYawPitchRollToRef(S*ne.DEG2RAD,v*ne.DEG2RAD,A*ne.DEG2RAD,E)}static RotationYawPitchRoll(v,S,A){const E=new jt;return jt.RotationYawPitchRollToRef(v,S,A,E),E}static RotationYawPitchRollToRef(v,S,A,E){const R=.5*S,O=.5*v,M=.5*A,B=Math.cos(R),W=Math.cos(O),H=Math.cos(M),V=Math.sin(R),X=Math.sin(O),Q=Math.sin(M);E.x=W*V*H+X*B*Q,E.y=X*B*H-W*V*Q,E.z=W*B*Q-X*V*H,E.w=W*B*H+X*V*Q}static RotationAlphaBetaGamma(v,S,A){const E=new jt;return jt.RotationAlphaBetaGammaToRef(v,S,A,E),E}static RotationAlphaBetaGammaToRef(v,S,A,E){const R=.5*(A+v),O=.5*(A-v),M=.5*S;E.x=Math.cos(O)*Math.sin(M),E.y=Math.sin(O)*Math.sin(M),E.z=Math.sin(R)*Math.cos(M),E.w=Math.cos(R)*Math.cos(M)}static RotationQuaternionFromAxis(v,S,A){const E=new jt(0,0,0,0);return jt.RotationQuaternionFromAxisToRef(v,S,A,E),E}static RotationQuaternionFromAxisToRef(v,S,A,E){const R=ee.MathTmp.Matrix[0];Jt.Matrix.FromXYZAxesToRef(v.normalize(),S.normalize(),A.normalize(),R),jt.FromRotationMatrixToRef(R,E)}static Slerp(v,S,A){const E=jt.Identity;return jt.SlerpToRef(v,S,A,E),E}static SlerpToRef(v,S,A,E){let R,O,M=v.x*S.x+v.y*S.y+v.z*S.z+v.w*S.w,B=!1;if(M<0&&(B=!0,M=-M),M>.999999)O=1-A,R=B?-A:A;else{const v=Math.acos(M),S=1/Math.sin(v);O=Math.sin((1-A)*v)*S,R=B?-Math.sin(A*v)*S:Math.sin(A*v)*S}E.x=O*v.x+R*S.x,E.y=O*v.y+R*S.y,E.z=O*v.z+R*S.z,E.w=O*v.w+R*S.w}static Hermite(v,S,A,E,R){const O=R*R,M=R*O,B=2*M-3*O+1,W=-2*M+3*O,H=M-2*O+R,V=M-O,X=v.x*B+A.x*W+S.x*H+E.x*V,Q=v.y*B+A.y*W+S.y*H+E.y*V,Z=v.z*B+A.z*W+S.z*H+E.z*V,K=v.w*B+A.w*W+S.w*H+E.w*V;return new jt(X,Q,Z,K)}static get Identity(){return new jt(0,0,0,1)}static Angle(v,S){const A=jt.Dot(v,S);return 2*Math.acos(Math.min(Math.abs(A),1))*ne.RAD2DEG}static Euler(v,S,A){return jt.RotationYawPitchRoll(S*ne.DEG2RAD,v*ne.DEG2RAD,A*ne.DEG2RAD)}static LookRotation(v,S=ee.MathTmp.staticUp){const A=$t.Vector3.Normalize(v),E=$t.Vector3.Normalize($t.Vector3.Cross(S,A)),R=$t.Vector3.Cross(A,E),O=E.x,M=E.y,B=E.z,W=R.x,H=R.y,V=R.z,X=A.x,Q=A.y,Z=A.z,K=O+H+Z,J=new jt;if(K>0){let v=Math.sqrt(K+1);return J.w=.5*v,v=.5/v,J.x=(V-Q)*v,J.y=(X-B)*v,J.z=(M-W)*v,J}if(O>=H&&O>=Z){const v=Math.sqrt(1+O-H-Z),S=.5/v;return J.x=.5*v,J.y=(M+W)*S,J.z=(B+X)*S,J.w=(V-Q)*S,J}if(H>Z){const v=Math.sqrt(1+H-O-Z),S=.5/v;return J.x=(W+M)*S,J.y=.5*v,J.z=(Q+V)*S,J.w=(X-B)*S,J}const $=Math.sqrt(1+Z-O-H),et=.5/$;return J.x=(X+B)*et,J.y=(Q+V)*et,J.z=.5*$,J.w=(M-W)*et,J}static RotateTowards(v,S,A){const E=jt.Angle(v,S);if(0===E)return S;const R=Math.min(1,A/E);return jt.Slerp(v,S,R)}static FromToRotation(v,S,A=ee.MathTmp.staticUp){const E=v.normalize(),R=S.normalize(),O=$t.Vector3.Cross(E,R),M=Math.sqrt(E.lengthSquared()*R.lengthSquared())+$t.Vector3.Dot(E,R);return O.lengthSquared()<1e-4?Math.abs(M)<1e-4?new jt(A.x,A.y,A.z,0).normalized:jt.Identity:new jt(O.x,O.y,O.z,M).normalized}get normalized(){return this.normalize()}setFromToRotation(v,S,A=ee.MathTmp.staticUp){const E=jt.FromToRotation(v,S,A);this.x=E.x,this.y=E.y,this.z=E.z,this.w=E.w}set eulerAngles(v){this.setEuler(v.x,v.y,v.z)}get eulerAngles(){const v=new $t.Vector3,S=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w,A=this.x*this.w-this.y*this.z;return A>.4995*S?(v.x=Math.PI/2,v.y=2*Math.atan2(this.y,this.x),v.z=0):A<-.4995*S?(v.x=-Math.PI/2,v.y=-2*Math.atan2(this.y,this.x),v.z=0):(v.x=Math.asin(2*(this.w*this.x-this.y*this.z)),v.y=Math.atan2(2*this.w*this.y+2*this.z*this.x,1-2*(this.x*this.x+this.y*this.y)),v.z=Math.atan2(2*this.w*this.z+2*this.x*this.y,1-2*(this.z*this.z+this.x*this.x))),v.x*=ne.RAD2DEG,v.y*=ne.RAD2DEG,v.z*=ne.RAD2DEG,v.x=ie.Scalar.Repeat(v.x,360),v.y=ie.Scalar.Repeat(v.y,360),v.z=ie.Scalar.Repeat(v.z,360),v}toString(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`}get length(){return Math.sqrt(this.lengthSquared)}get lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}getClassName(){return"Quaternion"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){return[this.x,this.y,this.z,this.w]}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}clone(){return new jt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,S,A,E){return this.x=v,this.y=S,this.z=A,this.w=E,this}set(v,S,A,E){return this.copyFromFloats(v,S,A,E)}setEuler(v,S,A){return jt.RotationYawPitchRollToRef(S*ne.DEG2RAD,v*ne.DEG2RAD,A*ne.DEG2RAD,this),this}add(v){return new jt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}subtract(v){return new jt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}scale(v){return new jt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,S){return S.x=this.x*v,S.y=this.y*v,S.z=this.z*v,S.w=this.w*v,this}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scaleAndAddToRef(v,S){return S.x+=this.x*v,S.y+=this.y*v,S.z+=this.z*v,S.w+=this.w*v,this}multiply(v){const S=new jt(0,0,0,1);return this.multiplyToRef(v,S),S}multiplyToRef(v,S){const A=this.x*v.w+this.y*v.z-this.z*v.y+this.w*v.x,E=-this.x*v.z+this.y*v.w+this.z*v.x+this.w*v.y,R=this.x*v.y-this.y*v.x+this.z*v.w+this.w*v.z,O=-this.x*v.x-this.y*v.y-this.z*v.z+this.w*v.w;return S.copyFromFloats(A,E,R,O),this}multiplyInPlace(v){return this.multiplyToRef(v,this),this}conjugateToRef(v){return v.copyFromFloats(-this.x,-this.y,-this.z,this.w),this}conjugateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this}conjugate(){return new jt(-this.x,-this.y,-this.z,this.w)}normalize(){const v=1/this.length;return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}angleAxis(v,S){if(0===S.lengthSquared())return jt.Identity;const A=jt.Identity;let E=v*ne.DEG2RAD;E*=.5;let R=S.normalize();return R=S.scaleInPlace(Math.sin(E)),A.x=R.x,A.y=R.y,A.z=R.z,A.w=Math.cos(E),A.normalize()}toRotationMatrix(v){return Jt.Matrix.FromQuaternionToRef(this,v),this}fromRotationMatrix(v){return jt.FromRotationMatrixToRef(v,this),this}}Bt.Quaternion=jt,Object.defineProperty(kt,"__esModule",{value:!0}),kt.Vector3=void 0;const oe=Lt,se=zt,ae=Bt,he=Ht;class Xt{constructor(v=0,S=0,A=0){this.x=v,this.y=S,this.z=A}get isNonUniform(){const v=Math.abs(this.x),S=Math.abs(this.y);if(v!==S)return!0;const A=Math.abs(this.z);return v!==A||S!==A}static Add(v,S){return new Xt(v.x,v.y,v.z).addInPlace(S)}static GetClipFactor(v,S,A,E){const R=Xt.Dot(v,A)-E;return R/(R-(Xt.Dot(S,A)-E))}static GetAngleBetweenVectors(v,S,A){const E=v.normalizeToRef(oe.MathTmp.Vector3[1]),R=S.normalizeToRef(oe.MathTmp.Vector3[2]),O=Xt.Dot(E,R),M=oe.MathTmp.Vector3[3];return Xt.CrossToRef(E,R,M),Xt.Dot(M,A)>0?Math.acos(O):-Math.acos(O)}static FromArray(v,S=0){return new Xt(v[S],v[S+1],v[S+2])}static FromFloatArray(v,S){return Xt.FromArray(v,S)}static FromArrayToRef(v,S,A){A.x=v[S],A.y=v[S+1],A.z=v[S+2]}static FromFloatArrayToRef(v,S,A){return Xt.FromArrayToRef(v,S,A)}static FromFloatsToRef(v,S,A,E){E.copyFromFloats(v,S,A)}static Zero(){return new Xt(0,0,0)}static One(){return new Xt(1,1,1)}static Up(){return new Xt(0,1,0)}static Down(){return new Xt(0,-1,0)}static Forward(){return new Xt(0,0,1)}static Backward(){return new Xt(0,0,-1)}static Right(){return new Xt(1,0,0)}static Left(){return new Xt(-1,0,0)}static TransformCoordinates(v,S){const A=Xt.Zero();return Xt.TransformCoordinatesToRef(v,S,A),A}static TransformCoordinatesToRef(v,S,A){return Xt.TransformCoordinatesFromFloatsToRef(v.x,v.y,v.z,S,A)}static TransformCoordinatesFromFloatsToRef(v,S,A,E,R){const O=E.m,M=v*O[0]+S*O[4]+A*O[8]+O[12],B=v*O[1]+S*O[5]+A*O[9]+O[13],W=v*O[2]+S*O[6]+A*O[10]+O[14],H=1/(v*O[3]+S*O[7]+A*O[11]+O[15]);R.x=M*H,R.y=B*H,R.z=W*H}static TransformNormal(v,S){const A=Xt.Zero();return Xt.TransformNormalToRef(v,S,A),A}static TransformNormalToRef(v,S,A){this.TransformNormalFromFloatsToRef(v.x,v.y,v.z,S,A)}static TransformNormalFromFloatsToRef(v,S,A,E,R){const O=E.m;R.x=v*O[0]+S*O[4]+A*O[8],R.y=v*O[1]+S*O[5]+A*O[9],R.z=v*O[2]+S*O[6]+A*O[10]}static CatmullRom(v,S,A,E,R){const O=R*R,M=R*O,B=.5*(2*S.x+(-v.x+A.x)*R+(2*v.x-5*S.x+4*A.x-E.x)*O+(-v.x+3*S.x-3*A.x+E.x)*M),W=.5*(2*S.y+(-v.y+A.y)*R+(2*v.y-5*S.y+4*A.y-E.y)*O+(-v.y+3*S.y-3*A.y+E.y)*M),H=.5*(2*S.z+(-v.z+A.z)*R+(2*v.z-5*S.z+4*A.z-E.z)*O+(-v.z+3*S.z-3*A.z+E.z)*M);return new Xt(B,W,H)}static Clamp(v,S,A){const E=new Xt;return Xt.ClampToRef(v,S,A,E),E}static ClampToRef(v,S,A,E){let R=v.x;R=R>A.x?A.x:R,R=R<S.x?S.x:R;let O=v.y;O=O>A.y?A.y:O,O=O<S.y?S.y:O;let M=v.z;M=M>A.z?A.z:M,M=M<S.z?S.z:M,E.copyFromFloats(R,O,M)}static Hermite(v,S,A,E,R){const O=R*R,M=R*O,B=2*M-3*O+1,W=-2*M+3*O,H=M-2*O+R,V=M-O,X=v.x*B+A.x*W+S.x*H+E.x*V,Q=v.y*B+A.y*W+S.y*H+E.y*V,Z=v.z*B+A.z*W+S.z*H+E.z*V;return new Xt(X,Q,Z)}static Lerp(v,S,A){const E=new Xt(0,0,0);return Xt.LerpToRef(v,S,A,E),E}static LerpToRef(v,S,A,E){E.x=v.x+(S.x-v.x)*A,E.y=v.y+(S.y-v.y)*A,E.z=v.z+(S.z-v.z)*A}static Dot(v,S){return v.x*S.x+v.y*S.y+v.z*S.z}static Cross(v,S){const A=Xt.Zero();return Xt.CrossToRef(v,S,A),A}static CrossToRef(v,S,A){const E=v.y*S.z-v.z*S.y,R=v.z*S.x-v.x*S.z,O=v.x*S.y-v.y*S.x;A.copyFromFloats(E,R,O)}static Normalize(v){const S=Xt.Zero();return Xt.NormalizeToRef(v,S),S}static NormalizeToRef(v,S){v.normalizeToRef(S)}static Minimize(v,S){const A=new Xt(v.x,v.y,v.z);return A.minimizeInPlace(S),A}static Maximize(v,S){const A=new Xt(v.x,v.y,v.z);return A.maximizeInPlace(S),A}static Distance(v,S){return Math.sqrt(Xt.DistanceSquared(v,S))}static DistanceSquared(v,S){const A=v.x-S.x,E=v.y-S.y,R=v.z-S.z;return A*A+E*E+R*R}static Center(v,S){const A=Xt.Add(v,S);return A.scaleInPlace(.5),A}static RotationFromAxis(v,S,A){const E=Xt.Zero();return Xt.RotationFromAxisToRef(v,S,A,E),E}static RotationFromAxisToRef(v,S,A,E){const R=oe.MathTmp.Quaternion[0];ae.Quaternion.RotationQuaternionFromAxisToRef(v,S,A,R),E.copyFrom(R.eulerAngles)}toString(){return`(${this.x}, ${this.y}, ${this.z})`}getClassName(){return"Vector3"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v}asArray(){const v=[];return this.toArray(v,0),v}toArray(v,S=0){return v[S]=this.x,v[S+1]=this.y,v[S+2]=this.z,this}toQuaternion(){return ae.Quaternion.Identity.setEuler(this.y,this.x,this.z)}addInPlace(v){return this.addInPlaceFromFloats(v.x,v.y,v.z)}addInPlaceFromFloats(v,S,A){return this.x+=v,this.y+=S,this.z+=A,this}add(v){return new Xt(this.x+v.x,this.y+v.y,this.z+v.z)}addToRef(v,S){return S.copyFromFloats(this.x+v.x,this.y+v.y,this.z+v.z)}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this}subtract(v){return new Xt(this.x-v.x,this.y-v.y,this.z-v.z)}subtractToRef(v,S){return this.subtractFromFloatsToRef(v.x,v.y,v.z,S)}subtractFromFloats(v,S,A){return new Xt(this.x-v,this.y-S,this.z-A)}subtractFromFloatsToRef(v,S,A,E){return E.copyFromFloats(this.x-v,this.y-S,this.z-A)}applyMatrix4(v){this.applyMatrix4ToRef(v,this)}applyMatrix4ToRef(v,S){const{x:A,y:E,z:R}=this,{m:O}=v,M=1/(O[3]*A+O[7]*E+O[11]*R+O[15]);return S.x=(O[0]*A+O[4]*E+O[8]*R+O[12])*M,S.y=(O[1]*A+O[5]*E+O[9]*R+O[13])*M,S.z=(O[2]*A+O[6]*E+O[10]*R+O[14])*M,S}rotate(v){return this.rotateToRef(v,this)}rotateToRef(v,S){const{x:A,y:E,z:R}=this,{x:O,y:M,z:B,w:W}=v,H=W*A+M*R-B*E,V=W*E+B*A-O*R,X=W*R+O*E-M*A,Q=-O*A-M*E-B*R;return S.x=H*W+Q*-O+V*-B-X*-M,S.y=V*W+Q*-M+X*-O-H*-B,S.z=X*W+Q*-B+H*-M-V*-O,S}negate(){return new Xt(-this.x,-this.y,-this.z)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this}scale(v){return new Xt(this.x*v,this.y*v,this.z*v)}scaleToRef(v,S){return S.copyFromFloats(this.x*v,this.y*v,this.z*v)}scaleAndAddToRef(v,S){return S.addInPlaceFromFloats(this.x*v,this.y*v,this.z*v)}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z}equalsWithEpsilon(v,S=se.Epsilon){return v&&he.Scalar.WithinEpsilon(this.x,v.x,S)&&he.Scalar.WithinEpsilon(this.y,v.y,S)&&he.Scalar.WithinEpsilon(this.z,v.z,S)}equalsToFloats(v,S,A){return this.x===v&&this.y===S&&this.z===A}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this}multiply(v){return this.multiplyByFloats(v.x,v.y,v.z)}multiplyToRef(v,S){return S.copyFromFloats(this.x*v.x,this.y*v.y,this.z*v.z)}multiplyByFloats(v,S,A){return new Xt(this.x*v,this.y*S,this.z*A)}divide(v){return new Xt(this.x/v.x,this.y/v.y,this.z/v.z)}divideToRef(v,S){return S.copyFromFloats(this.x/v.x,this.y/v.y,this.z/v.z)}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return this.minimizeInPlaceFromFloats(v.x,v.y,v.z)}maximizeInPlace(v){return this.maximizeInPlaceFromFloats(v.x,v.y,v.z)}minimizeInPlaceFromFloats(v,S,A){return v<this.x&&(this.x=v),S<this.y&&(this.y=S),A<this.z&&(this.z=A),this}maximizeInPlaceFromFloats(v,S,A){return v>this.x&&(this.x=v),S>this.y&&(this.y=S),A>this.z&&(this.z=A),this}floor(){return new Xt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fract(){return new Xt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(v){return 0===v||1===v?this:this.scaleInPlace(1/v)}normalizeToNew(){const v=new Xt(0,0,0);return this.normalizeToRef(v),v}normalizeToRef(v){const S=this.length();return 0===S||1===S?v.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/S,v)}clone(){return new Xt(this.x,this.y,this.z)}copyFrom(v){return this.copyFromFloats(v.x,v.y,v.z)}copyFromFloats(v,S,A){return this.x=v,this.y=S,this.z=A,this}set(v,S,A){return this.copyFromFloats(v,S,A)}setAll(v){return this.x=this.y=this.z=v,this}}kt.Vector3=Xt,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.MathTmp=void 0;const ue=Ft,le=kt,ce=Bt,de=Ut;Lt.MathTmp={Vector3:(0,ue.buildArray)(6,le.Vector3.Zero),Matrix:(0,ue.buildArray)(2,de.Matrix.Identity),Quaternion:(0,ue.buildArray)(3,ce.Quaternion.Zero),staticUp:le.Vector3.Up(),tmpMatrix:de.Matrix.Zero()};var ye={};Object.defineProperty(ye,"__esModule",{value:!0}),ye.Angle=void 0;class te{constructor(v){this._radians=v,this._radians<0&&(this._radians+=2*Math.PI)}static BetweenTwoPoints(v,S){const A=S.subtract(v),E=Math.atan2(A.y,A.x);return new te(E)}static FromRadians(v){return new te(v)}static FromDegrees(v){return new te(v*Math.PI/180)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}}ye.Angle=te;var fe={},me={};Object.defineProperty(me,"__esModule",{value:!0}),me.Vector2=void 0;const ve=zt,be=Ht;class re{constructor(v=0,S=0){this.x=v,this.y=S}static Zero(){return new re(0,0)}static One(){return new re(1,1)}static Add(v,S){return new re(v.x,v.y).addInPlace(S)}static FromArray(v,S=0){return new re(v[S],v[S+1])}static FromArrayToRef(v,S,A){A.x=v[S],A.y=v[S+1]}static CatmullRom(v,S,A,E,R){const O=R*R,M=R*O,B=.5*(2*S.x+(-v.x+A.x)*R+(2*v.x-5*S.x+4*A.x-E.x)*O+(-v.x+3*S.x-3*A.x+E.x)*M),W=.5*(2*S.y+(-v.y+A.y)*R+(2*v.y-5*S.y+4*A.y-E.y)*O+(-v.y+3*S.y-3*A.y+E.y)*M);return new re(B,W)}static Clamp(v,S,A){let E=v.x;E=E>A.x?A.x:E,E=E<S.x?S.x:E;let R=v.y;return R=R>A.y?A.y:R,R=R<S.y?S.y:R,new re(E,R)}static Hermite(v,S,A,E,R){const O=R*R,M=R*O,B=2*M-3*O+1,W=-2*M+3*O,H=M-2*O+R,V=M-O,X=v.x*B+A.x*W+S.x*H+E.x*V,Q=v.y*B+A.y*W+S.y*H+E.y*V;return new re(X,Q)}static Lerp(v,S,A){const E=v.x+(S.x-v.x)*A,R=v.y+(S.y-v.y)*A;return new re(E,R)}static Dot(v,S){return v.x*S.x+v.y*S.y}static Normalize(v){const S=new re(v.x,v.y);return S.normalize(),S}static Minimize(v,S){const A=v.x<S.x?v.x:S.x,E=v.y<S.y?v.y:S.y;return new re(A,E)}static Maximize(v,S){const A=v.x>S.x?v.x:S.x,E=v.y>S.y?v.y:S.y;return new re(A,E)}static Transform(v,S){const A=re.Zero();return re.TransformToRef(v,S,A),A}static TransformToRef(v,S,A){const E=S.m,R=v.x*E[0]+v.y*E[4]+E[12],O=v.x*E[1]+v.y*E[5]+E[13];A.x=R,A.y=O}static PointInTriangle(v,S,A,E){const R=.5*(-A.y*E.x+S.y*(-A.x+E.x)+S.x*(A.y-E.y)+A.x*E.y),O=R<0?-1:1,M=(S.y*E.x-S.x*E.y+(E.y-S.y)*v.x+(S.x-E.x)*v.y)*O,B=(S.x*A.y-S.y*A.x+(S.y-A.y)*v.x+(A.x-S.x)*v.y)*O;return M>0&&B>0&&M+B<2*R*O}static Distance(v,S){return Math.sqrt(re.DistanceSquared(v,S))}static DistanceSquared(v,S){const A=v.x-S.x,E=v.y-S.y;return A*A+E*E}static Center(v,S){const A=re.Add(v,S);return A.scaleInPlace(.5),A}static DistanceOfPointFromSegment(v,S,A){const E=re.DistanceSquared(S,A);if(0===E)return re.Distance(v,S);const R=A.subtract(S),O=Math.max(0,Math.min(1,re.Dot(v.subtract(S),R)/E)),M=S.add(R.multiplyByFloats(O,O));return re.Distance(v,M)}toString(){return"{X: "+this.x+" Y:"+this.y+"}"}getClassName(){return"Vector2"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v}toArray(v,S=0){return v[S]=this.x,v[S+1]=this.y,this}asArray(){const v=new Array;return this.toArray(v,0),v}copyFrom(v){return this.x=v.x,this.y=v.y,this}copyFromFloats(v,S){return this.x=v,this.y=S,this}set(v,S){return this.copyFromFloats(v,S)}add(v){return new re(this.x+v.x,this.y+v.y)}addToRef(v,S){return S.x=this.x+v.x,S.y=this.y+v.y,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this}addVector3(v){return new re(this.x+v.x,this.y+v.y)}subtract(v){return new re(this.x-v.x,this.y-v.y)}subtractToRef(v,S){return S.x=this.x-v.x,S.y=this.y-v.y,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this}multiply(v){return new re(this.x*v.x,this.y*v.y)}multiplyToRef(v,S){return S.x=this.x*v.x,S.y=this.y*v.y,this}multiplyByFloats(v,S){return new re(this.x*v,this.y*S)}divide(v){return new re(this.x/v.x,this.y/v.y)}divideToRef(v,S){return S.x=this.x/v.x,S.y=this.y/v.y,this}divideInPlace(v){return this.divideToRef(v,this)}negate(){return new re(-this.x,-this.y)}scaleInPlace(v){return this.x*=v,this.y*=v,this}scale(v){const S=new re(0,0);return this.scaleToRef(v,S),S}scaleToRef(v,S){return S.x=this.x*v,S.y=this.y*v,this}scaleAndAddToRef(v,S){return S.x+=this.x*v,S.y+=this.y*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y}equalsWithEpsilon(v,S=ve.Epsilon){return v&&be.Scalar.WithinEpsilon(this.x,v.x,S)&&be.Scalar.WithinEpsilon(this.y,v.y,S)}floor(){return new re(Math.floor(this.x),Math.floor(this.y))}fract(){return new re(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){const v=this.length();if(0===v)return this;const S=1/v;return this.x*=S,this.y*=S,this}clone(){return new re(this.x,this.y)}}me.Vector2=re,Object.defineProperty(fe,"__esModule",{value:!0}),fe.Arc2=void 0;const Te=ye,Ce=me,we=zt;fe.Arc2=class{constructor(v,S,A){this.startPoint=v,this.midPoint=S,this.endPoint=A;const E=Math.pow(S.x,2)+Math.pow(S.y,2),R=(Math.pow(v.x,2)+Math.pow(v.y,2)-E)/2,O=(E-Math.pow(A.x,2)-Math.pow(A.y,2))/2,M=(v.x-S.x)*(S.y-A.y)-(S.x-A.x)*(v.y-S.y);this.centerPoint=new Ce.Vector2((R*(S.y-A.y)-O*(v.y-S.y))/M,((v.x-S.x)*O-(S.x-A.x)*R)/M),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=Te.Angle.BetweenTwoPoints(this.centerPoint,this.startPoint);const B=this.startAngle.degrees();let W=Te.Angle.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),H=Te.Angle.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();W-B>180&&(W-=360),W-B<-180&&(W+=360),H-W>180&&(H-=360),H-W<-180&&(H+=360),this.orientation=W-B<0?we.Orientation.CW:we.Orientation.CCW,this.angle=Te.Angle.FromDegrees(this.orientation===we.Orientation.CW?B-H:H-B)}};var Se={};Object.defineProperty(Se,"__esModule",{value:!0}),Se.Axis=void 0;const _e=kt;class pe{}Se.Axis=pe,pe.X=new _e.Vector3(1,0,0),pe.Y=new _e.Vector3(0,1,0),pe.Z=new _e.Vector3(0,0,1);var Ee={};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.BezierCurve=void 0,Ee.BezierCurve=class{static Interpolate(v,S,A,E,R){const O=1-3*E+3*S,M=3*E-6*S,B=3*S;let W=v;for(let S=0;S<5;S++){const S=W*W;W-=1/(3*O*S+2*M*W+B)*(O*(S*W)+M*S+B*W-v),W=Math.min(1,Math.max(0,W))}return 3*Math.pow(1-W,2)*W*A+3*(1-W)*Math.pow(W,2)*R+Math.pow(W,3)}};var Ie={},Re={};Object.defineProperty(Re,"__esModule",{value:!0}),Re.Color4=void 0;const Pe=Ht,Oe=zt;class ge{constructor(v=0,S=0,A=0,E=1){this.r=v,this.g=S,this.b=A,this.a=E}static FromHexString(v){if("#"!==v.substring(0,1)||9!==v.length)return new ge(0,0,0,0);const S=parseInt(v.substring(1,3),16),A=parseInt(v.substring(3,5),16),E=parseInt(v.substring(5,7),16),R=parseInt(v.substring(7,9),16);return ge.FromInts(S,A,E,R)}static Lerp(v,S,A){const E=new ge(0,0,0,0);return ge.LerpToRef(v,S,A,E),E}static LerpToRef(v,S,A,E){E.r=v.r+(S.r-v.r)*A,E.g=v.g+(S.g-v.g)*A,E.b=v.b+(S.b-v.b)*A,E.a=v.a+(S.a-v.a)*A}static Red(){return new ge(1,0,0,1)}static Green(){return new ge(0,1,0,1)}static Blue(){return new ge(0,0,1,1)}static Black(){return new ge(0,0,0,1)}static White(){return new ge(1,1,1,1)}static Purple(){return new ge(.5,0,.5,1)}static Magenta(){return new ge(1,0,1,1)}static Yellow(){return new ge(1,1,0,1)}static Gray(){return new ge(.5,.5,.5,1)}static Teal(){return new ge(0,1,1,1)}static Clear(){return new ge(0,0,0,0)}static FromColor3(v,S=1){return new ge(v.r,v.g,v.b,S)}static FromArray(v,S=0){return new ge(v[S],v[S+1],v[S+2],v[S+3])}static FromInts(v,S,A,E){return new ge(v/255,S/255,A/255,E/255)}static CheckColors4(v,S){if(v.length===3*S){const S=[];for(let A=0;A<v.length;A+=3){const E=A/3*4;S[E]=v[A],S[E+1]=v[A+1],S[E+2]=v[A+2],S[E+3]=1}return S}return v}addInPlace(v){return this.r+=v.r,this.g+=v.g,this.b+=v.b,this.a+=v.a,this}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,S=0){return v[S]=this.r,v[S+1]=this.g,v[S+2]=this.b,v[S+3]=this.a,this}add(v){return new ge(this.r+v.r,this.g+v.g,this.b+v.b,this.a+v.a)}subtract(v){return new ge(this.r-v.r,this.g-v.g,this.b-v.b,this.a-v.a)}subtractToRef(v,S){return S.r=this.r-v.r,S.g=this.g-v.g,S.b=this.b-v.b,S.a=this.a-v.a,this}scale(v){return new ge(this.r*v,this.g*v,this.b*v,this.a*v)}scaleToRef(v,S){return S.r=this.r*v,S.g=this.g*v,S.b=this.b*v,S.a=this.a*v,this}scaleAndAddToRef(v,S){return S.r+=this.r*v,S.g+=this.g*v,S.b+=this.b*v,S.a+=this.a*v,this}clampToRef(v=0,S=1,A){return A.r=Pe.Scalar.Clamp(this.r,v,S),A.g=Pe.Scalar.Clamp(this.g,v,S),A.b=Pe.Scalar.Clamp(this.b,v,S),A.a=Pe.Scalar.Clamp(this.a,v,S),this}multiply(v){return new ge(this.r*v.r,this.g*v.g,this.b*v.b,this.a*v.a)}multiplyToRef(v,S){return S.r=this.r*v.r,S.g=this.g*v.g,S.b=this.b*v.b,S.a=this.a*v.a,S}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v=397*v^(this.a||0),v}clone(){return new ge(this.r,this.g,this.b,this.a)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this.a=v.a,this}copyFromFloats(v,S,A,E){return this.r=v,this.g=S,this.b=A,this.a=E,this}set(v,S,A,E){return this.copyFromFloats(v,S,A,E)}toHexString(){const v=255*this.r|0,S=255*this.g|0,A=255*this.b|0,E=255*this.a|0;return"#"+Pe.Scalar.ToHex(v)+Pe.Scalar.ToHex(S)+Pe.Scalar.ToHex(A)+Pe.Scalar.ToHex(E)}toLinearSpace(){const v=new ge;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Oe.ToLinearSpace),v.g=Math.pow(this.g,Oe.ToLinearSpace),v.b=Math.pow(this.b,Oe.ToLinearSpace),v.a=this.a,this}toGammaSpace(){const v=new ge;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Oe.ToGammaSpace),v.g=Math.pow(this.g,Oe.ToGammaSpace),v.b=Math.pow(this.b,Oe.ToGammaSpace),v.a=this.a,this}}Re.Color4=ge,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.Color3=void 0;const Ne=zt,Le=Re,Fe=Ht;class xe{constructor(v=0,S=0,A=0){this.r=v,this.g=S,this.b=A}static FromHexString(v){if("#"!==v.substring(0,1)||7!==v.length)return new xe(0,0,0);const S=parseInt(v.substring(1,3),16),A=parseInt(v.substring(3,5),16),E=parseInt(v.substring(5,7),16);return xe.FromInts(S,A,E)}static FromArray(v,S=0){return new xe(v[S],v[S+1],v[S+2])}static FromInts(v,S,A){return new xe(v/255,S/255,A/255)}static Lerp(v,S,A){const E=new xe(0,0,0);return xe.LerpToRef(v,S,A,E),E}static LerpToRef(v,S,A,E){E.r=v.r+(S.r-v.r)*A,E.g=v.g+(S.g-v.g)*A,E.b=v.b+(S.b-v.b)*A}static Red(){return new xe(1,0,0)}static Green(){return new xe(0,1,0)}static Blue(){return new xe(0,0,1)}static Black(){return new xe(0,0,0)}static White(){return new xe(1,1,1)}static Purple(){return new xe(.5,0,.5)}static Magenta(){return new xe(1,0,1)}static Yellow(){return new xe(1,1,0)}static Gray(){return new xe(.5,.5,.5)}static Teal(){return new xe(0,1,1)}static Random(){return new xe(Math.random(),Math.random(),Math.random())}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v}toArray(v,S=0){return v[S]=this.r,v[S+1]=this.g,v[S+2]=this.b,this}toColor4(v=1){return new Le.Color4(this.r,this.g,this.b,v)}asArray(){const v=new Array;return this.toArray(v,0),v}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(v){return new xe(this.r*v.r,this.g*v.g,this.b*v.b)}multiplyToRef(v,S){return S.r=this.r*v.r,S.g=this.g*v.g,S.b=this.b*v.b,this}equals(v){return v&&this.r===v.r&&this.g===v.g&&this.b===v.b}equalsFloats(v,S,A){return this.r===v&&this.g===S&&this.b===A}scale(v){return new xe(this.r*v,this.g*v,this.b*v)}scaleToRef(v,S){return S.r=this.r*v,S.g=this.g*v,S.b=this.b*v,this}scaleAndAddToRef(v,S){return S.r+=this.r*v,S.g+=this.g*v,S.b+=this.b*v,this}clampToRef(v=0,S=1,A){return A.r=Fe.Scalar.Clamp(this.r,v,S),A.g=Fe.Scalar.Clamp(this.g,v,S),A.b=Fe.Scalar.Clamp(this.b,v,S),this}add(v){return new xe(this.r+v.r,this.g+v.g,this.b+v.b)}addToRef(v,S){return S.r=this.r+v.r,S.g=this.g+v.g,S.b=this.b+v.b,this}subtract(v){return new xe(this.r-v.r,this.g-v.g,this.b-v.b)}subtractToRef(v,S){return S.r=this.r-v.r,S.g=this.g-v.g,S.b=this.b-v.b,this}clone(){return new xe(this.r,this.g,this.b)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this}copyFromFloats(v,S,A){return this.r=v,this.g=S,this.b=A,this}set(v,S,A){return this.copyFromFloats(v,S,A)}toHexString(){const v=255*this.r|0,S=255*this.g|0,A=255*this.b|0;return"#"+Fe.Scalar.ToHex(v)+Fe.Scalar.ToHex(S)+Fe.Scalar.ToHex(A)}toLinearSpace(){const v=new xe;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Ne.ToLinearSpace),v.g=Math.pow(this.g,Ne.ToLinearSpace),v.b=Math.pow(this.b,Ne.ToLinearSpace),this}toGammaSpace(){const v=new xe;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Ne.ToGammaSpace),v.g=Math.pow(this.g,Ne.ToGammaSpace),v.b=Math.pow(this.b,Ne.ToGammaSpace),this}toJSON(){return{r:this.r,g:this.g,b:this.b}}}Ie.Color3=xe;var ke={};Object.defineProperty(ke,"__esModule",{value:!0}),ke.Curve3=void 0;const Be=kt;class Ae{constructor(v){this._length=0,this._points=v,this._length=this._computeLength(v)}static CreateQuadraticBezier(v,S,A,E){E=E>2?E:3;const R=new Array,r=(v,S,A,E)=>(1-v)*(1-v)*S+2*v*(1-v)*A+v*v*E;for(let O=0;O<=E;O++)R.push(new Be.Vector3(r(O/E,v.x,S.x,A.x),r(O/E,v.y,S.y,A.y),r(O/E,v.z,S.z,A.z)));return new Ae(R)}static CreateCubicBezier(v,S,A,E,R){R=R>3?R:4;const O=new Array,s=(v,S,A,E,R)=>(1-v)*(1-v)*(1-v)*S+3*v*(1-v)*(1-v)*A+3*v*v*(1-v)*E+v*v*v*R;for(let M=0;M<=R;M++)O.push(new Be.Vector3(s(M/R,v.x,S.x,A.x,E.x),s(M/R,v.y,S.y,A.y,E.y),s(M/R,v.z,S.z,A.z,E.z)));return new Ae(O)}static CreateHermiteSpline(v,S,A,E,R){const O=new Array,M=1/R;for(let B=0;B<=R;B++)O.push(Be.Vector3.Hermite(v,S,A,E,B*M));return new Ae(O)}static CreateCatmullRomSpline(v,S,A){const E=new Array,R=1/S;let O=0;if(A){const A=v.length;for(let M=0;M<A;M++){O=0;for(let B=0;B<S;B++)E.push(Be.Vector3.CatmullRom(v[M%A],v[(M+1)%A],v[(M+2)%A],v[(M+3)%A],O)),O+=R}E.push(E[0])}else{const A=new Array;A.push(v[0].clone()),Array.prototype.push.apply(A,v),A.push(v[v.length-1].clone());let M=0;for(M=0;M<A.length-3;M++){O=0;for(let v=0;v<S;v++)E.push(Be.Vector3.CatmullRom(A[M],A[M+1],A[M+2],A[M+3],O)),O+=R}M--,E.push(Be.Vector3.CatmullRom(A[M],A[M+1],A[M+2],A[M+3],O))}return new Ae(E)}getPoints(){return this._points}length(){return this._length}continue(v){const S=this._points[this._points.length-1],A=this._points.slice(),E=v.getPoints();for(let v=1;v<E.length;v++)A.push(E[v].subtract(E[0]).add(S));return new Ae(A)}_computeLength(v){let S=0;for(let A=1;A<v.length;A++)S+=v[A].subtract(v[A-1]).length();return S}}ke.Curve3=Ae;var Ue={},We={};Object.defineProperty(We,"__esModule",{value:!0}),We.Plane=void 0;const He=kt,Ve=Ut,qe=Lt;class ze{constructor(v,S,A,E){this.normal=new He.Vector3(v,S,A),this.d=E}static FromArray(v){return new ze(v[0],v[1],v[2],v[3])}static FromPoints(v,S,A){const E=new ze(0,0,0,0);return E.copyFromPoints(v,S,A),E}static FromPositionAndNormal(v,S){const A=new ze(0,0,0,0);return S.normalize(),A.normal=S,A.d=-(S.x*v.x+S.y*v.y+S.z*v.z),A}static SignedDistanceToPlaneFromPositionAndNormal(v,S,A){const E=-(S.x*v.x+S.y*v.y+S.z*v.z);return He.Vector3.Dot(A,S)+E}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new ze(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let v=this.normal.getHashCode();return v=397*v^(this.d||0),v}normalize(){const v=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let S=0;return 0!==v&&(S=1/v),this.normal.x*=S,this.normal.y*=S,this.normal.z*=S,this.d*=S,this}transform(v){const S=qe.MathTmp.Matrix[0];Ve.Matrix.TransposeToRef(v,S);const A=S.m,E=this.normal.x,R=this.normal.y,O=this.normal.z,M=this.d,B=E*A[0]+R*A[1]+O*A[2]+M*A[3],W=E*A[4]+R*A[5]+O*A[6]+M*A[7],H=E*A[8]+R*A[9]+O*A[10]+M*A[11],V=E*A[12]+R*A[13]+O*A[14]+M*A[15];return new ze(B,W,H,V)}dotCoordinate(v){return this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z+this.d}copyFromPoints(v,S,A){const E=S.x-v.x,R=S.y-v.y,O=S.z-v.z,M=A.x-v.x,B=A.y-v.y,W=A.z-v.z,H=R*W-O*B,V=O*M-E*W,X=E*B-R*M,Q=Math.sqrt(H*H+V*V+X*X);let Z;return Z=0!==Q?1/Q:0,this.normal.x=H*Z,this.normal.y=V*Z,this.normal.z=X*Z,this.d=-(this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z),this}isFrontFacingTo(v,S){return He.Vector3.Dot(this.normal,v)<=S}signedDistanceTo(v){return He.Vector3.Dot(v,this.normal)+this.d}}We.Plane=ze,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.Frustum=void 0;const Ge=We;class Me{static GetPlanes(v){const S=[];for(let v=0;v<6;v++)S.push(new Ge.Plane(0,0,0,0));return Me.GetPlanesToRef(v,S),S}static GetNearPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]+A[2],S.normal.y=A[7]+A[6],S.normal.z=A[11]+A[10],S.d=A[15]+A[14],S.normalize()}static GetFarPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]-A[2],S.normal.y=A[7]-A[6],S.normal.z=A[11]-A[10],S.d=A[15]-A[14],S.normalize()}static GetLeftPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]+A[0],S.normal.y=A[7]+A[4],S.normal.z=A[11]+A[8],S.d=A[15]+A[12],S.normalize()}static GetRightPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]-A[0],S.normal.y=A[7]-A[4],S.normal.z=A[11]-A[8],S.d=A[15]-A[12],S.normalize()}static GetTopPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]-A[1],S.normal.y=A[7]-A[5],S.normal.z=A[11]-A[9],S.d=A[15]-A[13],S.normalize()}static GetBottomPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]+A[1],S.normal.y=A[7]+A[5],S.normal.z=A[11]+A[9],S.d=A[15]+A[13],S.normalize()}static GetPlanesToRef(v,S){Me.GetNearPlaneToRef(v,S[0]),Me.GetFarPlaneToRef(v,S[1]),Me.GetLeftPlaneToRef(v,S[2]),Me.GetRightPlaneToRef(v,S[3]),Me.GetTopPlaneToRef(v,S[4]),Me.GetBottomPlaneToRef(v,S[5])}}Ue.Frustum=Me;var Xe={};Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.Path2=void 0;const Ye=me,Qe=fe,Ze=zt;class De{constructor(v,S){this.closed=!1,this._points=new Array,this._length=0,this._points.push(new Ye.Vector2(v,S))}static StartingAt(v,S){return new De(v,S)}addLineTo(v,S){if(this.closed)return this;const A=new Ye.Vector2(v,S),E=this._points[this._points.length-1];return this._points.push(A),this._length+=A.subtract(E).length(),this}addArcTo(v,S,A,E,R=36){if(this.closed)return this;const O=this._points[this._points.length-1],M=new Ye.Vector2(v,S),B=new Ye.Vector2(A,E),W=new Qe.Arc2(O,M,B);let H=W.angle.radians()/R;W.orientation===Ze.Orientation.CW&&(H*=-1);let V=W.startAngle.radians()+H;for(let v=0;v<R;v++){const v=Math.cos(V)*W.radius+W.centerPoint.x,S=Math.sin(V)*W.radius+W.centerPoint.y;this.addLineTo(v,S),V+=H}return this}close(){return this.closed=!0,this}length(){let v=this._length;if(!this.closed){const S=this._points[this._points.length-1];v+=this._points[0].subtract(S).length()}return v}getPoints(){return this._points}getPointAtLengthPosition(v){if(v<0||v>1)return Ye.Vector2.Zero();const S=v*this.length();let A=0;for(let v=0;v<this._points.length;v++){const E=(v+1)%this._points.length,R=this._points[v],O=this._points[E].subtract(R),M=O.length()+A;if(S>=A&&S<=M){const v=O.normalize(),E=S-A;return new Ye.Vector2(R.x+v.x*E,R.y+v.y*E)}A=M}return Ye.Vector2.Zero()}}Xe.Path2=De;var Je={};Object.defineProperty(Je,"__esModule",{value:!0}),Je.Path3D=void 0;const $e=kt,tn=zt,nn=Ht;Je.Path3D=class{constructor(v,S=null,A){this.path=v,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(let S=0;S<v.length;S++)this._curve[S]=v[S].clone();this._raw=A||!1,this._compute(S)}getCurve(){return this._curve}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}update(v,S=null){for(let S=0;S<v.length;S++)this._curve[S].x=v[S].x,this._curve[S].y=v[S].y,this._curve[S].z=v[S].z;return this._compute(S),this}_compute(v){const S=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[S-1]=this._curve[S-1].subtract(this._curve[S-2]),this._raw||this._tangents[S-1].normalize();const A=this._tangents[0],E=this._normalVector(this._curve[0],A,v);let R,O,M,B;this._normals[0]=E,this._raw||this._normals[0].normalize(),this._binormals[0]=$e.Vector3.Cross(A,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let v=1;v<S;v++)R=this._getLastNonNullVector(v),v<S-1&&(O=this._getFirstNonNullVector(v),this._tangents[v]=R.add(O),this._tangents[v].normalize()),this._distances[v]=this._distances[v-1]+R.length(),M=this._tangents[v],B=this._binormals[v-1],this._normals[v]=$e.Vector3.Cross(B,M),this._raw||this._normals[v].normalize(),this._binormals[v]=$e.Vector3.Cross(M,this._normals[v]),this._raw||this._binormals[v].normalize()}_getFirstNonNullVector(v){let S=1,A=this._curve[v+S].subtract(this._curve[v]);for(;0===A.length()&&v+S+1<this._curve.length;)S++,A=this._curve[v+S].subtract(this._curve[v]);return A}_getLastNonNullVector(v){let S=1,A=this._curve[v].subtract(this._curve[v-S]);for(;0===A.length()&&v>S+1;)S++,A=this._curve[v].subtract(this._curve[v-S]);return A}_normalVector(v,S,A){let E,R=S.length();if(0===R&&(R=1),null==A){let v;v=nn.Scalar.WithinEpsilon(Math.abs(S.y)/R,1,tn.Epsilon)?nn.Scalar.WithinEpsilon(Math.abs(S.x)/R,1,tn.Epsilon)?nn.Scalar.WithinEpsilon(Math.abs(S.z)/R,1,tn.Epsilon)?$e.Vector3.Zero():new $e.Vector3(0,0,1):new $e.Vector3(1,0,0):new $e.Vector3(0,-1,0),E=$e.Vector3.Cross(S,v)}else E=$e.Vector3.Cross(S,A),$e.Vector3.CrossToRef(E,S,E);return E.normalize(),E}};var on={};Object.defineProperty(on,"__esModule",{value:!0}),on.Size=void 0;class je{constructor(v,S){this.width=v,this.height=S}get surface(){return this.width*this.height}static Zero(){return new je(0,0)}static Lerp(v,S,A){const E=v.width+(S.width-v.width)*A,R=v.height+(S.height-v.height)*A;return new je(E,R)}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let v=this.width||0;return v=397*v^(this.height||0),v}copyFrom(v){this.width=v.width,this.height=v.height}copyFromFloats(v,S){return this.width=v,this.height=S,this}set(v,S){return this.copyFromFloats(v,S)}multiplyByFloats(v,S){return new je(this.width*v,this.height*S)}clone(){return new je(this.width,this.height)}equals(v){return!!v&&this.width===v.width&&this.height===v.height}add(v){return new je(this.width+v.width,this.height+v.height)}subtract(v){return new je(this.width-v.width,this.height-v.height)}}on.Size=je,function(v){var S=Ot&&Ot.__createBinding||(Object.create?function(v,S,A,E){void 0===E&&(E=A),Object.defineProperty(v,E,{enumerable:!0,get:function(){return S[A]}})}:function(v,S,A,E){void 0===E&&(E=A),v[E]=S[A]}),A=Ot&&Ot.__exportStar||function(v,A){for(var E in v)"default"===E||Object.prototype.hasOwnProperty.call(A,E)||S(A,v,E)};Object.defineProperty(v,"__esModule",{value:!0}),A(zt,v),A(Lt,v),A(ye,v),A(fe,v),A(Se,v),A(Ee,v),A(Ie,v),A(Re,v),A(ke,v),A(Ue,v),A(Ut,v),A(Xe,v),A(Je,v),A(We,v),A(Bt,v),A(Ht,v),A(on,v),A(me,v),A(kt,v),A(Wt,v),A(Nt,v)}(Nt);var rn,sn,an,hn,un={looping:!0,speed:1,weight:1,layer:0},ln=function(v){function e(S,A){void 0===A&&(A=un);var E=v.call(this)||this;return E.isAnimationClip=!0,E.looping=un.looping,E.weight=un.weight,E.playing=!1,E.shouldReset=!1,E.speed=un.speed,E.name=f("AnimClip"),E.layer=un.layer,E.clip=S,E.setParams(o({},A)),E}return i(e,v),e.prototype.setParams=function(v){return this.looping=void 0!==v.looping?v.looping:this.looping,this.speed=v.speed||this.speed,this.weight=v.weight||this.weight,this.layer=v.layer||this.layer,this},e.prototype.toJSON=function(){var S=JSON.parse(JSON.stringify(v.prototype.toJSON.call(this)));return this.shouldReset&&(this.shouldReset=!1),S},e.prototype.play=function(v){var S;void 0===v&&(v=!1),null===(S=this.owner)||void 0===S||S.play(this,v)},e.prototype.pause=function(){var v;null===(v=this.owner)||void 0===v||v.pause(this)},e.prototype.reset=function(){this.shouldReset=!0},e.prototype.stop=function(){var v;null===(v=this.owner)||void 0===v||v.stop(this)},r([$.readonly,s("design:type",String)],e.prototype,"clip",void 0),r([$.field,s("design:type",Boolean)],e.prototype,"looping",void 0),r([$.field,s("design:type",Number)],e.prototype,"weight",void 0),r([$.field,s("design:type",Boolean)],e.prototype,"playing",void 0),r([$.field,s("design:type",Boolean)],e.prototype,"shouldReset",void 0),r([$.field,s("design:type",Number)],e.prototype,"speed",void 0),r([$.readonly,s("design:type",String)],e.prototype,"name",void 0),e}($);v.InputEventType=void 0,(rn=v.InputEventType||(v.InputEventType={}))[rn.DOWN=0]="DOWN",rn[rn.UP=1]="UP",v.CameraMode=void 0,(sn=v.CameraMode||(v.CameraMode={}))[sn.FirstPerson=0]="FirstPerson",sn[sn.ThirdPerson=1]="ThirdPerson",sn[sn.BuildingToolGodMode=2]="BuildingToolGodMode",v.LandRole=void 0,(an=v.LandRole||(v.LandRole={})).OWNER="owner",an.OPERATOR="operator",v.ActionButton=void 0,(hn=v.ActionButton||(v.ActionButton={})).POINTER="POINTER",hn.PRIMARY="PRIMARY",hn.SECONDARY="SECONDARY",hn.ANY="ANY",hn.FORWARD="FORWARD",hn.BACKWARD="BACKWARD",hn.RIGHT="RIGHT",hn.LEFT="LEFT",hn.JUMP="JUMP",hn.WALK="WALK",hn.ACTION_3="ACTION_3",hn.ACTION_4="ACTION_4",hn.ACTION_5="ACTION_5",hn.ACTION_6="ACTION_6";var cn,pn,Ke=function(v){if(this.callback=v,!v||!("apply"in v)||!("call"in v))throw new Error("Callback is not a function");yn.ensureInstance()},dn=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerDown")],e)}(Ke),gn=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerUp")],e)}(Ke),en=function(v,S){this.fn=v,this.useRaycast=S},yn=function(){function e(){this.buttonIdMapping=[v.ActionButton.POINTER,v.ActionButton.PRIMARY,v.ActionButton.SECONDARY,v.ActionButton.ANY,v.ActionButton.FORWARD,v.ActionButton.BACKWARD,v.ActionButton.RIGHT,v.ActionButton.LEFT,v.ActionButton.JUMP,v.ActionButton.WALK,v.ActionButton.ACTION_3,v.ActionButton.ACTION_4,v.ActionButton.ACTION_5,v.ActionButton.ACTION_6],this.subscriptions=this.buttonIdMapping.reduce((function(v,S){var A;return o(o({},v),((A={})[S]={BUTTON_DOWN:[],BUTTON_UP:[]},A))}),{}),this.internalState=this.buttonIdMapping.reduce((function(v,S){var A;return o(o({},v),((A={})[S]={BUTTON_DOWN:!1},A))}),{})}return Object.defineProperty(e,"instance",{get:function(){return e.ensureInstance(),e._instance},enumerable:!1,configurable:!0}),e.ensureInstance=function(){e._instance||(e._instance=new e)},e.prototype.isButtonPressed=function(v){return this.internalState[v]},e.prototype.subscribe=function(v,S,A,E){var R=this;return this.subscriptions[S][v].push(new en(E,A)),function(){R.unsubscribe(v,S,E)}},e.prototype.unsubscribe=function(v,S,A){var E=this.getSubscriptionId(v,S,A);return E>-1&&this.subscriptions[S][v].splice(E,1)},e.prototype.handlePointerEvent=function(S){var A=this.getPointerById(S.buttonId);if(A){var E=o(o({},S),{button:A,direction:(new Nt.Vector3).copyFrom(S.direction),origin:(new Nt.Vector3).copyFrom(S.origin),hit:void 0}),R=S.hit?o(o({},S.hit),{hitPoint:(new Nt.Vector3).copyFrom(S.hit.hitPoint),normal:(new Nt.Vector3).copyFrom(S.hit.normal),worldNormal:(new Nt.Vector3).copyFrom(S.hit.worldNormal)}):void 0;if(S.type===v.InputEventType.DOWN){this.internalState[A].BUTTON_DOWN=!0;for(var O=0;O<this.subscriptions[A].BUTTON_DOWN.length;O++)(M=this.subscriptions[A].BUTTON_DOWN[O]).useRaycast?E.hit=R:E.hit=void 0,M.fn(E);R&&R.entityId&&N.engine&&(W=(B=N.engine.entities[R.entityId])&&B.getComponentOrNull(dn))&&(E.hit=R,W.callback(E))}else{for(this.internalState[A].BUTTON_DOWN=!1,O=0;O<this.subscriptions[A].BUTTON_UP.length;O++){var M;(M=this.subscriptions[A].BUTTON_UP[O]).useRaycast?E.hit=R:E.hit=void 0,M.fn(E)}var B,W;R&&R.entityId&&N.engine&&(W=(B=N.engine.entities[R.entityId])&&B.getComponentOrNull(gn))&&(E.hit=R,W.callback(E))}}},e.prototype.getSubscriptionId=function(v,S,A){for(var E=0;E<this.subscriptions[S][v].length;E++)if(this.subscriptions[S][v][E].fn===A)return E;return-1},e.prototype.getPointerById=function(S){if(S<0||S>=this.buttonIdMapping.length)return null;var A=this.buttonIdMapping[S];return A===v.ActionButton.ANY?null:A},e}();v.CLASS_ID=void 0,(cn=v.CLASS_ID||(v.CLASS_ID={}))[cn.TRANSFORM=1]="TRANSFORM",cn[cn.UUID_CALLBACK=8]="UUID_CALLBACK",cn[cn.BOX_SHAPE=16]="BOX_SHAPE",cn[cn.SPHERE_SHAPE=17]="SPHERE_SHAPE",cn[cn.PLANE_SHAPE=18]="PLANE_SHAPE",cn[cn.CONE_SHAPE=19]="CONE_SHAPE",cn[cn.CYLINDER_SHAPE=20]="CYLINDER_SHAPE",cn[cn.TEXT_SHAPE=21]="TEXT_SHAPE",cn[cn.NFT_SHAPE=22]="NFT_SHAPE",cn[cn.UI_WORLD_SPACE_SHAPE=23]="UI_WORLD_SPACE_SHAPE",cn[cn.UI_SCREEN_SPACE_SHAPE=24]="UI_SCREEN_SPACE_SHAPE",cn[cn.UI_CONTAINER_RECT=25]="UI_CONTAINER_RECT",cn[cn.UI_CONTAINER_STACK=26]="UI_CONTAINER_STACK",cn[cn.UI_TEXT_SHAPE=27]="UI_TEXT_SHAPE",cn[cn.UI_INPUT_TEXT_SHAPE=28]="UI_INPUT_TEXT_SHAPE",cn[cn.UI_IMAGE_SHAPE=29]="UI_IMAGE_SHAPE",cn[cn.UI_SLIDER_SHAPE=30]="UI_SLIDER_SHAPE",cn[cn.CIRCLE_SHAPE=31]="CIRCLE_SHAPE",cn[cn.BILLBOARD=32]="BILLBOARD",cn[cn.ANIMATION=33]="ANIMATION",cn[cn.FONT=34]="FONT",cn[cn.UI_FULLSCREEN_SHAPE=40]="UI_FULLSCREEN_SHAPE",cn[cn.UI_BUTTON_SHAPE=41]="UI_BUTTON_SHAPE",cn[cn.GLTF_SHAPE=54]="GLTF_SHAPE",cn[cn.OBJ_SHAPE=55]="OBJ_SHAPE",cn[cn.AVATAR_SHAPE=56]="AVATAR_SHAPE",cn[cn.BASIC_MATERIAL=64]="BASIC_MATERIAL",cn[cn.PBR_MATERIAL=65]="PBR_MATERIAL",cn[cn.HIGHLIGHT_ENTITY=66]="HIGHLIGHT_ENTITY",cn[cn.SOUND=67]="SOUND",cn[cn.TEXTURE=68]="TEXTURE",cn[cn.VIDEO_CLIP=70]="VIDEO_CLIP",cn[cn.VIDEO_TEXTURE=71]="VIDEO_TEXTURE",cn[cn.AVATAR_TEXTURE=72]="AVATAR_TEXTURE",cn[cn.AUDIO_CLIP=200]="AUDIO_CLIP",cn[cn.AUDIO_SOURCE=201]="AUDIO_SOURCE",cn[cn.AUDIO_STREAM=202]="AUDIO_STREAM",cn[cn.GIZMOS=203]="GIZMOS",cn[cn.SMART_ITEM=204]="SMART_ITEM",cn[cn.AVATAR_MODIFIER_AREA=205]="AVATAR_MODIFIER_AREA",cn[cn.AVATAR_ATTACH=206]="AVATAR_ATTACH",cn[cn.CAMERA_MODE_AREA=207]="CAMERA_MODE_AREA",cn[cn.NAME=300]="NAME",cn[cn.LOCKED_ON_EDIT=301]="LOCKED_ON_EDIT",cn[cn.VISIBLE_ON_EDIT=302]="VISIBLE_ON_EDIT",v.AvatarModifiers=void 0,(pn=v.AvatarModifiers||(v.AvatarModifiers={})).HIDE_AVATARS="HIDE_AVATARS",pn.DISABLE_PASSPORTS="DISABLE_PASSPORTS";var fn,mn=function(S){function n(v){var A=S.call(this)||this;return A.area=v.area,A.modifiers=v.modifiers,A.excludeIds=v.excludeIds,A}return i(n,S),r([$.field,s("design:type",Object)],n.prototype,"area",void 0),r([$.field,s("design:type",Array)],n.prototype,"modifiers",void 0),r([$.field,s("design:type",Array)],n.prototype,"excludeIds",void 0),r([P("engine.avatarModifierArea",v.CLASS_ID.AVATAR_MODIFIER_AREA),s("design:paramtypes",[Object])],n)}($),vn=function(S){function n(v){void 0===v&&(v={});var A=S.call(this)||this;return A.position=v.position||Nt.Vector3.Zero(),A.rotation=v.rotation||Nt.Quaternion.Identity,A.scale=v.scale||new Nt.Vector3(1,1,1),A}return i(n,S),Object.defineProperty(n.prototype,"eulerAngles",{get:function(){return this.rotation.eulerAngles},enumerable:!1,configurable:!0}),n.prototype.lookAt=function(v,S){void 0===S&&(S=Nt.MathTmp.staticUp);var A=new Nt.Matrix;return Nt.Matrix.LookAtLHToRef(this.position,v,S,A),A.invert(),Nt.Quaternion.FromRotationMatrixToRef(A,this.rotation),this},n.prototype.rotate=function(v,S){return this.rotation.multiplyInPlace(this.rotation.angleAxis(S,v)),this},n.prototype.translate=function(v){return this.position.addInPlace(v),this},r([$.field,s("design:type",Nt.Vector3)],n.prototype,"position",void 0),r([$.field,s("design:type",Nt.Quaternion)],n.prototype,"rotation",void 0),r([$.field,s("design:type",Nt.Vector3)],n.prototype,"scale",void 0),r([P("engine.transform",v.CLASS_ID.TRANSFORM),s("design:paramtypes",[Object])],n)}($);v.AttachToAvatarAnchorPointId=void 0,(fn=v.AttachToAvatarAnchorPointId||(v.AttachToAvatarAnchorPointId={}))[fn.Position=0]="Position",fn[fn.NameTag=1]="NameTag",fn[fn.LeftHand=2]="LeftHand",fn[fn.RightHand=3]="RightHand";var bn,Tn=function(S){function n(A){void 0===A&&(A={});var E=S.call(this)||this;return E.avatarId=A.avatarId||"",E.anchorPointId=A.anchorPointId||v.AttachToAvatarAnchorPointId.Position,E}return i(n,S),r([$.field,s("design:type",String)],n.prototype,"avatarId",void 0),r([$.field,s("design:type",Number)],n.prototype,"anchorPointId",void 0),r([$.field,s("design:type",String)],n.prototype,"avatarSceneId",void 0),r([P("engine.transform",v.CLASS_ID.AVATAR_ATTACH),s("design:paramtypes",[Object])],n)}($),xn=function(S){function n(v,A,E){void 0===v&&(v=!0),void 0===A&&(A=!0),void 0===E&&(E=!0);var R=S.call(this)||this;return R.x=!0,R.y=!0,R.z=!0,R.x=v,R.y=A,R.z=E,R}return i(n,S),r([$.field,s("design:type",Boolean)],n.prototype,"x",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"y",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"z",void 0),r([P("engine.billboard",v.CLASS_ID.BILLBOARD),s("design:paramtypes",[Boolean,Boolean,Boolean])],n)}($),Cn=function(v){function e(){var S=null!==v&&v.apply(this,arguments)||this;return S.withCollisions=!0,S.isPointerBlocker=!0,S.visible=!0,S}return i(e,v),r([$.field,s("design:type",Boolean)],e.prototype,"withCollisions",void 0),r([$.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),r([$.field,s("design:type",Boolean)],e.prototype,"visible",void 0),e}($),wn=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([$.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.BOX_SHAPE)],n)}(Cn),Sn=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([N("engine.shape",v.CLASS_ID.SPHERE_SHAPE)],n)}(Cn),An=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"segments",void 0),r([$.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CIRCLE_SHAPE)],n)}(Cn),_n=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.width=1,v.height=1,v}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"width",void 0),r([$.field,s("design:type",Number)],n.prototype,"height",void 0),r([$.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.PLANE_SHAPE)],n)}(Cn),En=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.radiusTop=0,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([$.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([$.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([$.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([$.field,s("design:type",Object)],n.prototype,"radius",void 0),r([$.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CONE_SHAPE)],n)}(Cn),In=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.radiusTop=1,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([$.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([$.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([$.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([$.field,s("design:type",Object)],n.prototype,"radius",void 0),r([$.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CYLINDER_SHAPE)],n)}(Cn),Rn=function(S){function n(v){var A=S.call(this)||this;return A.src=v,A}return i(n,S),r([Cn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.GLTF_SHAPE),s("design:paramtypes",[String])],n)}(Cn);v.PictureFrameStyle=void 0,(bn=v.PictureFrameStyle||(v.PictureFrameStyle={}))[bn.Classic=0]="Classic",bn[bn.Baroque_Ornament=1]="Baroque_Ornament",bn[bn.Diamond_Ornament=2]="Diamond_Ornament",bn[bn.Minimal_Wide=3]="Minimal_Wide",bn[bn.Minimal_Grey=4]="Minimal_Grey",bn[bn.Blocky=5]="Blocky",bn[bn.Gold_Edges=6]="Gold_Edges",bn[bn.Gold_Carved=7]="Gold_Carved",bn[bn.Gold_Wide=8]="Gold_Wide",bn[bn.Gold_Rounded=9]="Gold_Rounded",bn[bn.Metal_Medium=10]="Metal_Medium",bn[bn.Metal_Wide=11]="Metal_Wide",bn[bn.Metal_Slim=12]="Metal_Slim",bn[bn.Metal_Rounded=13]="Metal_Rounded",bn[bn.Pins=14]="Pins",bn[bn.Minimal_Black=15]="Minimal_Black",bn[bn.Minimal_White=16]="Minimal_White",bn[bn.Tape=17]="Tape",bn[bn.Wood_Slim=18]="Wood_Slim",bn[bn.Wood_Wide=19]="Wood_Wide",bn[bn.Wood_Twigs=20]="Wood_Twigs",bn[bn.Canvas=21]="Canvas",bn[bn.None=22]="None";var Pn,On=function(S){function n(A,E){void 0===E&&(E={});var R=S.call(this)||this;R.src=A;var O=new Nt.Color3(.6404918,.611472,.8584906),M=v.PictureFrameStyle.Classic;return"r"in E?O=E:null!==E&&(E.color&&(O=E.color),E.style&&(M=E.style)),R.color=O,R.style=M,R}return i(n,S),r([Cn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([Cn.readonly,s("design:type",Number)],n.prototype,"style",void 0),r([$.field,s("design:type",Nt.Color3)],n.prototype,"color",void 0),r([N("engine.shape",v.CLASS_ID.NFT_SHAPE),s("design:paramtypes",[String,Object])],n)}(Cn),Dn=function(S){function n(v,A){var E=S.call(this)||this,R=new RegExp("data:[a-z-]+/[a-z-]+;base64");if((v.length>2048||R.test(v))&&u(" Base64 textures will be deprecated in version 7 of decentraland-ecs"),E.src=v,A)for(var O in A)E[O]=A[O];return E}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"src",void 0),r([$.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([$.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([$.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.TEXTURE),s("design:paramtypes",[String,Object])],n)}($),Nn=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.states=[],v}return i(n,S),n.prototype.addClip=function(v){var S=this;return this.states.push(v),v.onChange((function(){S.dirty=!0})),v.owner=this,this},n.prototype.getClip=function(v){for(var S=0;S<this.states.length;S++){var A=this.states[S];if(A.clip===v)return A}var E=new ln(v);return this.addClip(E),E},n.prototype.stop=function(v){if(v)v.playing=!1,v.shouldReset=!0;else for(var S=0;S<this.states.length;S++){var A=this.states[S];this.stop(A)}},n.prototype.play=function(v,S){void 0===S&&(S=!1);for(var A=0;A<this.states.length;A++){var E=this.states[A];E.layer===v.layer&&v!==E&&this.pause(E)}S&&(v.shouldReset=!0),v.playing=!0,v.dirty=!0,v.data.nonce=Math.random()},n.prototype.pause=function(v){if(v)v.playing=!1;else for(var S=0;S<this.states.length;S++){var A=this.states[S];this.pause(A)}},r([$.readonly,s("design:type",Array)],n.prototype,"states",void 0),r([P("engine.animator",v.CLASS_ID.ANIMATION)],n)}(Cn),zn=function(S){function n(v){var A=S.call(this)||this;return A.src=v,A}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.OBJ_SHAPE),s("design:paramtypes",[String])],n)}(Cn),Mn=function(S){function n(v){void 0===v&&(v="");var A=S.call(this)||this;return A.src=v,A}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.font",v.CLASS_ID.FONT),s("design:paramtypes",[String])],n)}($);v.Fonts=void 0,(Pn=v.Fonts||(v.Fonts={})).SanFrancisco="builtin:SF-UI-Text-Regular SDF",Pn.SanFrancisco_Heavy="builtin:SF-UI-Text-Heavy SDF",Pn.SanFrancisco_Semibold="builtin:SF-UI-Text-Semibold SDF",Pn.LiberationSans="builtin:LiberationSans SDF",Pn.SansSerif="SansSerif",Pn.SansSerif_Heavy="SansSerif_Heavy",Pn.SansSerif_Bold="SansSerif_Bold",Pn.SansSerif_SemiBold="SansSerif_SemiBold";var Ln,Fn=function(S){function n(v){var A=S.call(this)||this;return A.outlineWidth=0,A.outlineColor=new Nt.Color3(1,1,1),A.color=new Nt.Color3(1,1,1),A.fontSize=10,A.opacity=1,A.value="",A.lineSpacing="0px",A.lineCount=0,A.textWrapping=!1,A.shadowBlur=0,A.shadowOffsetX=0,A.shadowOffsetY=0,A.shadowColor=new Nt.Color3(1,1,1),A.hTextAlign="center",A.vTextAlign="center",A.width=1,A.height=1,A.paddingTop=0,A.paddingRight=0,A.paddingBottom=0,A.paddingLeft=0,A.billboard=!1,A.visible=!0,v&&(A.value=v),A}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([$.field,s("design:type",Nt.Color3)],n.prototype,"outlineColor",void 0),r([$.field,s("design:type",Nt.Color3)],n.prototype,"color",void 0),r([$.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([$.component,s("design:type",Mn)],n.prototype,"font",void 0),r([$.field,s("design:type",Number)],n.prototype,"opacity",void 0),r([$.field,s("design:type",String)],n.prototype,"value",void 0),r([$.field,s("design:type",String)],n.prototype,"lineSpacing",void 0),r([$.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([$.field,s("design:type",Nt.Color3)],n.prototype,"shadowColor",void 0),r([$.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([$.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([$.field,s("design:type",Number)],n.prototype,"width",void 0),r([$.field,s("design:type",Number)],n.prototype,"height",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"billboard",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"visible",void 0),r([P("engine.text",v.CLASS_ID.TEXT_SHAPE),s("design:paramtypes",[String])],n)}($);v.TransparencyMode=void 0,(Ln=v.TransparencyMode||(v.TransparencyMode={}))[Ln.OPAQUE=0]="OPAQUE",Ln[Ln.ALPHA_TEST=1]="ALPHA_TEST",Ln[Ln.ALPHA_BLEND=2]="ALPHA_BLEND",Ln[Ln.ALPHA_TEST_AND_BLEND=3]="ALPHA_TEST_AND_BLEND",Ln[Ln.AUTO=4]="AUTO";var kn,Bn=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.alphaTest=.5,A.castShadows=!0,A.transparencyMode=v.TransparencyMode.AUTO,A}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([$.field,s("design:type",Object)],n.prototype,"albedoColor",void 0),r([$.field,s("design:type",Nt.Color3)],n.prototype,"emissiveColor",void 0),r([$.field,s("design:type",Number)],n.prototype,"metallic",void 0),r([$.field,s("design:type",Number)],n.prototype,"roughness",void 0),r([$.field,s("design:type",Nt.Color3)],n.prototype,"reflectivityColor",void 0),r([$.field,s("design:type",Number)],n.prototype,"directIntensity",void 0),r([$.field,s("design:type",Number)],n.prototype,"microSurface",void 0),r([$.field,s("design:type",Number)],n.prototype,"emissiveIntensity",void 0),r([$.field,s("design:type",Number)],n.prototype,"specularIntensity",void 0),r([$.component,s("design:type",Object)],n.prototype,"albedoTexture",void 0),r([$.component,s("design:type",Object)],n.prototype,"alphaTexture",void 0),r([$.component,s("design:type",Object)],n.prototype,"emissiveTexture",void 0),r([$.component,s("design:type",Object)],n.prototype,"bumpTexture",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([$.field,s("design:type",Number)],n.prototype,"transparencyMode",void 0),r([N("engine.material",v.CLASS_ID.PBR_MATERIAL)],n)}($),Un=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.alphaTest=.5,v.castShadows=!0,v}return i(n,S),r([$.component,s("design:type",Object)],n.prototype,"texture",void 0),r([$.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([N("engine.material",v.CLASS_ID.BASIC_MATERIAL)],n)}($),Wn=function(v){function e(S){var A=v.call(this)||this;if(A.uuid=f("UUID"),!S||!("apply"in S)||!("call"in S))throw new Error("Callback is not a function");return A.callback=S,A}return i(e,v),e.uuidEvent=function(v,S){if(delete v[S]){var A=S+"_"+Math.random();v[A]=void 0,Object.defineProperty(v,A,o(o({},Object.getOwnPropertyDescriptor(v,A)),{enumerable:!1})),Object.defineProperty(v,S.toString(),{get:function(){return this[A]},set:function(v){var E=this[A];if(v){if(!(v instanceof e))throw new Error("value is not an OnUUIDEvent");this.data[S]=v.uuid}else this.data[S]=null;if(this[A]=v,v!==E){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](S,v,E)}},enumerable:!0})}},e.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type}},r([$.field,s("design:type",Function)],e.prototype,"callback",void 0),e}($),Hn=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.button=v.ActionButton.ANY,A.hoverText="Interact",A.distance=10,A.showFeedback=!0,A}return i(n,S),n.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type,button:this.button,hoverText:this.hoverText,distance:this.distance,showFeedback:this.showFeedback}},r([$.field,s("design:type",String)],n.prototype,"button",void 0),r([$.field,s("design:type",String)],n.prototype,"hoverText",void 0),r([$.field,s("design:type",Number)],n.prototype,"distance",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"showFeedback",void 0),n}(Wn),Vn=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.type="onPointerLock",v}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onPointerLock",v.CLASS_ID.UUID_CALLBACK)],n)}(Wn),qn=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.type="onAnimationEnd",v}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onAnimationEnd",v.CLASS_ID.UUID_CALLBACK)],n)}(Wn),jn=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([P("engine.smartItem",v.CLASS_ID.SMART_ITEM)],n)}($),Gn=function(S){function n(v){var A=S.call(this)||this;return A.url=v,A}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"url",void 0),r([N("engine.VideoClip",v.CLASS_ID.VIDEO_CLIP),s("design:paramtypes",[String])],n)}($);v.VideoStatus=void 0,(kn=v.VideoStatus||(v.VideoStatus={}))[kn.NONE=0]="NONE",kn[kn.ERROR=1]="ERROR",kn[kn.LOADING=2]="LOADING",kn[kn.READY=3]="READY",kn[kn.PLAYING=4]="PLAYING",kn[kn.BUFFERING=5]="BUFFERING";var Xn,Yn=function(S){function n(A,E){var R=S.call(this)||this;if(R.volume=1,R.playbackRate=1,R.loop=!1,R.seek=-1,R._position=-1,R._videoLength=-1,R._status=v.VideoStatus.NONE,R.playing=!1,!(A instanceof Gn))throw new Error("Trying to create VideoTexture(VideoClip) with an invalid VideoClip");if(R.videoClipId=D(A),E)for(var O in E)R[O]=E[O];return R}return i(n,S),n.prototype.play=function(){this.playing=!0},n.prototype.pause=function(){this.playing=!1},n.prototype.reset=function(){this.seekTime(0),this.pause()},n.prototype.seekTime=function(v){this.seek=v,this.dirty=!0,this.data.nonce=Math.random()},n.prototype.toJSON=function(){if(this.seek>=0){var v=JSON.parse(JSON.stringify(S.prototype.toJSON.call(this)));return this.seek=-1,v}return S.prototype.toJSON.call(this)},n.prototype.update=function(S){S.videoClipId===this.videoClipId&&(this._status=S.videoStatus||v.VideoStatus.NONE,this._videoLength=S.totalVideoLength,this._position=S.currentOffset)},Object.defineProperty(n.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"videoLength",{get:function(){return this._videoLength},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),r([$.readonly,s("design:type",String)],n.prototype,"videoClipId",void 0),r([$.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([$.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([$.field,s("design:type",Number)],n.prototype,"volume",void 0),r([$.field,s("design:type",Number)],n.prototype,"playbackRate",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([$.field,s("design:type",Number)],n.prototype,"seek",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([N("engine.VideoTexture",v.CLASS_ID.VIDEO_TEXTURE),s("design:paramtypes",[Gn,Object])],n)}($),Qn=function(S){function n(v){var A=S.call(this)||this;return A.area=v.area,A.cameraMode=v.cameraMode,A}return i(n,S),r([$.field,s("design:type",Object)],n.prototype,"area",void 0),r([$.field,s("design:type",Number)],n.prototype,"cameraMode",void 0),r([P("engine.cameraModeArea",v.CLASS_ID.CAMERA_MODE_AREA),s("design:paramtypes",[Object])],n)}($),Zn=function(S){function n(v,A){var E=S.call(this)||this;if(E.userId=v,A)for(var R in A)E[R]=A[R];return E}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"userId",void 0),r([$.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([$.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([$.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.AVATAR_TEXTURE),s("design:paramtypes",[String,Object])],n)}($),Kn=function(){function e(){var S=this;this.position=new Nt.Vector3,this.rotation=new Nt.Quaternion,this.feetPosition=new Nt.Vector3,this.worldPosition=new Nt.Vector3,this.lastEventPosition={x:0,y:0,z:0},this.lastEventWorldPosition={x:0,y:0,z:0},this.lastEventRotation={x:0,y:0,z:0,w:1},this._playerHeight=1.6,this._cameraMode=v.CameraMode.ThirdPerson,"undefined"!=typeof dcl&&(dcl.subscribe("positionChanged"),dcl.subscribe("rotationChanged"),dcl.subscribe("cameraModeChanged"),dcl.onEvent((function(v){switch(v.type){case"positionChanged":S.positionChanged(v.data);break;case"rotationChanged":S.rotationChanged(v.data);break;case"cameraModeChanged":S.cameraModeChanged(v.data)}}))),Object.defineProperty(this.position,"x",{get:function(){return S.lastEventPosition.x}}),Object.defineProperty(this.position,"y",{get:function(){return S.lastEventPosition.y}}),Object.defineProperty(this.position,"z",{get:function(){return S.lastEventPosition.z}}),Object.defineProperty(this.worldPosition,"x",{get:function(){return S.lastEventWorldPosition.x}}),Object.defineProperty(this.worldPosition,"y",{get:function(){return S.lastEventWorldPosition.y}}),Object.defineProperty(this.worldPosition,"z",{get:function(){return S.lastEventWorldPosition.z}}),Object.defineProperty(this.feetPosition,"x",{get:function(){return S.lastEventPosition.x}}),Object.defineProperty(this.feetPosition,"y",{get:function(){return S.lastEventPosition.y-S.playerHeight}}),Object.defineProperty(this.feetPosition,"z",{get:function(){return S.lastEventPosition.z}}),Object.defineProperty(this.rotation,"x",{get:function(){return S.lastEventRotation.x}}),Object.defineProperty(this.rotation,"y",{get:function(){return S.lastEventRotation.y}}),Object.defineProperty(this.rotation,"z",{get:function(){return S.lastEventRotation.z}}),Object.defineProperty(this.rotation,"w",{get:function(){return S.lastEventRotation.w}})}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerHeight",{get:function(){return this._playerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraMode",{get:function(){return this._cameraMode},enumerable:!1,configurable:!0}),e.prototype.positionChanged=function(v){this.lastEventPosition=v.position,this.lastEventWorldPosition=v.cameraPosition,this._playerHeight=v.playerHeight},e.prototype.rotationChanged=function(v){this.lastEventRotation=v.quaternion},e.prototype.cameraModeChanged=function(v){this._cameraMode=v.cameraMode},e}();!function(v){v.HitFirst="rqhf",v.HitAll="rqha"}(Xn||(Xn={}));var Jn,$n=function(){function t(){this.queries={}}return Object.defineProperty(t,"instance",{get:function(){return t.ensureInstance(),t._instance},enumerable:!1,configurable:!0}),t.ensureInstance=function(){t._instance||(t._instance=new t)},t.prototype.getRayFromCamera=function(v){var S=Kn.instance.rotation,A=Nt.Matrix.Identity();S.toRotationMatrix(A);var E=Nt.Vector3.TransformCoordinates(Nt.Vector3.Forward(),A);return{origin:Kn.instance.position,direction:E,distance:v}},t.prototype.getRayFromPositions=function(v,S){var A=S.subtract(v),E=A.length();return{origin:v,direction:A.normalize(),distance:E}},t.prototype.hitFirst=function(v,S,A){var E="number"==typeof A?Xn.HitFirst+A:m();this.queries[E]=S,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:E,queryType:"HitFirst",ray:v})},t.prototype.hitAll=function(v,S,A){var E="number"==typeof A?Xn.HitAll+A:m();this.queries[E]=S,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:E,queryType:"HitAll",ray:v})},t.prototype.hitFirstAvatar=function(v,S){u("not implemented yet")},t.prototype.hitAllAvatars=function(v,S){u("not implemented yet")},t.prototype.handleRaycastHitFirstResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t.prototype.handleRaycastHitAllResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t}(),ti=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(ct,this,(function(v){"HitFirst"===v.payload.queryType?$n.instance.handleRaycastHitFirstResponse(v):"HitAll"===v.payload.queryType&&$n.instance.handleRaycastHitAllResponse(v)})),"undefined"!=typeof dcl&&dcl.subscribe("raycastResponse")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("raycastResponse")},t}(),ei=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(pt,this,(function(v){yn.instance.handlePointerEvent(v.payload)})),"undefined"!=typeof dcl&&(dcl.subscribe("pointerUp"),dcl.subscribe("pointerDown"),dcl.subscribe("actionButtonEvent"))},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&(dcl.unsubscribe("pointerUp"),dcl.unsubscribe("pointerDown"),dcl.unsubscribe("actionButtonEvent"))},t}(),ni=function(){function t(){this.handlerMap={}}return t.prototype.activate=function(v){v.eventManager.addListener(lt,this,this.handleEvent),v.eventManager.addListener(B,this,this.componentAdded),v.eventManager.addListener(M,this,this.componentRemoved),"undefined"!=typeof dcl&&dcl.subscribe("uuidEvent")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("uuidEvent")},t.prototype.onAddEntity=function(v){for(var S in v.components){var A=v.components[S];A instanceof Wn&&(this.handlerMap[A.uuid]=A)}},t.prototype.onRemoveEntity=function(v){for(var S in v.components){var A=v.components[S];A instanceof Wn&&delete this.handlerMap[A.uuid]}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var S=v.entity.components[v.componentName];S instanceof Wn&&(this.handlerMap[S.uuid]=S)}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&v.component instanceof Wn&&delete this.handlerMap[v.component.uuid]},t.prototype.handleEvent=function(v){if(v.uuid in this.handlerMap){var S=this.handlerMap[v.uuid];S&&S.callback&&"call"in S.callback&&S.callback(v.payload)}},t}(),ii=new ti,oi=new ei,ri=new ni,si=function(S){function n(v){var A=S.call(this)||this;return A.loop=!1,A.volume=1,A.url=v,A}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"url",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([$.field,s("design:type",String)],n.prototype,"loadingCompleteEventId",void 0),r([$.field,s("design:type",Number)],n.prototype,"volume",void 0),r([N("engine.AudioClip",v.CLASS_ID.AUDIO_CLIP),s("design:paramtypes",[String])],n)}($),ai=function(S){function n(v){var A=S.call(this)||this;if(A.audioClip=v,A.loop=!1,A.volume=1,A.playing=!1,A.pitch=1,A.playedAtTimestamp=Date.now(),!(v instanceof si))throw new Error("Trying to create AudioSource(AudioClip) with an invalid AudioClip");return A.audioClipId=D(v),A}return i(n,S),n.prototype.playOnce=function(){return this.playing=!0,this.dirty=!0,this.playedAtTimestamp=Date.now(),this.data.nonce=Math.random(),this},r([$.readonly,s("design:type",String)],n.prototype,"audioClipId",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([$.field,s("design:type",Number)],n.prototype,"volume",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([$.field,s("design:type",Number)],n.prototype,"pitch",void 0),r([$.field,s("design:type",Number)],n.prototype,"playedAtTimestamp",void 0),r([P("engine.AudioSource",v.CLASS_ID.AUDIO_SOURCE),s("design:paramtypes",[si])],n)}($),hi=function(S){function n(v){var A=S.call(this)||this;return A.playing=!1,A.volume=1,A.url=v,A.playing=!0,A}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"url",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([$.field,s("design:type",Number)],n.prototype,"volume",void 0),r([P("engine.AudioStream",v.CLASS_ID.AUDIO_STREAM),s("design:paramtypes",[String])],n)}($);v.Gizmo=void 0,(Jn=v.Gizmo||(v.Gizmo={})).MOVE="MOVE",Jn.ROTATE="ROTATE",Jn.SCALE="SCALE",Jn.NONE="NONE";var ui,li=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.type="gizmoEvent",v}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.gizmoEvent",v.CLASS_ID.UUID_CALLBACK)],n)}(Wn),ci=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.position=!0,v.rotation=!0,v.scale=!0,v.cycle=!0,v.localReference=!1,v}return i(n,S),r([$.field,s("design:type",Boolean)],n.prototype,"position",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"rotation",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"scale",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"cycle",void 0),r([$.field,s("design:type",String)],n.prototype,"selectedGizmo",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"localReference",void 0),r([P("engine.gizmos",v.CLASS_ID.GIZMOS)],n)}($),pi=function(S){function n(v){var A=S.call(this,v)||this;return A.type="onFocus",ri.handlerMap[A.uuid]=A,A}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onFocus",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Wn),di=function(S){function n(v){var A=S.call(this,v)||this;return A.type="onTextSubmit",ri.handlerMap[A.uuid]=A,A}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onTextSubmit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Wn),gi=function(S){function n(v){var A=S.call(this,v)||this;return A.type="onBlur",ri.handlerMap[A.uuid]=A,A}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onBlur",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Wn),yi=function(S){function n(v){var A=S.call(this,v)||this;return A.type="onEnter",ri.handlerMap[A.uuid]=A,A}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Wn),fi=function(S){function n(v){var A=S.call(this,v)||this;return A.type="onChange",ri.handlerMap[A.uuid]=A,A}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onChange",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Wn),mi=function(S){function n(v,A){var E=S.call(this,v)||this;return E.type="onClick",ri.handlerMap[E.uuid]=E,A&&(E.showFeedback=!(!1===A.showFeedback),A.button&&(E.button=A.button),A.hoverText&&(E.hoverText=A.hoverText),A.distance&&(E.distance=A.distance)),E}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onClick",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Hn),vi=function(S){function n(v,A){var E=S.call(this,v)||this;return E.type="pointerDown",ri.handlerMap[E.uuid]=E,A&&(E.showFeedback=!(!1===A.showFeedback),A.button&&(E.button=A.button),A.hoverText&&(E.hoverText=A.hoverText),A.distance&&(E.distance=A.distance)),E}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerDown",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Hn),bi=function(S){function n(v,A){var E=S.call(this,v)||this;return E.type="pointerUp",ri.handlerMap[E.uuid]=E,A&&(E.showFeedback=!(!1===A.showFeedback),A.button&&(E.button=A.button),A.hoverText&&(E.hoverText=A.hoverText),A.distance&&(E.distance=A.distance)),E}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerUp",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Hn),Ti=function(S){function n(v,A){var E=S.call(this,v)||this;return E.type="pointerHoverEnter",ri.handlerMap[E.uuid]=E,A&&A.distance&&(E.distance=A.distance),E}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Hn),xi=function(S){function n(v){var A=S.call(this,v)||this;return A.type="pointerHoverExit",ri.handlerMap[A.uuid]=A,A.distance=160,A}return i(n,S),r([$.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverExit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Hn),Ci=function(v){function e(S){var A=v.call(this)||this;return A.name=null,A.visible=!0,A.opacity=1,A.hAlign="center",A.vAlign="center",A.width="100px",A.height="50px",A.positionX="0px",A.positionY="0px",A.isPointerBlocker=!0,S&&(A._parent=S,A.data.parentComponent=D(S)),A}return i(e,v),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentComponent",{get:function(){return this.data.parentComponent},enumerable:!1,configurable:!0}),r([$.field,s("design:type",Object)],e.prototype,"name",void 0),r([$.field,s("design:type",Boolean)],e.prototype,"visible",void 0),r([$.field,s("design:type",Number)],e.prototype,"opacity",void 0),r([$.field,s("design:type",String)],e.prototype,"hAlign",void 0),r([$.field,s("design:type",String)],e.prototype,"vAlign",void 0),r([$.uiValue,s("design:type",Object)],e.prototype,"width",void 0),r([$.uiValue,s("design:type",Object)],e.prototype,"height",void 0),r([$.uiValue,s("design:type",Object)],e.prototype,"positionX",void 0),r([$.uiValue,s("design:type",Object)],e.prototype,"positionY",void 0),r([$.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),e}($),wi=function(S){function n(){return S.call(this,null)||this}return i(n,S),r([N("engine.shape",v.CLASS_ID.UI_FULLSCREEN_SHAPE),s("design:paramtypes",[])],n)}(Ci),Si=function(S){function n(){return S.call(this,null)||this}return i(n,S),r([N("engine.shape",v.CLASS_ID.UI_WORLD_SPACE_SHAPE),s("design:paramtypes",[])],n)}(Ci),Ai=function(S){function n(){return S.call(this,null)||this}return i(n,S),r([N("engine.shape",v.CLASS_ID.UI_SCREEN_SPACE_SHAPE),s("design:paramtypes",[])],n)}(Ci),_i=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.thickness=0,v.color=Nt.Color4.Clear(),v.alignmentUsesSize=!0,v}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"color",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"alignmentUsesSize",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_RECT)],n)}(Ci);v.UIStackOrientation=void 0,(ui=v.UIStackOrientation||(v.UIStackOrientation={}))[ui.VERTICAL=0]="VERTICAL",ui[ui.HORIZONTAL=1]="HORIZONTAL";var Ei=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.adaptWidth=!0,A.adaptHeight=!0,A.color=Nt.Color4.Clear(),A.stackOrientation=v.UIStackOrientation.VERTICAL,A.spacing=0,A}return i(n,S),r([$.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"color",void 0),r([$.field,s("design:type",Number)],n.prototype,"stackOrientation",void 0),r([$.field,s("design:type",Number)],n.prototype,"spacing",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_STACK)],n)}(Ci),Ii=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.fontSize=10,v.fontWeight="normal",v.thickness=0,v.cornerRadius=0,v.color=Nt.Color4.White(),v.background=Nt.Color4.White(),v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=Nt.Color4.Black(),v.text="button",v}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([$.field,s("design:type",String)],n.prototype,"fontWeight",void 0),r([$.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([$.field,s("design:type",Number)],n.prototype,"cornerRadius",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"color",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"background",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"shadowColor",void 0),r([$.field,s("design:type",String)],n.prototype,"text",void 0),r([N("engine.shape",v.CLASS_ID.UI_BUTTON_SHAPE)],n)}(Ci),Pi=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.outlineWidth=0,v.outlineColor=Nt.Color4.White(),v.color=Nt.Color4.White(),v.fontSize=10,v.fontAutoSize=!1,v.value="",v.lineSpacing=0,v.lineCount=0,v.adaptWidth=!1,v.adaptHeight=!1,v.textWrapping=!1,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=Nt.Color4.Black(),v.hTextAlign="left",v.vTextAlign="bottom",v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"outlineColor",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"color",void 0),r([$.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"fontAutoSize",void 0),r([$.component,s("design:type",Mn)],n.prototype,"font",void 0),r([$.field,s("design:type",String)],n.prototype,"value",void 0),r([$.field,s("design:type",Number)],n.prototype,"lineSpacing",void 0),r([$.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"shadowColor",void 0),r([$.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([$.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([N("engine.shape",v.CLASS_ID.UI_TEXT_SHAPE)],n)}(Ci),Oi=function(S){function n(v){var A=S.call(this,v)||this;return A.outlineWidth=0,A.outlineColor=Nt.Color4.Black(),A.color=Nt.Color4.Clear(),A.fontSize=10,A.value="",A.placeholder="",A.margin=10,A.hTextAlign="left",A.vTextAlign="bottom",A.focusedBackground=Nt.Color4.Black(),A.textWrapping=!1,A.shadowBlur=0,A.shadowOffsetX=0,A.shadowOffsetY=0,A.shadowColor=Nt.Color4.White(),A.paddingTop=0,A.paddingRight=0,A.paddingBottom=0,A.paddingLeft=0,A.onTextSubmit=null,A.onChanged=null,A.onFocus=null,A.onBlur=null,A.onTextChanged=new fi((function(v){var S=v.value,E=S.value,R=S.isSubmit,O=A.dirty;if(A.value=E,A.dirty=O,R&&A.onTextSubmit){var M={text:E};A.onTextSubmit.callback(M)}else if(!R&&A.onChanged){var B={value:E,pointerId:v.pointerId};A.onChanged.callback(B)}})),A}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"outlineColor",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"color",void 0),r([$.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([$.component,s("design:type",Mn)],n.prototype,"font",void 0),r([$.field,s("design:type",String)],n.prototype,"value",void 0),r([$.field,s("design:type",String)],n.prototype,"placeholder",void 0),r([$.field,s("design:type",Number)],n.prototype,"margin",void 0),r([$.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([$.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"focusedBackground",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([$.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"shadowColor",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Wn.uuidEvent,s("design:type",fi)],n.prototype,"onTextChanged",void 0),r([Wn.uuidEvent,s("design:type",Object)],n.prototype,"onFocus",void 0),r([Wn.uuidEvent,s("design:type",Object)],n.prototype,"onBlur",void 0),r([N("engine.shape",v.CLASS_ID.UI_INPUT_TEXT_SHAPE),s("design:paramtypes",[Object])],n)}(Ci),Di=function(S){function n(v,A){var E=S.call(this,v)||this;return E.sourceLeft=0,E.sourceTop=0,E.sourceWidth=1,E.sourceHeight=1,E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.sizeInPixels=!0,E.onClick=null,E.source=A,E}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"sourceLeft",void 0),r([$.field,s("design:type",Number)],n.prototype,"sourceTop",void 0),r([$.field,s("design:type",Number)],n.prototype,"sourceWidth",void 0),r([$.field,s("design:type",Number)],n.prototype,"sourceHeight",void 0),r([$.component,s("design:type",Object)],n.prototype,"source",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"sizeInPixels",void 0),r([Wn.uuidEvent,s("design:type",Object)],n.prototype,"onClick",void 0),r([N("engine.shape",v.CLASS_ID.UI_IMAGE_SHAPE),s("design:paramtypes",[Ci,Object])],n)}(Ci),Ni=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.valueX=0,v.valueY=0,v.backgroundColor=Nt.Color4.Clear(),v.isHorizontal=!1,v.isVertical=!1,v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.onChanged=null,v}return i(n,S),r([$.field,s("design:type",Number)],n.prototype,"valueX",void 0),r([$.field,s("design:type",Number)],n.prototype,"valueY",void 0),r([$.field,s("design:type",Nt.Color4)],n.prototype,"backgroundColor",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"isHorizontal",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"isVertical",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([$.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Wn.uuidEvent,s("design:type",Object)],n.prototype,"onChanged",void 0),r([N("engine.shape",v.CLASS_ID.UI_SLIDER_SHAPE)],n)}(Ci),zi=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.useDummyModel=!1,v.talking=!1,v}var A;return i(n,S),A=n,n.Dummy=function(){var v=new A;return v.useDummyModel=!0,v},r([$.field,s("design:type",String)],n.prototype,"id",void 0),r([$.field,s("design:type",String)],n.prototype,"name",void 0),r([$.field,s("design:type",String)],n.prototype,"expressionTriggerId",void 0),r([$.field,s("design:type",Number)],n.prototype,"expressionTriggerTimestamp",void 0),r([$.field,s("design:type",String)],n.prototype,"bodyShape",void 0),r([$.field,s("design:type",Array)],n.prototype,"wearables",void 0),r([$.field,s("design:type",Array)],n.prototype,"emotes",void 0),r([$.field,s("design:type",Object)],n.prototype,"skinColor",void 0),r([$.field,s("design:type",Object)],n.prototype,"hairColor",void 0),r([$.field,s("design:type",Object)],n.prototype,"eyeColor",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"useDummyModel",void 0),r([$.field,s("design:type",Boolean)],n.prototype,"talking",void 0),A=r([P("engine.avatarShape",v.CLASS_ID.AVATAR_SHAPE)],n)}($),Mi=null,Li=null,Fi=null;function Ri(){return Fi||(Fi=new ut),Fi}var ki=function(){function t(){var v=this;this.messageQueue=[],this.connected=!1,this.flushing=!1,function(){if(!Li){(Li=dcl.loadModule("@decentraland/CommunicationsController",{})).then((function(v){Mi=v}));var v=Ri();dcl.subscribe("comms"),dcl.onEvent((function(S){"comms"===S.type&&v.notifyObservers(S.data)}))}return Li}().then((function(){v.connected=!0,v.flush()}))}return t.prototype.on=function(v,S){return Ri().add((function(A){try{var E=JSON.parse(A.message);E.message===v&&S(E.payload,A.sender)}catch(A){dcl.error("Error parsing comms message "+(A.message||""),A)}}))},t.prototype.sendRaw=function(v){this.messageQueue.push(v),this.connected&&this.flush()},t.prototype.emit=function(v,S){var A=JSON.stringify({message:v,payload:S});this.sendRaw(A),Ri().notifyObservers({message:A,sender:"self"})},t.prototype.flush=function(){var v=this;if(0!==this.messageQueue.length&&this.connected&&Mi&&!this.flushing){var S=this.messageQueue.shift();this.flushing=!0,dcl.callRpc(Mi.rpcHandle,"send",[S]).then((function(S){v.flushing=!1,v.flush()}),(function(S){v.flushing=!1,y("Error flushing MessageBus",S)}))}},t}(),Bi=new nt("scene");Bi.uuid="0";var Ui=new it(Bi);N.engine=Ui,"undefined"!=typeof dcl&&(Ui.addSystem(new Pt(dcl),1/0),mt(dcl)),Ui.addSystem(ri),Ui.addSystem(oi),Ui.addSystem(ii),v.AVATAR_OBSERVABLE="AVATAR_OBSERVABLE",v.Angle=Nt.Angle,v.AnimationState=ln,v.Animator=Nn,v.Arc2=Nt.Arc2,v.AttachToAvatar=Tn,v.Attachable=S,v.AudioClip=si,v.AudioSource=ai,v.AudioStream=hi,v.AvatarModifierArea=mn,v.AvatarShape=zi,v.AvatarTexture=Zn,v.Axis=Nt.Axis,v.BasicMaterial=Un,v.BezierCurve=Nt.BezierCurve,v.Billboard=xn,v.BoxShape=wn,v.Camera=Kn,v.CameraModeArea=Qn,v.CircleShape=An,v.Color3=Nt.Color3,v.Color4=Nt.Color4,v.Component=P,v.ComponentAdded=B,v.ComponentGroup=et,v.ComponentRemoved=M,v.ConeShape=En,v.Curve3=Nt.Curve3,v.CylinderShape=In,v.DEG2RAD=Nt.DEG2RAD,v.DisposableComponent=N,v.DisposableComponentCreated=Z,v.DisposableComponentRemoved=K,v.DisposableComponentUpdated=J,v.Engine=it,v.Entity=nt,v.Epsilon=Nt.Epsilon,v.EventConstructor=x,v.EventManager=R,v.Font=Mn,v.Frustum=Nt.Frustum,v.GLTFShape=Rn,v.Gizmos=ci,v.GlobalPointerDown=dn,v.GlobalPointerUp=gn,v.Input=yn,v.Material=Bn,v.Matrix=Nt.Matrix,v.MessageBus=ki,v.MultiObserver=ht,v.NFTShape=On,v.OBJShape=zn,v.Observable=ut,v.ObservableComponent=$,v.Observer=Y,v.ObserverEventState=at,v.OnAnimationEnd=qn,v.OnBlur=gi,v.OnChanged=fi,v.OnClick=mi,v.OnEnter=yi,v.OnFocus=pi,v.OnGizmoEvent=li,v.OnPointerDown=vi,v.OnPointerHoverEnter=Ti,v.OnPointerHoverExit=xi,v.OnPointerLock=Vn,v.OnPointerUUIDEvent=Hn,v.OnPointerUp=bi,v.OnTextSubmit=di,v.OnUUIDEvent=Wn,v.Orientation=Nt.Orientation,v.ParentChanged=W,v.Path2=Nt.Path2,v.Path3D=Nt.Path3D,v.PhysicsCast=$n,v.Plane=Nt.Plane,v.PlaneShape=_n,v.PointerEvent=pt,v.PointerEventComponent=Ke,v.PointerEventSystem=ei,v.Quaternion=Nt.Quaternion,v.RAD2DEG=Nt.RAD2DEG,v.RaycastEventSystem=ti,v.RaycastResponse=ct,v.Scalar=Nt.Scalar,v.Shape=Cn,v.Size=Nt.Size,v.SmartItem=jn,v.Space=Nt.Space,v.SphereShape=Sn,v.Subscription=en,v.TextShape=Fn,v.Texture=Dn,v.ToGammaSpace=Nt.ToGammaSpace,v.ToLinearSpace=Nt.ToLinearSpace,v.Transform=vn,v.UIButton=Ii,v.UICanvas=Ai,v.UIContainerRect=_i,v.UIContainerStack=Ei,v.UIFullScreen=wi,v.UIImage=Di,v.UIInputText=Oi,v.UIScrollRect=Ni,v.UIShape=Ci,v.UIText=Pi,v.UIValue=H,v.UIWorldSpace=Si,v.UUIDEvent=lt,v.UUIDEventSystem=ni,v.Vector2=Nt.Vector2,v.Vector3=Nt.Vector3,v.Vector4=Nt.Vector4,v.VideoClip=Gn,v.VideoTexture=Yn,v._initEventObservables=mt,v.buildArray=function(v,S){for(var A=[],E=0;E<v;++E)A.push(S());return A},v.engine=Ui,v.error=y,v.executeTask=G,v.getComponentClassId=L,v.getComponentId=D,v.getComponentName=F,v.getMessageObserver=Ri,v.isDisposableComponent=U,v.log=u,v.newId=f,v.onCameraModeChangedObservable=dt,v.onEnterScene=ft,v.onEnterSceneObservable=yt,v.onIdleStateChangedObservable=gt,v.onLeaveScene=bt,v.onLeaveSceneObservable=vt,v.onPlayerClickedObservable=Rt,v.onPlayerConnectedObservable=At,v.onPlayerDisconnectedObservable=_t,v.onPlayerExpressionObservable=xt,v.onPointerLockedStateChange=Ct,v.onProfileChanged=St,v.onRealmChangedObservable=It,v.onSceneReadyObservable=Tt,v.onVideoEvent=wt,v.openExternalURL=function(v){"undefined"!=typeof dcl?dcl.openExternalUrl(v):y("ERROR: openExternalURL dcl is undefined")},v.openNFTDialog=function(v,S){if(void 0===S&&(S=null),"undefined"!=typeof dcl){var A=v.match(/ethereum:\/\/(.+)\/(.+)/);if(!A||A.length<3)return;dcl.openNFTDialog(A[1],A[2],S)}else y("ERROR: openNFTDialog dcl is undefined")},v.pointerEventSystem=oi,v.raycastEventSystem=ii,v.teleportTo=function(v){var S;S=[v],void 0===rt&&"undefined"!=typeof dcl&&(rt=dcl.loadModule("@decentraland/UserActionModule",{})),void 0!==rt&&"undefined"!=typeof dcl&&rt.then((function(v){dcl.callRpc(v.rpcHandle,"requestTeleport",S)}))},v.uuid=m,v.uuidEventSystem=ri,Object.defineProperty(v,"__esModule",{value:!0})}(this.self=this.self||{}),define("@dcl/ecs-scene-utils",["exports","@decentraland/EnvironmentAPI"],(function(v,S){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var n=function(v,S){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,S){v.__proto__=S}||function(v,S){for(var A in S)Object.prototype.hasOwnProperty.call(S,A)&&(v[A]=S[A])})(v,S)};function i(v,S){function i(){this.constructor=v}n(v,S),v.prototype=null===S?Object.create(S):(i.prototype=S.prototype,new i)}function r(v,S,A,E){var R,O=arguments.length,M=O<3?S:null===E?E=Object.getOwnPropertyDescriptor(S,A):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)M=Reflect.decorate(v,S,A,E);else for(var B=v.length-1;B>=0;B--)(R=v[B])&&(M=(O<3?R(M):O>3?R(S,A,M):R(S,A))||M);return O>3&&M&&Object.defineProperty(S,A,M),M}function o(v,S,A,E){return new(A||(A=Promise))((function(R,O){function a(v){try{u(E.next(v))}catch(v){O(v)}}function s(v){try{u(E.throw(v))}catch(v){O(v)}}function u(v){var S;v.done?R(v.value):(S=v.value,S instanceof A?S:new A((function(v){v(S)}))).then(a,s)}u((E=E.apply(v,S||[])).next())}))}function a(v,S){var A,E,R,O,M={label:0,sent:function(){if(1&R[0])throw R[1];return R[1]},trys:[],ops:[]};return O={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function s(O){return function(B){return function(O){if(A)throw new TypeError("Generator is already executing.");for(;M;)try{if(A=1,E&&(R=2&O[0]?E.return:O[0]?E.throw||((R=E.return)&&R.call(E),0):E.next)&&!(R=R.call(E,O[1])).done)return R;switch(E=0,R&&(O=[2&O[0],R.value]),O[0]){case 0:case 1:R=O;break;case 4:return M.label++,{value:O[1],done:!1};case 5:M.label++,E=O[1],O=[0];continue;case 7:O=M.ops.pop(),M.trys.pop();continue;default:if(!((R=(R=M.trys).length>0&&R[R.length-1])||6!==O[0]&&2!==O[0])){M=0;continue}if(3===O[0]&&(!R||O[1]>R[0]&&O[1]<R[3])){M.label=O[1];break}if(6===O[0]&&M.label<R[1]){M.label=R[1],R=O;break}if(R&&M.label<R[2]){M.label=R[2],M.ops.push(O);break}R[2]&&M.ops.pop(),M.trys.pop();continue}O=S.call(v,M)}catch(v){O=[6,v],E=0}finally{A=R=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,B])}}}function s(v){var S="function"==typeof Symbol&&Symbol.iterator,A=S&&v[S],E=0;if(A)return A.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}var A,E=function(){function e(){this._components=[],this._componentGroups=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(v){this.createAndAddToEngine()._components.push(v)},e.prototype.addComponentType=function(v){var S,A;try{for(var E=s(this._components),R=E.next();!R.done;R=E.next())if(v==R.value)return}catch(v){S={error:v}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}this._components.push(v),this._componentGroups.push(engine.getComponentGroup(v,Transform))},e.prototype.update=function(v){for(var S=0;S<this._components.length;S++)this.updateComponent(v,this._components[S],this._componentGroups[S])},e.prototype.updateComponent=function(v,S,A){A.entities.forEach((function(A){var E=A.getComponent(Transform),R=A.getComponent(S);R.update(v),R.assignValueToTransform(E),R.hasFinished()&&(A.removeComponent(R),null!=R.onFinishCallback&&R.onFinishCallback())}))},e._instance=null,e}();function h(S,A){switch(S){case v.InterpolationType.LINEAR:return A;case v.InterpolationType.EASEINQUAD:return function(v){return v*v}(A);case v.InterpolationType.EASEOUTQUAD:return function(v){return v*(2-v)}(A);case v.InterpolationType.EASEQUAD:return function(v){return v*v/(2*(v*v-v)+1)}(A);case v.InterpolationType.EASEINSINE:return function(v){return 1-Math.cos(v*Math.PI/2)}(A);case v.InterpolationType.EASEOUTSINE:return function(v){return Math.sin(v*Math.PI/2)}(A);case v.InterpolationType.EASESINE:return function(v){return-(Math.cos(Math.PI*v)-1)/2}(A);case v.InterpolationType.EASEINEXPO:return function(v){return 0===v?0:Math.pow(2,10*v-10)}(A);case v.InterpolationType.EASEOUTEXPO:return function(v){return 1===v?1:1-Math.pow(2,-10*v)}(A);case v.InterpolationType.EASEEXPO:return function(v){return 0===v?0:1===v?1:v<.5?Math.pow(2,20*v-10)/2:(2-Math.pow(2,-20*v+10))/2}(A);case v.InterpolationType.EASEINELASTIC:return function(v){var S=2*Math.PI/3;return 0===v?0:1===v?1:-Math.pow(2,10*v-10)*Math.sin((10*v-10.75)*S)}(A);case v.InterpolationType.EASEOUTELASTIC:return function(v){var S=2*Math.PI/3;return 0===v?0:1===v?1:Math.pow(2,-10*v)*Math.sin((10*v-.75)*S)+1}(A);case v.InterpolationType.EASEELASTIC:return function(v){var S=2*Math.PI/4.5;return 0===v?0:1===v?1:v<.5?-Math.pow(2,20*v-10)*Math.sin((20*v-11.125)*S)/2:Math.pow(2,-20*v+10)*Math.sin((20*v-11.125)*S)/2+1}(A);case v.InterpolationType.EASEINBOUNCE:return function(v){return 1-l(1-v)}(A);case v.InterpolationType.EASEOUTEBOUNCE:return function(v){return l(v)}(A);case v.InterpolationType.EASEBOUNCE:return function(v){return v<.5?(1-l(1-2*v))/2:(1+l(2*v-1))/2}(A);default:return A}}function l(v){var S=7.5625,A=2.75;return v<1/A?S*v*v:v<2/A?S*(v-=1.5/A)*v+.75:v<2.5/A?S*(v-=2.25/A)*v+.9375:S*(v-=2.625/A)*v+.984375}v.InterpolationType=void 0,(A=v.InterpolationType||(v.InterpolationType={}))[A.LINEAR=0]="LINEAR",A[A.EASEINQUAD=1]="EASEINQUAD",A[A.EASEOUTQUAD=2]="EASEOUTQUAD",A[A.EASEQUAD=3]="EASEQUAD",A.EASEINSINE="easeinsine",A.EASEOUTSINE="easeoutsine",A.EASESINE="easeinoutsine",A.EASEINEXPO="easeinexpo",A.EASEOUTEXPO="easeoutexpo",A.EASEEXPO="easeinoutexpo",A.EASEINELASTIC="easeinelastic",A.EASEOUTELASTIC="easeoutelastic",A.EASEELASTIC="easeinoutelastic",A.EASEINBOUNCE="easeinbounce",A.EASEOUTEBOUNCE="easeoutbounce",A.EASEBOUNCE="easeinoutbounce";var R,O=function(){function t(A,R,O,M,B){void 0===B&&(B=v.InterpolationType.LINEAR),this.start=A,this.end=R,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=M,this.interpolationType=B,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),E.createAndAddToEngine().addComponentType(S)}var S;return S=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.start,this.end,this.lerpTime)},S=r([Component("moveTransformComponent")],t)}(),M=function(){function t(A,R,O,M,B){void 0===B&&(B=v.InterpolationType.LINEAR),this.start=A,this.end=R,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=M,this.interpolationType=B,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),E.createAndAddToEngine().addComponentType(S)}var S;return S=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.rotation=Quaternion.Slerp(this.start,this.end,this.lerpTime)},S=r([Component("rotateTransformComponent")],t)}(),B=function(){function t(A,R,O,M,B){void 0===B&&(B=v.InterpolationType.LINEAR),this.start=A,this.end=R,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=M,this.interpolationType=B,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),E.createAndAddToEngine().addComponentType(S)}var S;return S=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.scale=Vector3.Lerp(this.start,this.end,this.lerpTime)},S=r([Component("scaleTransformComponent")],t)}(),W=function(){function e(S,A,R,O){if(this.speed=[],this.normalizedTime=0,this.currentIndex=0,this.points=S,this.onFinishCallback=R,this.onPointReachedCallback=O,S.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(A>0){for(var M=0,B=[],W=0;W<S.length-1;W++){var H=Vector3.Distance(S[W],S[W+1]);M+=H,B.push(H)}for(W=0;W<B.length;W++)this.speed.push(1/(B[W]/M*A))}else this.normalizedTime=1,this.currentIndex=S.length-2;E.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,this.onPointReachedCallback&&this.currentIndex<this.points.length-1&&this.onPointReachedCallback(this.points[this.currentIndex],this.points[this.currentIndex+1]))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime)},v=r([Component("followPathComponent")],e)}(),H=function(){function e(S,A,R,O,M,B){if(this.speed=[],this.turnToFaceNext=!1,this.facingNext=!1,this.normalizedTime=0,this.currentIndex=0,this.points=Curve3.CreateCatmullRomSpline(S,R,!!M).getPoints(),this.onFinishCallback=B,this.turnToFaceNext=O||!1,this.points.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(A>0){for(var W=0,H=[],V=0;V<this.points.length-1;V++){var X=Vector3.Distance(this.points[V],this.points[V+1]);W+=X,H.push(X)}for(V=0;V<H.length;V++)this.speed.push(1/(H[V]/W*A))}else this.normalizedTime=1,this.currentIndex=S.length-2;E.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,1==this.turnToFaceNext&&(this.facingNext=!1))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime),this.facingNext||(this.facingNext=!0,this.currentIndex<this.points.length-1?v.lookAt(this.points[this.currentIndex+1]):v.lookAt(this.points[0]))},v=r([Component("followCurvedPathComponent")],e)}(),V=function(){function e(S,A){this.rotationVelocity=S,this.onFinishCallback=A,this.rotation=Quaternion.Identity,this.finished=!1,E.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.rotation=Quaternion.Slerp(Quaternion.Identity,this.rotationVelocity,v)},e.prototype.hasFinished=function(){return this.finished},e.prototype.assignValueToTransform=function(v){v.rotation=v.rotation.multiply(this.rotation)},e.prototype.stop=function(){this.finished=!0},v=r([Component("keepRotatingComponent")],e)}();v.ToggleState=void 0,(R=v.ToggleState||(v.ToggleState={}))[R.Off=0]="Off",R[R.On=1]="On";var X=function(){function t(S,A){void 0===S&&(S=v.ToggleState.On),this.enabled=!0,this.state=v.ToggleState.Off,this.set(S),A&&this.setCallback(A)}return t.prototype.set=function(v){this.state=v,this.onValueChangedCallback&&this.onValueChangedCallback(v)},t.prototype.toggle=function(){this.enabled&&this.set(1-this.state)},t.prototype.isOn=function(){return this.state==v.ToggleState.On},t.prototype.setCallback=function(v){this.onValueChangedCallback=v},r([Component("toggle")],t)}(),Q=function(){function e(){this._components=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(v){this.createAndAddToEngine()._components.push(v)},e.prototype.addComponentType=function(v){var S,A;try{for(var E=s(this._components),R=E.next();!R.done;R=E.next())if(v==R.value)return}catch(v){S={error:v}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}this._components.push(v)},e.prototype.update=function(v){var S=this;this._components.forEach((function(A){S.updateComponent(v,A)}))},e.prototype.updateComponent=function(v,S){var A=engine.getEntitiesWithComponent(S);for(var E in A)if(A.hasOwnProperty(E)){var R=A[E],O=R.getComponent(S);O.elapsedTime+=v,O.elapsedTime>=O.targetTime&&O.onTargetTimeReached(R)}},e._instance=null,e}(),Z=function(){function e(S,A){var E=this;Q.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=S/1e3,this.onTimeReachedCallback=A,this.onTargetTimeReached=function(v){E.onTimeReachedCallback&&E.onTimeReachedCallback(),v.removeComponent(E)}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerDelay")],e)}(),K=function(){function e(S,A){var E=this;Q.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=S/1e3,this.onTimeReachedCallback=A,this.onTargetTimeReached=function(v){E.onTimeReachedCallback&&E.onTimeReachedCallback(),v.removeComponent(E),engine.removeEntity(v)}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerExpireIn")],e)}(),J=function(){function e(S,A){var E=this;Q.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=S/1e3,this.onTimeReachedCallback=A,this.onTargetTimeReached=function(){E.elapsedTime=0,E.onTimeReachedCallback&&E.onTimeReachedCallback()}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerInterval")],e)}();function I(v,S,A,E,R,O){var M=new Entity;M.addComponent(new Transform(O||{position:new Vector3(0,1.5,0)})),M.setParent(S);var B=new TextShape(v);return B.fontSize=R||3,B.color=E||Color3.Black(),M.addComponent(B),A&&M.addComponent(new Billboard),engine.addEntity(M),M}var $,et,nt=function(){function e(){this._triggers={},e._instance=this,this._cameraTriggerWrapper=new ot(new P(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(rt)}return Object.defineProperty(e,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.prototype.setCameraTriggerShape=function(v){this._cameraTriggerWrapper.setShape(v)},e.prototype.update=function(){var v=this,S=this._componentGroup.entities;for(var A in S.forEach((function(S){v.shouldWrapTriggerEntity(S)&&v.wrapTriggerEntity(S)})),this._triggers)if(this._triggers.hasOwnProperty(A)){var E=this._triggers[A];E.isDebugging()&&E.updateDebugEntity(),E.isInEngine()?null!=E.trigger&&E.trigger.enabled?(E.wasEnabled||E.isDebugging()&&E.addDebugEntity(),E.wasEnabled=!0,(E.trigger.onCameraEnter||E.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(E),(E.trigger.onTriggerEnter||E.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(E)):E.wasEnabled&&(E.wasEnabled=!1,E.isDebugging()&&E.removeDebugEntity(),e.removeTriggerFromSystem(E)):(E.isDebugging()&&E.removeDebugEntity(),e.removeTriggerFromSystem(E),delete this._triggers[A])}},e.prototype.shouldWrapTriggerEntity=function(v){return null==this._triggers[v.uuid]||null==this._triggers[v.uuid]},e.prototype.wrapTriggerEntity=function(v){this._triggers[v.uuid]=new it(v)},e.removeTriggerFromSystem=function(v){for(var S,A=v.getActiveCollisions(),E=0;E<A.length;E++)!(A[E]===(null===(S=e._instance)||void 0===S?void 0:S._cameraTriggerWrapper)||null==A[E].trigger)&&A[E].trigger.onTriggerExit&&v.entity&&A[E].trigger.onTriggerExit(v.entity),A[E].disengageActiveCollision(v),v.disengageActiveCollision(A[E])},e.disengageCollision=function(v,S){v.disengageActiveCollision(S),S.disengageActiveCollision(v),v.trigger.onTriggerExit&&S.entity&&v.trigger.onTriggerExit(S.entity),S.trigger.onTriggerExit&&v.entity&&S.trigger.onTriggerExit(v.entity)},e.engageCollision=function(v,S){v.engageCollision(S),S.engageCollision(v),v.trigger.onTriggerEnter&&S.entity&&v.trigger.onTriggerEnter(S.entity),S.trigger.onTriggerEnter&&v.entity&&S.trigger.onTriggerEnter(v.entity)},e.prototype.checkCollisionAgainstCamera=function(v){var S=v.hasActiveCollision(this._cameraTriggerWrapper),A=e.areColliding(v,this._cameraTriggerWrapper);S&&!A?(v.disengageActiveCollision(this._cameraTriggerWrapper),v.trigger.onCameraExit&&v.trigger.onCameraExit()):!S&&A&&(v.engageCollision(this._cameraTriggerWrapper),v.trigger.onCameraEnter&&v.trigger.onCameraEnter())},e.prototype.checkCollisionAgainstOtherTriggers=function(v){for(var S in this._triggers)if(this._triggers.hasOwnProperty(S)&&S!=v.uuid&&this._triggers[S].trigger.enabled&&e.canTriggersCollide(v,this._triggers[S])){var A=v.hasActiveCollision(this._triggers[S]),E=e.areColliding(v,this._triggers[S]);A&&!E?e.disengageCollision(v,this._triggers[S]):!A&&E&&e.engageCollision(v,this._triggers[S])}},e.canTriggersCollide=function(v,S){return 0==v.trigger.triggeredByLayer||0!=(S.trigger.layer&v.trigger.triggeredByLayer)},e.areColliding=function(v,S){return v.getShape()instanceof P&&S.getShape()instanceof P?e.areCollidingAABB(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof k&&S.getShape()instanceof k?e.areCollidingSphere(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof P&&S.getShape()instanceof k?e.areCollidingAABBSphere(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof k&&S.getShape()instanceof P&&e.areCollidingAABBSphere(S.getGlobalPosition(),S.getShape(),v.getGlobalPosition(),v.getShape())},e.areCollidingAABB=function(v,S,A,E){var R=e.getBoxShapeValues(v,S),O=e.getBoxShapeValues(A,E);return R.min.x<=O.max.x&&R.max.x>=O.min.x&&R.min.y<=O.max.y&&R.max.y>=O.min.y&&R.min.z<=O.max.z&&R.max.z>=O.min.z},e.areCollidingSphere=function(v,S,A,E){return Vector3.DistanceSquared(v.add(S.position),A.add(E.position))<S.radius*S.radius+E.radius*E.radius},e.areCollidingAABBSphere=function(v,S,A,E){var R=e.getBoxShapeValues(v,S),O=A.add(E.position),M=E.radius,B=0;return O.x<R.min.x&&(B+=(R.min.x-O.x)*(R.min.x-O.x)),O.x>R.max.x&&(B+=(O.x-R.max.x)*(O.x-R.max.x)),O.y<R.min.y&&(B+=(R.min.y-O.y)*(R.min.y-O.y)),O.y>R.max.y&&(B+=(O.y-R.max.y)*(O.y-R.max.y)),O.z<R.min.z&&(B+=(R.min.z-O.z)*(R.min.z-O.z)),O.z>R.max.z&&(B+=(O.z-R.max.z)*(O.z-R.max.z)),B<M*M},e.getBoxShapeValues=function(v,S){var A=v.add(S.position);return{center:A,min:A.subtract(S.size.scale(.5)),max:A.add(S.size.scale(.5))}},e._instance=null,e}(),it=function(){function e(v){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=v,v&&(this._trigger=v.getComponent(rt),this._uuid=v.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),e.prototype.getGlobalPosition=function(){return this._entity?e.getEntityWorldPosition(this._entity):Vector3.Zero()},e.prototype.getShape=function(){return this._trigger.shape},e.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},e.prototype.getActiveCollisions=function(){var v=[];for(var S in this._collidingWith)this._collidingWith.hasOwnProperty(S)&&v.push(this._collidingWith[S]);return v},e.prototype.hasActiveCollision=function(v){return null!=this._collidingWith[v.uuid]&&null!=this._collidingWith[v.uuid]},e.prototype.disengageActiveCollision=function(v){delete this._collidingWith[v.uuid]},e.prototype.engageCollision=function(v){this._collidingWith[v.uuid]=v},e.prototype.isDebugging=function(){return this._isDebug},e.prototype.addDebugEntity=function(){return o(this,void 0,void 0,(function(){var v,A,E;return a(this,(function(R){switch(R.label){case 0:return[4,!S.isPreviewMode()];case 1:return R.sent()||(e._debugMaterial||(e._debugMaterial=new Material,e._debugMaterial.alphaTest=.5),null==this._debugEntity&&(this._debugEntity=new Entity,v=new Transform,this._debugEntity.addComponent(v),this._debugEntity.addComponent(e._debugMaterial),this.getShape()instanceof P&&((A=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(A),v.scale=this.getShape().size),this.getShape()instanceof k&&((A=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(A),E=this.getShape().radius,v.scale=new Vector3(E,E,E))),engine.addEntity(this._debugEntity)),[2]}}))}))},e.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},e.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},e.getEntityWorldPosition=function(v){var S=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),A=v.getParent();if(null!=A){var E=A.hasComponent(Transform)?A.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(A).add(S.rotate(E))}return S},e._debugMaterial=null,e}(),ot=function(v){function t(S){var A=v.call(this)||this;return A._shape=S,A._uuid="cameraTrigger",A}return i(t,v),t.prototype.getGlobalPosition=function(){return Camera.instance.position},t.prototype.getShape=function(){return this._shape},t.prototype.setShape=function(v){this._shape=v},t.prototype.isInEngine=function(){return!1},t.prototype.hasActiveCollision=function(v){return!1},t.prototype.disengageActiveCollision=function(v){},t.prototype.engageCollision=function(v){},t.prototype.isDebugging=function(){return!1},t}(it),rt=function(){function e(v,S){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,this._debugEnabled=!1,nt.createAndAddToEngine(),this.shape=v,S&&(S.layer&&(this.layer=S.layer),S.triggeredByLayer&&(this.triggeredByLayer=S.triggeredByLayer),S.onTriggerEnter&&(this.onTriggerEnter=S.onTriggerEnter),S.onTriggerExit&&(this.onTriggerExit=S.onTriggerExit),S.onCameraEnter&&(this.onCameraEnter=S.onCameraEnter),S.onCameraExit&&(this.onCameraExit=S.onCameraExit),S.enableDebug&&(this._debugEnabled=S.enableDebug))}return Object.defineProperty(e.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),r([Component("triggerComponent")],e)}(),P=function(v,S){void 0===v&&(v=Vector3.One().scale(2)),void 0===S&&(S=Vector3.Zero()),this.size=v,this.position=S},k=function(v,S){void 0===v&&(v=2),void 0===S&&(S=Vector3.Zero()),this.radius=v,this.position=S};v.ActionsSequenceSystem=function(){function e(v){this.beginSequenceNode=null,this.currentSequenceNode=null,this.running=!1,this.started=!1,v&&this.startSequence(v)}return e.prototype.startSequence=function(v){this.beginSequenceNode=v.beginSequenceNode,this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.setOnFinishCallback=function(v){this.onFinishCallback=v},e.prototype.isRunning=function(){return this.running},e.prototype.stop=function(){this.running=!1},e.prototype.resume=function(){null!=this.beginSequenceNode&&(this.running=!0)},e.prototype.reset=function(){this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.getRunningAction=function(){var v=this.currentSequenceNode;if(this.currentSequenceNode instanceof at)do{v=v.currentInnerSequence}while(v instanceof at);return v.action},e.prototype.update=function(v){this.running&&(this.started?this.currentSequenceNode.hasFinish()?(this.currentSequenceNode.onFinish(),this.currentSequenceNode=this.currentSequenceNode.next,this.currentSequenceNode?this.currentSequenceNode.onStart():(this.running=!1,this.onFinishCallback&&this.onFinishCallback())):this.currentSequenceNode.update(v):(this.currentSequenceNode.onStart(),this.started=!0))},e}(),$=v.ActionsSequenceSystem||(v.ActionsSequenceSystem={}),et=function(){function e(){this.currentSequenceNode=null,this.beginSequenceNode=null,this.whileNodeStack=[]}return e.prototype.then=function(v){if(null==this.currentSequenceNode)this.currentSequenceNode=new st,this.currentSequenceNode.action=v,this.beginSequenceNode=this.currentSequenceNode;else{var S=new st;S.action=v,this.currentSequenceNode=this.currentSequenceNode.then(S)}return this},e.prototype.if=function(v){var S=new ht(v);return null==this.currentSequenceNode?(this.currentSequenceNode=S,this.beginSequenceNode=S):this.currentSequenceNode=this.currentSequenceNode.then(S),this},e.prototype.else=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof ht))throw new Error("IF statement is needed to be called before ELSE statement.");v.closed=!0;var S=new ut(v);return this.currentSequenceNode=this.currentSequenceNode.then(S),this},e.prototype.endIf=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof ht||v instanceof ut))throw new Error("IF statement is needed to be called before ENDIF statement.");return v.closed=!0,this},e.prototype.while=function(v){var S=new lt(v);return null==this.currentSequenceNode?(this.currentSequenceNode=S,this.beginSequenceNode=S):this.currentSequenceNode=this.currentSequenceNode.then(S),this.whileNodeStack.push(S),this},e.prototype.endWhile=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof lt))throw new Error("WHILE statement is needed to be called before ENDWHILE statement.");return v.closed=!0,this.whileNodeStack.length>0&&this.whileNodeStack.splice(this.whileNodeStack.length-1,1),this},e.prototype.breakWhile=function(){if(!(this.whileNodeStack.length>0))throw new Error("WHILE statement is needed to be called before BREAKWHILE statement.");return this.currentSequenceNode=this.currentSequenceNode.then(new ct(this.whileNodeStack[this.whileNodeStack.length-1])),this},e}(),$.SequenceBuilder=et;var st=function(){function e(){this.action=null,this.next=null}return e.prototype.then=function(v){return this.next=v,v},e.prototype.onStart=function(){this.action&&this.action.onStart()},e.prototype.update=function(v){this.action&&this.action.update(v)},e.prototype.onFinish=function(){this.action&&this.action.onFinish()},e.prototype.hasFinish=function(){return!this.action||this.action.hasFinished},e.prototype.getSequence=function(){return this},e}(),at=function(v){function t(){var S=null!==v&&v.apply(this,arguments)||this;return S.currentInnerSequence=null,S.startingInnerSequence=null,S.closed=!1,S}return i(t,v),t.prototype.then=function(v){if(null==this.currentInnerSequence)this.currentInnerSequence=v,this.startingInnerSequence=v;else{if(this.closed)return this.next=v,v;this.currentInnerSequence=this.currentInnerSequence.then(v)}return this},t.prototype.onStart=function(){this.currentInnerSequence=this.startingInnerSequence,this.currentInnerSequence&&this.currentInnerSequence.onStart()},t.prototype.update=function(v){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(v))},t.prototype.onFinish=function(){this.currentInnerSequence&&this.currentInnerSequence.onFinish()},t.prototype.hasFinish=function(){return null==this.currentInnerSequence},t.prototype.getSequence=function(){if(this.currentInnerSequence){var v=this.currentInnerSequence.getSequence();if(v instanceof t&&!v.closed)return v}return this},t}(st),ht=function(v){function t(S){var A=v.call(this)||this;return A.result=!1,A.condition=S,A}return i(t,v),t.prototype.onStart=function(){this.result=this.condition(),this.result?v.prototype.onStart.call(this):this.currentInnerSequence=null},t}(at),ut=function(v){function t(S){var A=v.call(this)||this;return A.ifSequence=null,A.ifSequence=S,A}return i(t,v),t.prototype.onStart=function(){this.ifSequence&&!this.ifSequence.result?v.prototype.onStart.call(this):this.currentInnerSequence=null},t}(at),lt=function(v){function t(S){var A=v.call(this)||this;return A.breakWhile=!1,A.condition=S,A}return i(t,v),t.prototype.onStart=function(){this.breakWhile=!1,this.condition()?v.prototype.onStart.call(this):this.currentInnerSequence=null},t.prototype.update=function(v){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,null==this.currentInnerSequence&&(this.currentInnerSequence=this.startingInnerSequence),this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(v))},t.prototype.hasFinish=function(){return this.breakWhile||!this.condition()},t}(at),ct=function(v){function t(S){var A=v.call(this)||this;return A.whileNode=S,A}return i(t,v),t.prototype.onStart=function(){this.whileNode.breakWhile=!0},t}(st);v.Delay=Z,v.ExpireIn=K,v.FollowCurvedPathComponent=H,v.FollowPathComponent=W,v.Interpolate=h,v.Interval=J,v.KeepRotatingComponent=V,v.MoveTransformComponent=O,v.RotateTransformComponent=M,v.ScaleTransformComponent=B,v.SequenceNode=st,v.ToggleComponent=X,v.TransformSystem=E,v.TriggerBoxShape=P,v.TriggerComponent=rt,v.TriggerSphereShape=k,v.TriggerSystem=nt,v.addLabel=I,v.addOneTimeTrigger=function(v,S,A){var E=!1,R=!1,O=new Entity;O.addComponent(new Transform({}));var M={};return S.layer&&(M.layer=S.layer),S.triggeredByLayer&&(M.triggeredByLayer=S.triggeredByLayer),S.onCameraEnter&&(M.onCameraEnter=function(){E||(E=!0,S.onCameraEnter()),!E&&S.onCameraEnter||!R&&S.onCameraExit||engine.removeEntity(O)}),S.onCameraExit&&(M.onCameraExit=function(){R||(R=!0,S.onCameraExit()),!E&&S.onCameraEnter||!R&&S.onCameraExit||engine.removeEntity(O)}),S.enableDebug&&(M.enableDebug=S.enableDebug),O.addComponent(new rt(v,M)),A&&O.setParent(A),engine.addEntity(O),O},v.addTestCube=function(v,A,E,R,O,M,B){return o(this,void 0,void 0,(function(){var W,H,V;return a(this,(function(X){switch(X.label){case 0:return(W=!B)?[4,!S.isPreviewMode()]:[3,2];case 1:W=X.sent(),X.label=2;case 2:return W?[2]:((H=new Entity).addComponent(new Transform(v)),O?(H.addComponent(new SphereShape),H.getComponent(Transform).scale.setAll(.5)):H.addComponent(new BoxShape),engine.addEntity(H),H.addComponent(new OnPointerDown(A,{hoverText:E||"click",button:ActionButton.POINTER})),R&&((V=new Material).albedoColor=R,H.addComponent(V)),M&&(H.getComponent(BoxShape).withCollisions=!1),E&&I(E,H,!0),[2,H])}}))}))},v.clamp=function(v,S,A){var E=v;return v>A?E=A:v<S&&(E=S),E},v.getEntityWorldPosition=function e(v){var S=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),A=v.getParent();if(null!=A&&"0"!=A.uuid){if("FirstPersonCameraEntityReference"==A.uuid){var E=Camera.instance.rotation.clone();return Camera.instance.position.clone().add(S.rotate(E))}if("AvatarEntityReference"==A.uuid){var R=Camera.instance.rotation;return E=Quaternion.Euler(0,R.eulerAngles.y,0),Camera.instance.position.clone().add(S.rotate(E)).add(new Vector3(0,-.875,0))}return E=A.hasComponent(Transform)?A.getComponent(Transform).rotation:Quaternion.Identity,e(A).add(S.rotate(E))}return S},v.getEntityWorldRotation=function e(v){var S=v.hasComponent(Transform)?v.getComponent(Transform).rotation.clone():Quaternion.Zero(),A=v.getParent();if(null!=A&&"0"!=A.uuid){if("FirstPersonCameraEntityReference"==A.uuid){var E=Camera.instance.rotation.clone();return S.multiply(E)}return"AvatarEntityReference"==A.uuid?(E=Quaternion.Euler(0,Camera.instance.rotation.eulerAngles.y,0),S.multiply(E)):(E=e(A),S.multiply(E))}return S},v.map=function(v,S,A,E,R){return(v-S)/(A-S)*(R-E)+E},v.sendRequest=function(v,S,A,E){return o(this,void 0,void 0,(function(){var R,O,M;return a(this,(function(B){switch(B.label){case 0:return B.trys.push([0,6,,7]),R={method:S||"GET"},A&&(R.headers=A),E&&(R.body=JSON.stringify(E)),[4,fetch(v,R)];case 1:O=B.sent(),B.label=2;case 2:return B.trys.push([2,4,,5]),[4,O.json()];case 3:return[2,B.sent()];case 4:return B.sent(),[2,O];case 5:return[3,7];case 6:return M=B.sent(),log("error fetching from ",v," : ",M),[3,7];case 7:return[2]}}))}))},v.setTimeout=function(v,S){var A=new Entity;return A.addComponent(new Z(v,(function(){S(),engine.removeEntity(A)}))),engine.addEntity(A),A},Object.defineProperty(v,"__esModule",{value:!0})})),function(v,S){"object"==typeof exports&&"undefined"!=typeof module?S(exports):"function"==typeof define&&define.amd?define("@dcl/npc-scene-utils",["exports"],S):S((v="undefined"!=typeof globalThis?globalThis:v||self)["@dcl/npc-scene-utils"]={})}(this,(function(v){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(v,S){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,S){v.__proto__=S}||function(v,S){for(var A in S)Object.prototype.hasOwnProperty.call(S,A)&&(v[A]=S[A])})(v,S)};function i(v,S){function o(){this.constructor=v}e(v,S),v.prototype=null===S?Object.create(S):(o.prototype=S.prototype,new o)}function o(v,S,A,E){var R,O=arguments.length,M=O<3?S:null===E?E=Object.getOwnPropertyDescriptor(S,A):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)M=Reflect.decorate(v,S,A,E);else for(var B=v.length-1;B>=0;B--)(R=v[B])&&(M=(O<3?R(M):O>3?R(S,A,M):R(S,A))||M);return O>3&&M&&Object.defineProperty(S,A,M),M}function n(v){var S="function"==typeof Symbol&&Symbol.iterator,A=S&&v[S],E=0;if(A)return A.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}var S=o([Component("trackUserFlag")],(function(v,S,E){this.lockXZRotation=!1,this.active=!1,A||(A=!0,engine.addSystem(new R)),this.lockXZRotation=v||!1,this.rotSpeed=S||2,E&&(this.active=!0)})),A=!1,E=Camera.instance,R=function(){function t(){this.followingNPCs=engine.getComponentGroup(S)}return t.prototype.update=function(v){var A,R;try{for(var O=n(this.followingNPCs.entities),M=O.next();!M.done;M=O.next()){var B=M.value,W=B.getComponent(Transform),H=B.getComponent(S);if(H.active){var V=new Vector3(E.position.x,E.position.y,E.position.z).subtract(W.position);W.rotation=Quaternion.Slerp(W.rotation,Quaternion.LookRotation(V),v*H.rotSpeed),H.lockXZRotation&&(W.rotation.x=0,W.rotation.z=0)}}}catch(v){A={error:v}}finally{try{M&&!M.done&&(R=O.return)&&R.call(O)}finally{if(A)throw A.error}}},t}(),O=new UICanvas;O.visible=!0;var M,B,W,H=new Font(Fonts.SanFrancisco),V=new Font(Fonts.SanFrancisco_Heavy),X=new Texture("https://decentraland.org/images/ui/light-atlas-v3.png"),Q=new Texture("https://decentraland.org/images/ui/dark-atlas-v3.png"),Z=new Texture("https://decentraland.org/images/ui/dialog-bubbles.png");function T(v,S,A,E){void 0===A&&(A=512),void 0===E&&(E=512),function(v,S,A,E,R){v.uvs=[S.x,S.y,A.x,A.y,E.x,E.y,R.x,R.y,S.x,S.y,A.x,A.y,E.x,E.y,R.x,R.y]}(v,new Vector2(S.sourceLeft/A,(E-S.sourceTop-S.sourceHeight)/E),new Vector2((S.sourceLeft+S.sourceWidth)/A,(E-S.sourceTop-S.sourceHeight)/E),new Vector2((S.sourceLeft+S.sourceWidth)/A,(E-S.sourceTop)/E),new Vector2(S.sourceLeft/A,(E-S.sourceTop)/E))}function C(v,S){v.sourceWidth=S.sourceWidth,v.sourceHeight=S.sourceHeight,v.sourceLeft=S.sourceLeft?S.sourceLeft:0,v.sourceTop=S.sourceTop?S.sourceTop:0}function y(v){var S=-10-4*v;return S>-65?S:-65}(M=v.ButtonStyles||(v.ButtonStyles={})).E="e",M.F="f",M.DARK="dark",M.RED="red",M.ROUNDBLACK="roundblack",M.ROUNDWHITE="roundwhite",M.ROUNDSILVER="roundsilver",M.ROUNDGOLD="roundgold",M.SQUAREBLACK="squareblack",M.SQUAREWHITE="squarewhite",M.SQUARESILVER="squaresilver",M.SQUAREGOLD="squaregold",M.WHITE="white",(B=v.NPCState||(v.NPCState={})).STANDING="standing",B.TALKING="talking",B.FOLLOWPATH="followPath",(W=v.NPCLerpType||(v.NPCLerpType={})).SMOOTH_PATH="smooth",W.RIGID_PATH="rigid";var K,J={buttons:{buttonE:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonF:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},white:{sourceWidth:174,sourceHeight:46,sourceLeft:698,sourceTop:662},buttonRed:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonDark:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},roundBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:458},squareBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:457},roundWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:494},squareWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:493},roundSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:531},squareSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:531},roundGold:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:567},squareGold:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:567}},buttonLabels:{E:{sourceWidth:26,sourceHeight:26,sourceLeft:697,sourceTop:611},F:{sourceWidth:26,sourceHeight:26,sourceLeft:733,sourceTop:611},EBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:766,sourceTop:611},FBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:802,sourceTop:611}},backgrounds:{promptBackground:{sourceWidth:416,sourceHeight:352,sourceLeft:501,sourceTop:12},promptLargeBackground:{sourceWidth:480,sourceHeight:384,sourceLeft:7,sourceTop:12},promptSlantedBackground:{sourceWidth:486,sourceHeight:326,sourceLeft:7,sourceTop:413},NPCDialog:{sourceWidth:766,sourceHeight:248,sourceLeft:22,sourceTop:756}},icons:{closeW:{sourceWidth:32,sourceHeight:32,sourceLeft:942,sourceTop:306},closeD:{sourceWidth:32,sourceHeight:32,sourceLeft:986,sourceTop:306},closeWLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:512,sourceTop:381},closeDLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:583,sourceTop:381},closeWNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:252},closeDNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:214},closeWNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:214},closeDNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:260},FDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:4},FWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:4},EDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:40},EWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:40},Timer:{sourceWidth:24,sourceHeight:32.2,sourceLeft:718,sourceTop:388},TimerLarge:{sourceWidth:48,sourceHeight:68,sourceLeft:662,sourceTop:386},ClickWhite:{sourceWidth:32,sourceHeight:48,sourceLeft:799,sourceTop:389},ClickDark:{sourceWidth:32,sourceHeight:48,sourceLeft:757,sourceTop:389}},checkboxes:{wOff:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:76},wOn:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:104},dOff:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:76},dOn:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:104},wLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:132},wLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:168},dLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:132},dLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:168}},switches:{roundOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:454},roundRed:{sourceWidth:64,sourceHeight:32,sourceLeft:853,sourceTop:454},roundGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:923,sourceTop:454},squareOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:501},squareRed:{sourceWidth:64,sourceHeight:32,sourceLeft:852,sourceTop:501},squareGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:921,sourceTop:501}},bubbles:{short:{sourceWidth:232,sourceHeight:168,sourceLeft:610,sourceTop:834},normal:{sourceWidth:572,sourceHeight:168,sourceLeft:16,sourceTop:834},long:{sourceWidth:994,sourceHeight:306,sourceLeft:12,sourceTop:508},huge:{sourceWidth:994,sourceHeight:478,sourceLeft:12,sourceTop:14}}},$=function(){function t(S,A){var E=this;nt.createAndAddToEngine(),this.elapsedTime=0,this.targetTime=S,this.onTimeReachedCallback=A,this.onTargetTimeReached=function(S){E.onTimeReachedCallback(),S.removeComponent(v)}}var v;return v=t,t.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=o([Component("npcTimerDelay")],t)}(),et=engine.getComponentGroup($),nt=function(){function t(){t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){var S,A;try{for(var E=n(et.entities),R=E.next();!R.done;R=E.next()){var O=R.value,M=O.getComponent($);M.elapsedTime+=v,M.elapsedTime>=M.targetTime&&M.onTargetTimeReached(O)}}catch(v){S={error:v}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}},t._instance=null,t}();!function(v){v[v.Confirm=0]="Confirm",v[v.Cancel=1]="Cancel",v[v.Next=2]="Next",v[v.Button3=3]="Button3",v[v.Button4=4]="Button4"}(K||(K={}));var it=.75,ot=-262.5,rt=262.5,st=37.5,at=192,ht=192,ut=7.5,lt=112.5,ct=112.5,pt=-48.75,dt=-48.75,gt=19.5,yt=19.5,ft=function(){function e(S,A,E,R){var M=this;this.NPCScript=[],this.isDialogOpen=!1,this.isQuestionPanel=!1,this.isFixedScreen=!1,this.activeTextId=0,this.UIOpenTime=0,this.defaultSound=null,this.canvas=O,this.ClickAction=null,this.EButtonAction=null,this.FButtonAction=null,this.defaultPortrait=S||null,this.uiTheme=R||(A?Q:X),this.container=new UIContainerRect(O),this.container.width="100%",this.container.vAlign="bottom",this.container.positionY=105,this.container.visible=!1,this.panel=new UIImage(this.container,this.uiTheme),C(this.panel,J.backgrounds.NPCDialog),this.panel.width=574.5,this.panel.height=186,this.panel.onClick=new OnClick((function(){M.confirmText(K.Next)})),this.defaultPortraitTexture=new Texture(S?S.path:this.uiTheme.src),this.portrait=new UIImage(this.container,this.defaultPortraitTexture),this.portrait.sourceWidth=S&&S.section?S.section.sourceWidth:256,this.portrait.sourceHeight=S&&S.section?S.section.sourceHeight:256,this.portrait.width=S&&S.width?S.width*it:at,this.portrait.height=S&&S.height?S.height*it:at,this.portrait.positionX=S&&S.offsetX?S.offsetX*it+ot:ot,this.portrait.positionY=S&&S.offsetY?S.offsetY*it+0:0,this.portrait.onClick=new OnClick((function(){M.confirmText(K.Next)})),this.image=new UIImage(this.container,new Texture(this.uiTheme.src)),this.image.sourceWidth=256,this.image.sourceHeight=256,this.image.sourceTop=0,this.image.sourceLeft=0,this.image.width=ht,this.image.height=ht,this.image.positionX=rt,this.image.positionY=st,this.image.onClick=new OnClick((function(){M.confirmText(K.Next)})),this.text=new UIText(this.container),this.text.adaptWidth=!1,this.text.textWrapping=!0,this.text.width=345,this.text.positionX=30,this.text.hAlign="center",this.text.vAlign="center",this.text.font=V,this.text.fontSize=18,this.text.hTextAlign="left",this.text.vTextAlign="center",this.text.positionY=ut,this.text.color=A?Color4.White():Color4.Black(),this.text.isPointerBlocker=!1,this.soundEnt=new Entity,this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(Attachable.AVATAR),E&&(this.soundEnt.addComponent(new AudioSource(new AudioClip(E))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=E),this.button1=new bt(this.container,this.uiTheme,"yes",lt,pt,(function(){M.confirmText(K.Confirm)}),!!A,v.ButtonStyles.E),this.button1.hide(),this.button2=new bt(this.container,this.uiTheme,"no",-60,dt,(function(){M.confirmText(K.Cancel)}),!!A,v.ButtonStyles.F),this.button2.hide(),this.button3=new bt(this.container,this.uiTheme,"maybe",-60,-60,(function(){M.confirmText(K.Button3)}),!!A,v.ButtonStyles.DARK),this.button3.hide(),this.button4=new bt(this.container,this.uiTheme,"maybe",ct,-60,(function(){M.confirmText(K.Button4)}),!!A,v.ButtonStyles.DARK),this.button4.hide(),this.skipButton=new bt(this.container,this.uiTheme,"Skip",-225,-75,(function(){M.skipDialogs()}),!1,Q?v.ButtonStyles.WHITE:v.ButtonStyles.F),this.skipButton.image.width=60,this.skipButton.image.height=22.5,this.skipButton.label.hTextAlign="left",this.skipButton.label.fontSize=9,this.skipButton.label.positionX=30,this.skipButton.label.font=V,this.skipButton.icon.height=15,this.skipButton.icon.width=15,this.skipButton.icon.positionX=-15,this.skipButton.hide(),this.leftClickIcon=new UIImage(this.container,this.uiTheme),this.leftClickIcon.width=24,this.leftClickIcon.height=36,this.leftClickIcon.positionX=255,this.leftClickIcon.positionY=-60,this.leftClickIcon.visible=!1,C(this.leftClickIcon,A?J.icons.ClickDark:J.icons.ClickWhite),vt.createAndAddToEngine()}return e.prototype.openDialogWindow=function(v,S){var A=this;this.UIOpenTime=+Date.now(),this.NPCScript=v,this.activeTextId=S?"number"==typeof S?S:z(v,S):0;var E=v[this.activeTextId]?v[this.activeTextId]:{text:""};if(E.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(E.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),E.portrait?(this.portrait.source=new Texture(E.portrait.path),this.portrait.positionX=E.portrait.offsetX?E.portrait.offsetX*it+ot:ot,this.portrait.positionY=E.portrait.offsetY?E.portrait.offsetY*it+0:0,this.portrait.width=E.portrait.width?E.portrait.width*it:at,this.portrait.height=E.portrait.height?E.portrait.height*it:at,E.portrait.section&&C(this.portrait,E.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=this.defaultPortraitTexture,this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*it+ot:ot,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*it+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*it:at,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*it:at,this.defaultPortrait.section&&C(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),E.image){var R=E.image;log("setting image to ",R.path),this.image.source=new Texture(R.path),this.image.positionX=R.offsetX?R.offsetX*it+rt:rt,this.image.positionY=R.offsetY?R.offsetY*it+st:st,this.image.width=R.width?R.width*it:ht,this.portrait.height=R.height?R.height*it:ht,R.section&&C(this.image,R.section),this.image.visible=!0}else this.image.visible=!1;this.text.fontSize=E.fontSize?E.fontSize*it:18,this.text.positionY=E.offsetY?E.offsetY*it+ut:ut,this.text.positionX=E.offsetX?E.offsetX*it:0,this.text.visible=!0,this.container.visible=!0,vt._instance.newText(this,E.text,this.activeTextId,E.typeSpeed?E.typeSpeed:void 0),this.ClickAction||(this.ClickAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,!1,(function(v){!A.isDialogOpen||+Date.now()-A.UIOpenTime<100||(vt._instance.done?A.isQuestionPanel||A.isFixedScreen||A.confirmText(K.Next):vt._instance.rush())})),this.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){!A.isDialogOpen||+Date.now()-A.UIOpenTime<100||(A.isQuestionPanel?A.confirmText(K.Confirm):A.isQuestionPanel||A.isFixedScreen||A.confirmText(K.Next))})),this.FButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){!A.isDialogOpen||+Date.now()-A.UIOpenTime<100||(A.isQuestionPanel?A.confirmText(K.Cancel):E.skipable&&!A.isFixedScreen&&A.skipDialogs())}))),this.layoutDialogWindow(this.activeTextId),this.isDialogOpen=!0},e.prototype.confirmText=function(v){var S=this.NPCScript[this.activeTextId];if(this.UIOpenTime=+Date.now(),v==K.Next&&!S.isQuestion){if(S.triggeredByNext&&S.triggeredByNext(),S.isEndOfDialog)return void this.closeDialogWindow();this.activeTextId++}v==K.Confirm&&S.buttons&&S.buttons.length>=1&&("number"==typeof S.buttons[0].goToDialog?this.activeTextId=S.buttons[0].goToDialog:this.activeTextId=z(this.NPCScript,S.buttons[0].goToDialog),S.buttons[0].triggeredActions&&S.buttons[0].triggeredActions()),v==K.Cancel&&S.buttons&&S.buttons.length>=2&&("number"==typeof S.buttons[1].goToDialog?this.activeTextId=S.buttons[1].goToDialog:this.activeTextId=z(this.NPCScript,S.buttons[1].goToDialog),S.buttons[1].triggeredActions&&S.buttons[1].triggeredActions()),v==K.Button3&&S.buttons&&S.buttons.length>=3&&("number"==typeof S.buttons[2].goToDialog?this.activeTextId=S.buttons[2].goToDialog:this.activeTextId=z(this.NPCScript,S.buttons[2].goToDialog),S.buttons[2].triggeredActions&&S.buttons[2].triggeredActions()),v==K.Button4&&S.buttons&&S.buttons.length>=4&&("number"==typeof S.buttons[3].goToDialog?this.activeTextId=S.buttons[3].goToDialog:this.activeTextId=z(this.NPCScript,S.buttons[3].goToDialog),S.buttons[3].triggeredActions&&S.buttons[3].triggeredActions()),S=this.NPCScript[this.activeTextId],vt._instance.newText(this,S.text,this.activeTextId,S.typeSpeed?S.typeSpeed:void 0)},e.prototype.layoutDialogWindow=function(v){var S=this,A=this.NPCScript[v]?this.NPCScript[v]:{text:""},E=A.offsetY?A.offsetY*it+ut:ut;if(A.buttons&&A.buttons.length>=3?E+=37.5:A.buttons&&A.buttons.length>=1&&(E+=18),this.text.fontSize=A.fontSize?A.fontSize*it:18,this.text.positionY=E,A.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(A.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),A.portrait?(this.portrait.source=new Texture(A.portrait.path),this.portrait.positionX=A.portrait.offsetX?A.portrait.offsetX*it+ot:ot,this.portrait.positionY=A.portrait.offsetY?A.portrait.offsetY*it+0:0,this.portrait.width=A.portrait.width?A.portrait.width*it:at,this.portrait.height=A.portrait.height?A.portrait.height*it:at,A.portrait.section&&C(this.portrait,A.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=new Texture(this.defaultPortrait.path),this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*it+ot:ot,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*it+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*it:at,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*it:at,this.defaultPortrait.section&&C(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),this.image.visible=!1,A.image){var R=A.image;log("setting image to ",R.path),this.image.source=new Texture(R.path),this.image.positionX=R.offsetX?R.offsetX*it+rt:rt,this.image.positionY=R.offsetY?R.offsetY*it+st:st,this.image.width=A.image.width?A.image.width*it:ht,this.image.height=A.image.height?A.image.height*it:ht,R.section&&C(this.image,R.section),this.image.visible=!0}else this.image.visible=!1;this.isQuestionPanel=!!A.isQuestion&&A.isQuestion,this.isFixedScreen=!!A.isFixedScreen&&A.isFixedScreen,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.leftClickIcon.visible=!1,A.isQuestion?(this.skipButton.hide(),A.buttons&&A.buttons.length>=1&&this.button1.update(A.buttons[0].label,A.buttons[0].offsetX?A.buttons[0].offsetX*it+lt:lt,A.buttons.length>=3?A.buttons[0].offsetY?A.buttons[0].offsetY*it-15:-15:A.buttons[0].offsetY?A.buttons[0].offsetY*it+pt:pt),A.buttons&&A.buttons.length>=2&&this.button2.update(A.buttons[1].label,A.buttons[1].offsetX*it?A.buttons[1].offsetX*it-60:-60,A.buttons.length>=3?A.buttons[1].offsetY*it?A.buttons[1].offsetY*it-15:-15:A.buttons[1].offsetY*it?A.buttons[1].offsetY*it+dt:dt),A.buttons&&A.buttons.length>=3&&this.button3.update(A.buttons[2].label,A.buttons[2].offsetX*it?A.buttons[2].offsetX*it-60:-60,A.buttons[2].offsetY*it?A.buttons[2].offsetY*it-60:-60),A.buttons&&A.buttons.length>=4&&this.button4.update(A.buttons[3].label,A.buttons[3].offsetX*it?A.buttons[3].offsetX*it+ct:ct,A.buttons[3].offsetY*it?A.buttons[3].offsetY*it-60:-60),Tt.addComponentOrReplace(new $(.7,(function(){A.buttons&&A.buttons.length>=1&&S.button1.show(),A.buttons&&A.buttons.length>=2&&S.button2.show(),A.buttons&&A.buttons.length>=3&&S.button3.show(),A.buttons&&A.buttons.length>=4&&S.button4.show()})))):this.isFixedScreen||(this.leftClickIcon.visible=!0,A.skipable?this.skipButton.show():this.skipButton.hide())},e.prototype.closeDialogWindow=function(){this.isDialogOpen&&(this.isDialogOpen=!1,this.portrait.visible=!1,this.text.value="",this.text.visible=!1,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.skipButton.hide(),this.leftClickIcon.visible=!1,this.container.visible=!1)},e.prototype.skipDialogs=function(){if(this.isDialogOpen&&!(+Date.now()-this.UIOpenTime<100)){for(;this.NPCScript[this.activeTextId]&&this.NPCScript[this.activeTextId].skipable&&!this.NPCScript[this.activeTextId].isQuestion;){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].skipable&&this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}this.confirmText(K.Next)}},e}(),vt=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.UIText=null,this.done=!0,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){if(!this.done&&(this.timer+=v,this.timer>=2/this.speed)){var S=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=S,this.closeTag(S),this.visibleChars>=this.fullText.length&&(this.done=!0,this.visibleChars=this.fullText.length),this.UIText&&(this.UIText.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(v,S,A,E){this.timer=0,this.done=!1,this.UIText=v.text,this.fullText=S,this.visibleChars=0,E&&E<=0?this.rush():this.speed=E||45,v.layoutDialogWindow(A)},t.prototype.rush=function(){this.done=!0,this.timer=0,this.visibleChars=this.fullText.length,this.UIText&&(this.UIText.value=this.fullText)},t.prototype.closeTag=function(v){if(0!=this.visibleChars&&0!=v){for(var S=!1,A=!1,E=this.visibleChars-v;E<this.visibleChars;E++)S?">"==this.fullText.substr(E,1)&&(A=!0):"<"==this.fullText.substr(E,1)&&(S=!0);if(S&&!A)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),bt=function(S){function o(A,E,R,O,M,B,W,V){var Z=S.call(this)||this;if(Z.icon=null,Z.image=new UIImage(A,E),Z.image.positionX=O,Z.image.positionY=M,Z.image.width=130.5,Z.image.height=34.5,Z.label=new UIText(Z.image),Z.style=V||null,Z.onClick=B,Z.style)switch(Z.style){case v.ButtonStyles.E:C(Z.image,J.buttons.buttonE),Z.label.positionX=18.75,Z.icon=new UIImage(Z.image,1==W?Q:X),Z.icon.width=gt,Z.icon.height=yt,Z.icon.hAlign="center",Z.icon.vAlign="center",Z.icon.isPointerBlocker=!1,C(Z.icon,J.buttonLabels.E),Z.icon.positionX=y(R.length);break;case v.ButtonStyles.F:C(Z.image,J.buttons.buttonF),Z.label.positionX=18.75,Z.icon=new UIImage(Z.image,1==W?Q:X),Z.icon.width=gt,Z.icon.height=yt,Z.icon.hAlign="center",Z.icon.vAlign="center",Z.icon.isPointerBlocker=!1,C(Z.icon,J.buttonLabels.F),Z.icon.positionX=y(R.length);break;case v.ButtonStyles.WHITE:C(Z.image,J.buttons.white),Z.label.positionX=18.75,Z.icon=new UIImage(Z.image,1==W?Q:X),Z.icon.width=gt,Z.icon.height=yt,Z.icon.hAlign="center",Z.icon.vAlign="center",Z.icon.isPointerBlocker=!1,C(Z.icon,J.buttonLabels.FBlack),Z.icon.positionX=y(R.length);break;case v.ButtonStyles.RED:C(Z.image,J.buttons.buttonRed);break;case v.ButtonStyles.DARK:C(Z.image,J.buttons.buttonDark);break;case v.ButtonStyles.ROUNDBLACK:C(Z.image,J.buttons.roundBlack);break;case v.ButtonStyles.ROUNDWHITE:C(Z.image,J.buttons.roundWhite);break;case v.ButtonStyles.ROUNDSILVER:C(Z.image,J.buttons.roundSilver);break;case v.ButtonStyles.ROUNDGOLD:C(Z.image,J.buttons.roundGold);break;case v.ButtonStyles.SQUAREBLACK:C(Z.image,J.buttons.squareBlack);break;case v.ButtonStyles.SQUAREWHITE:C(Z.image,J.buttons.squareWhite);break;case v.ButtonStyles.SQUARESILVER:C(Z.image,J.buttons.squareSilver);break;case v.ButtonStyles.SQUAREGOLD:C(Z.image,J.buttons.squareGold)}else C(Z.image,J.buttons.roundSilver);return Z.label.value=R,Z.label.hTextAlign="center",Z.label.vTextAlign="center",Z.label.fontSize=15,Z.label.font=H,Z.label.color=V==v.ButtonStyles.ROUNDWHITE||V==v.ButtonStyles.SQUAREWHITE||V==v.ButtonStyles.WHITE?Color4.Black():Color4.White(),Z.label.isPointerBlocker=!1,Z.image.onClick=new OnClick((function(){Z.onClick()})),V==v.ButtonStyles.E?Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){Z.image.visible&&Z.onClick()})):V==v.ButtonStyles.F&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){Z.image.visible&&Z.onClick()})),Z}return i(o,S),o.prototype.hide=function(){this.image.visible=!1},o.prototype.show=function(){this.image.visible=!0},o.prototype.grayOut=function(){this.label.color=Color4.Gray(),this.image.isPointerBlocker=!1},o.prototype.enable=function(){this.label.color=Color4.White(),this.image.isPointerBlocker=!0},o.prototype.update=function(S,A,E){this.label.value=S,this.image.positionX=A,this.image.positionY=E,!this.icon||this.style!=v.ButtonStyles.E&&this.style!=v.ButtonStyles.F||(this.icon.positionX=y(S.length))},o}(Entity),Tt=new Entity;function z(v,S){for(var A=0;A<v.length;A++)if(v[A].name&&v[A].name==S)return A;return 0}engine.addEntity(Tt);var xt=function(){function t(){this._triggers={},t._instance=this,this._cameraTriggerWrapper=new wt(new j(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(St)}return Object.defineProperty(t,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.setCameraTriggerShape=function(v){this._cameraTriggerWrapper.setShape(v)},t.prototype.update=function(){var v=this,S=this._componentGroup.entities;for(var A in S.forEach((function(S){v.shouldWrapTriggerEntity(S)&&v.wrapTriggerEntity(S)})),this._triggers)if(this._triggers.hasOwnProperty(A)){var E=this._triggers[A];E.isDebugging()&&E.updateDebugEntity(),E.isInEngine()?null!=E.trigger&&E.trigger.enabled?(E.wasEnabled||E.isDebugging()&&E.addDebugEntity(),E.wasEnabled=!0,(E.trigger.onCameraEnter||E.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(E),(E.trigger.onTriggerEnter||E.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(E)):E.wasEnabled&&(E.wasEnabled=!1,E.isDebugging()&&E.removeDebugEntity(),t.removeTriggerFromSystem(E)):(E.isDebugging()&&E.removeDebugEntity(),t.removeTriggerFromSystem(E),delete this._triggers[A])}},t.prototype.shouldWrapTriggerEntity=function(v){return null==this._triggers[v.uuid]||null==this._triggers[v.uuid]},t.prototype.wrapTriggerEntity=function(v){this._triggers[v.uuid]=new Ct(v)},t.removeTriggerFromSystem=function(v){for(var S,A=v.getActiveCollisions(),E=0;E<A.length;E++)!(A[E]===(null===(S=t._instance)||void 0===S?void 0:S._cameraTriggerWrapper)||null==A[E].trigger)&&A[E].trigger.onTriggerExit&&v.entity&&A[E].trigger.onTriggerExit(v.entity),A[E].disengageActiveCollision(v),v.disengageActiveCollision(A[E])},t.disengageCollision=function(v,S){v.disengageActiveCollision(S),S.disengageActiveCollision(v),v.trigger.onTriggerExit&&S.entity&&v.trigger.onTriggerExit(S.entity),S.trigger.onTriggerExit&&v.entity&&S.trigger.onTriggerExit(v.entity)},t.engageCollision=function(v,S){v.engageCollision(S),S.engageCollision(v),v.trigger.onTriggerEnter&&S.entity&&v.trigger.onTriggerEnter(S.entity),S.trigger.onTriggerEnter&&v.entity&&S.trigger.onTriggerEnter(v.entity)},t.prototype.checkCollisionAgainstCamera=function(v){var S=v.hasActiveCollision(this._cameraTriggerWrapper),A=t.areColliding(v,this._cameraTriggerWrapper);S&&!A?(v.disengageActiveCollision(this._cameraTriggerWrapper),v.trigger.onCameraExit&&v.trigger.onCameraExit()):!S&&A&&(v.engageCollision(this._cameraTriggerWrapper),v.trigger.onCameraEnter&&v.trigger.onCameraEnter())},t.prototype.checkCollisionAgainstOtherTriggers=function(v){for(var S in this._triggers)if(this._triggers.hasOwnProperty(S)&&S!=v.uuid&&this._triggers[S].trigger.enabled&&t.canTriggersCollide(v,this._triggers[S])){var A=v.hasActiveCollision(this._triggers[S]),E=t.areColliding(v,this._triggers[S]);A&&!E?t.disengageCollision(v,this._triggers[S]):!A&&E&&t.engageCollision(v,this._triggers[S])}},t.canTriggersCollide=function(v,S){return 0==v.trigger.triggeredByLayer||0!=(S.trigger.layer&v.trigger.triggeredByLayer)},t.areColliding=function(v,S){return v.getShape()instanceof j&&S.getShape()instanceof j?t.areCollidingAABB(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof q&&S.getShape()instanceof q?t.areCollidingSphere(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof j&&S.getShape()instanceof q?t.areCollidingAABBSphere(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof q&&S.getShape()instanceof j&&t.areCollidingAABBSphere(S.getGlobalPosition(),S.getShape(),v.getGlobalPosition(),v.getShape())},t.areCollidingAABB=function(v,S,A,E){var R=t.getBoxShapeValues(v,S),O=t.getBoxShapeValues(A,E);return R.min.x<=O.max.x&&R.max.x>=O.min.x&&R.min.y<=O.max.y&&R.max.y>=O.min.y&&R.min.z<=O.max.z&&R.max.z>=O.min.z},t.areCollidingSphere=function(v,S,A,E){return Vector3.DistanceSquared(v.add(S.position),A.add(E.position))<S.radius*S.radius+E.radius*E.radius},t.areCollidingAABBSphere=function(v,S,A,E){var R=t.getBoxShapeValues(v,S),O=A.add(E.position),M=E.radius,B=0;return O.x<R.min.x&&(B+=(R.min.x-O.x)*(R.min.x-O.x)),O.x>R.max.x&&(B+=(O.x-R.max.x)*(O.x-R.max.x)),O.y<R.min.y&&(B+=(R.min.y-O.y)*(R.min.y-O.y)),O.y>R.max.y&&(B+=(O.y-R.max.y)*(O.y-R.max.y)),O.z<R.min.z&&(B+=(R.min.z-O.z)*(R.min.z-O.z)),O.z>R.max.z&&(B+=(O.z-R.max.z)*(O.z-R.max.z)),B<M*M},t.getBoxShapeValues=function(v,S){var A=v.add(S.position);return{center:A,min:A.subtract(S.size.scale(.5)),max:A.add(S.size.scale(.5))}},t._instance=null,t}(),Ct=function(){function t(v){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=v,v&&(this._trigger=v.getComponent(St),this._uuid=v.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(t.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),t.prototype.getGlobalPosition=function(){return this._entity?t.getEntityWorldPosition(this._entity):Vector3.Zero()},t.prototype.getShape=function(){return this._trigger.shape},t.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},t.prototype.getActiveCollisions=function(){var v=[];for(var S in this._collidingWith)this._collidingWith.hasOwnProperty(S)&&v.push(this._collidingWith[S]);return v},t.prototype.hasActiveCollision=function(v){return null!=this._collidingWith[v.uuid]&&null!=this._collidingWith[v.uuid]},t.prototype.disengageActiveCollision=function(v){delete this._collidingWith[v.uuid]},t.prototype.engageCollision=function(v){this._collidingWith[v.uuid]=v},t.prototype.isDebugging=function(){return this._isDebug},t.prototype.addDebugEntity=function(){if(t._debugMaterial||(t._debugMaterial=new Material,t._debugMaterial.alphaTest=.5),null==this._debugEntity){this._debugEntity=new Entity;var v=new Transform;if(this._debugEntity.addComponent(v),this._debugEntity.addComponent(t._debugMaterial),this.getShape()instanceof j&&((S=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(S),v.scale=this.getShape().size),this.getShape()instanceof q){var S;(S=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(S);var A=this.getShape().radius;v.scale=new Vector3(A,A,A)}}engine.addEntity(this._debugEntity)},t.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},t.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},t.getEntityWorldPosition=function(v){var S=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),A=v.getParent();if(null!=A){var E=A.hasComponent(Transform)?A.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(A).add(S.rotate(E))}return S},t._debugMaterial=null,t}(),wt=function(v){function e(S){var A=v.call(this)||this;return A._shape=S,A._uuid="cameraTrigger",A}return i(e,v),e.prototype.getGlobalPosition=function(){return Camera.instance.position},e.prototype.getShape=function(){return this._shape},e.prototype.setShape=function(v){this._shape=v},e.prototype.isInEngine=function(){return!1},e.prototype.hasActiveCollision=function(v){return!1},e.prototype.disengageActiveCollision=function(v){},e.prototype.engageCollision=function(v){},e.prototype.isDebugging=function(){return!1},e}(Ct),St=function(){function t(v,S){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,xt.createAndAddToEngine(),this.shape=v,this.layer=S&&S.layer?S.layer:0,this.triggeredByLayer=S&&S.triggeredByLayer?S.triggeredByLayer:0,this.onTriggerEnter=S&&S.onTriggerEnter?S.onTriggerEnter:void 0,this.onTriggerExit=S&&S.onTriggerExit?S.onTriggerExit:void 0,this.onCameraEnter=S&&S.onCameraEnter?S.onCameraEnter:void 0,this.onCameraExit=S&&S.onCameraExit?S.onCameraExit:void 0,this._debugEnabled=!(!S||!S.enableDebug)&&S.enableDebug}return Object.defineProperty(t.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),o([Component("npcTriggerComponent")],t)}(),j=function(v,S){this.size=v,this.position=S},q=function(v,S){this.radius=v,this.position=S},At=function(){function e(S,A){void 0===A&&(A=v.NPCLerpType.SMOOTH_PATH),this.origin=0,this.target=1,this.fraction=0,this.totalDuration=0,this.speed=[],this.loop=!1,this.type=v.NPCLerpType.SMOOTH_PATH,this.path=S,void 0!==A&&(this.type=A),It.createAndAddToEngine()}return e.prototype.setIndex=function(v){this.fraction=0,this.origin=v,this.target=v+1<this.path.length?v+1:0},o([Component("npclerpData")],e)}(),_t=engine.getComponentGroup(At),It=function(){function e(){e._instance=this}return e.prototype.update=function(S){var A,E;try{for(var R=n(_t.entities),O=R.next();!O.done;O=R.next()){var M=O.value;if(M.state==v.NPCState.FOLLOWPATH){var B=M.getComponent(Transform),W=M.getComponent(At);if(void 0!==W.type&&W.type==v.NPCLerpType.RIGID_PATH)if(W.fraction<1)W.fraction+=S*W.speed[W.origin],B.position=Vector3.Lerp(W.path[W.origin],W.path[W.target],W.fraction);else{if(W.origin=W.target,W.target+=1,W.target>=W.path.length){if(!W.loop)return M.stopWalking(),W.onFinishCallback&&W.onFinishCallback(),void(W.fraction=1);W.target=0}else W.onReachedPointCallback&&W.onReachedPointCallback();W.fraction=0,B.lookAt(W.path[W.target])}else if(W.fraction+=S*W.speed[W.origin],W.fraction>=1){W.origin=W.target;var H=Math.max(1,Math.floor(W.fraction));if(W.target+=H,W.target>=W.path.length){if(!W.loop)return M.stopWalking(),W.onFinishCallback&&W.onFinishCallback(),void(W.fraction=1);W.target=0}else W.onReachedPointCallback&&W.onReachedPointCallback();W.fraction-=H,W.target<W.path.length&&B.lookAt(W.path[W.target])}W.target<W.path.length&&(B.position=Vector3.Lerp(W.path[W.origin],W.path[W.target],W.fraction))}}}catch(v){A={error:v}}finally{try{O&&!O.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}},e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e._instance=null,e}(),Rt=100,Pt=function(){function t(v,S,A){this.NPCScript=[],this.isBubleOpen=!1,this.activeTextId=0,this.defaultSound=null,this.baseYOffset=2.5,this.baseYOffset=S||2.5,this.rootEntity=new Entity,this.rootEntity.addComponent(new Billboard(!1,!0,!1)),this.rootEntity.addComponent(new Transform),this.rootEntity.setParent(v),this.container=new Entity,this.container.addComponent(new Transform({position:new Vector3(-.1,this.baseYOffset,0)})),this.container.setParent(this.rootEntity),this.material=new BasicMaterial,this.material.texture=Z,this.panel=new Entity,this.panel.addComponent(new Transform({scale:new Vector3(2,1,1)})),this.panel.setParent(this.container),this.panel.addComponent(new PlaneShape),this.panel.addComponent(this.material),this.panel.getComponent(PlaneShape).visible=!1,T(this.panel.getComponent(PlaneShape),J.bubbles.normal,1024,1024),this.text=new Entity,this.text.addComponent(new Transform({position:new Vector3(0,0,.05),rotation:Quaternion.Euler(0,180,0)})),this.text.addComponent(new TextShape("")),this.text.setParent(this.container),this.text.getComponent(TextShape).textWrapping=!0,this.text.getComponent(TextShape).font=V,this.text.getComponent(TextShape).hTextAlign="center",this.text.getComponent(TextShape).vTextAlign="center",this.text.getComponent(TextShape).fontSize=1,this.text.getComponent(TextShape).color=Color3.Black(),this.text.getComponent(TextShape).visible=!1,this.soundEnt=new Entity,A&&(this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(this.container),this.soundEnt.addComponent(new AudioSource(new AudioClip(A))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=A),Ot.createAndAddToEngine()}return t.prototype.openDialogWindow=function(v,S){this.NPCScript=v,this.activeTextId=S?"number"==typeof S?S:function(v,S){for(var A=0;A<v.length;A++)if(v[A].name&&v[A].name==S)return A;return 0}(v,S):0;var A=v[this.activeTextId]?v[this.activeTextId]:{text:""};A.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(A.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),this.text.getComponent(TextShape).fontSize=A.fontSize?A.fontSize:1,this.text.getComponent(Transform).position.y=A.offsetY?A.offsetY+0:0,this.text.getComponent(Transform).position.x=A.offsetX?A.offsetX:0,this.text.getComponent(TextShape).visible=!0,this.panel.getComponent(PlaneShape).visible=!0,this.text.getComponent(TextShape).value="",A.text.length<Rt&&A.text.slice(0,Rt),Ot._instance.newText(this,A.text,this.activeTextId,A.timeOn?A.timeOn:void 0,A.typeSpeed?A.typeSpeed:void 0),this.adjustBubble(A.text.length),this.layoutDialogWindow(this.activeTextId),this.isBubleOpen=!0},t.prototype.adjustBubble=function(v){v<8?(T(this.panel.getComponent(PlaneShape),J.bubbles.short,1024,1024),this.panel.getComponent(Transform).scale.x=.58,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.1,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=.7):v<25?(T(this.panel.getComponent(PlaneShape),J.bubbles.normal,1024,1024),this.panel.getComponent(Transform).scale.x=1.43,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.5,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=1.5):v<50?(T(this.panel.getComponent(PlaneShape),J.bubbles.long,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=.765,this.container.getComponent(Transform).position.y=this.baseYOffset+0,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2):(T(this.panel.getComponent(PlaneShape),J.bubbles.huge,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=1.195,this.container.getComponent(Transform).position.y=this.baseYOffset+.2,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2)},t.prototype.next=function(){var v=this.NPCScript[this.activeTextId];v||(v=this.NPCScript[this.activeTextId-1]),v.triggeredByNext&&v.triggeredByNext(),v.isEndOfDialog?this.closeDialogWindow():(this.activeTextId++,(v=this.NPCScript[this.activeTextId]).text.length<Rt&&v.text.slice(0,Rt),this.text.getComponent(TextShape).value="",this.adjustBubble(v.text.length),Ot._instance.newText(this,v.text,this.activeTextId,v.timeOn?v.timeOn:void 0,v.typeSpeed?v.typeSpeed:void 0),this.layoutDialogWindow(this.activeTextId))},t.prototype.layoutDialogWindow=function(v){var S=this.NPCScript[v]?this.NPCScript[v]:{text:""},A=S.offsetY?S.offsetY+0:0;S.buttons&&S.buttons.length>=3?A+=50:S.buttons&&S.buttons.length>=1&&(A+=24),this.text.getComponent(TextShape).fontSize=S.fontSize?S.fontSize:1,this.text.getComponent(TextShape).visible=!0,this.text.getComponent(Transform).position.y=A,S.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(S.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce())},t.prototype.closeDialogWindow=function(){this.isBubleOpen&&(this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1)},t.prototype.closeDialogEndAll=function(){this.isBubleOpen&&(Ot._instance.Dialog==this&&(Ot._instance.done=!0,Ot._instance.Dialog=null),this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1)},t.prototype.skipDialogs=function(){if(this.isBubleOpen)for(;this.NPCScript[this.activeTextId];){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}},t}(),Ot=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.Text=null,this.textId=0,this.done=!0,this.showing=!1,this.timeOn=3,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){if(!this.done)if(this.timer+=v,this.showing)this.timer>this.timeOn&&(this.showing=!1,this.done=!0,this.timer=0,this.window.next());else if(this.timer>=2/this.speed){var S=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=S,this.closeTag(S),this.visibleChars>=this.fullText.length&&(this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length),this.Text&&(this.Text.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(v,S,A,E,R){if(v!=this.Dialog||A!=this.textId){var O=this.Dialog;this.Dialog=v,this.Text=this.Dialog.text.getComponent(TextShape),this.textId=A,O&&v!=O&&O.skipDialogs(),this.timer=0,this.done=!1,this.showing=!1,this.fullText=S,this.visibleChars=0,this.window=v,R&&R<=0?this.rush():this.speed=R||45,this.timeOn=E||3}},t.prototype.rush=function(){this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length,this.Text&&(this.Text.value=this.fullText)},t.prototype.closeTag=function(v){if(0!=this.visibleChars&&0!=v){for(var S=!1,A=!1,E=this.visibleChars-v;E<this.visibleChars;E++)S?">"==this.fullText.substr(E,1)&&(A=!0):"<"==this.fullText.substr(E,1)&&(S=!0);if(S&&!A)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),Nt=function(A){function o(E,R,O,M){var B=A.call(this)||this;B.introduced=!1,B.onWalkAway=null,B.inCooldown=!1,B.coolDownDuration=5,B.faceUser=!1,B.walkingAnim=null,B.walkingSpeed=2,B.bubbleHeight=2,B.addComponent(new GLTFShape(R)),B.addComponent(new Transform(E)),engine.addEntity(B),B.state=v.NPCState.STANDING,M&&M.noUI||(M&&M.portrait?B.dialog=new ft("string"==typeof M.portrait?{path:M.portrait}:M.portrait,!(!M||!M.darkUI)&&M.darkUI,M.dialogSound?M.dialogSound:void 0,M&&M.dialogCustomTheme?M.dialogCustomTheme:void 0):B.dialog=new ft(void 0,!(!M||!M.darkUI)&&M.darkUI,M&&M.dialogSound?M.dialogSound:void 0,M&&M.dialogCustomTheme?M.dialogCustomTheme:void 0)),M&&M.textBubble&&(M&&M.bubbleHeight&&(B.bubbleHeight=M.bubbleHeight),B.bubble=new Pt(B,B.bubbleHeight,M.dialogSound?M.dialogSound:void 0)),B.addComponent(new Animator),B.idleAnim=new AnimationState(M&&M.idleAnim?M.idleAnim:"Idle",{looping:!0}),B.getComponent(Animator).addClip(B.idleAnim),B.lastPlayedAnim=B.idleAnim,B.idleAnim.play(),M&&M.walkingAnim&&(B.walkingAnim=new AnimationState(M.walkingAnim,{looping:!0}),B.getComponent(Animator).addClip(B.walkingAnim)),B.onActivate=O,M&&M.onWalkAway&&(B.onWalkAway=M.onWalkAway),B.endAnimTimer=new Entity,engine.addEntity(B.endAnimTimer),B.closeDialogTimer=new Entity,engine.addEntity(B.closeDialogTimer),B.pauseWalkingTimer=new Entity,engine.addEntity(B.pauseWalkingTimer);var W=M&&M.onlyClickTrigger?ActionButton.POINTER:ActionButton.PRIMARY;B.addComponent(new OnPointerDown((function(v){B.inCooldown||B.dialog&&B.dialog.isDialogOpen||B.activate()}),{button:W,hoverText:M&&M.hoverText?M.hoverText:"Talk",showFeedback:!M||!M.onlyExternalTrigger})),M&&M.onlyExternalTrigger&&B.removeComponent(OnPointerDown);var H={};return(!M||M&&!M.continueOnWalkAway)&&(H.onCameraExit=function(){B.handleWalkAway()}),M&&(!M||M.onlyExternalTrigger||M.onlyClickTrigger||M.onlyETrigger)||(H.onCameraEnter=function(){B.inCooldown?log(B.name," in cooldown"):B.dialog&&B.dialog.isDialogOpen||M&&M.onlyExternalTrigger||M&&M.onlyClickTrigger||B.activate()}),(H.onCameraEnter||H.onCameraExit)&&B.addComponent(new St(new q(M&&M.reactDistance?M.reactDistance:6,Vector3.Zero()),H)),M&&M.faceUser&&(B.addComponent(new S(!0,M.turningSpeed?M.turningSpeed:void 0)),B.faceUser=!0),M&&M.walkingSpeed&&(B.walkingSpeed=M.walkingSpeed),M&&M.coolDownDuration&&(B.coolDownDuration=M.coolDownDuration),M&&M.path&&(B.addComponent(new At(M.path?M.path:[],M.pathLerpType)),B.getComponent(At).loop=!0,B.followPath()),B}return i(o,A),o.prototype.activate=function(){var v=this;this.faceUser&&(this.getComponent(S).active=!0),this.inCooldown=!0,this.addComponentOrReplace(new $(this.coolDownDuration,(function(){v.inCooldown=!1}))),this.onActivate()},o.prototype.endInteraction=function(){this.faceUser&&(this.getComponent(S).active=!1),this.dialog&&this.dialog.isDialogOpen&&this.dialog.closeDialogWindow(),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.state=v.NPCState.STANDING},o.prototype.handleWalkAway=function(){this.state!=v.NPCState.FOLLOWPATH&&(this.endInteraction(),this.onWalkAway&&this.onWalkAway())},o.prototype.talk=function(S,A,E){var R=this;this.introduced=!0,this.state=v.NPCState.TALKING,this.closeDialogTimer.hasComponent($)&&this.closeDialogTimer.removeComponent($),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.dialog.openDialogWindow(S,A||0),E&&this.closeDialogTimer.addComponentOrReplace(new $(E,(function(){R.dialog.closeDialogWindow()})))},o.prototype.talkBubble=function(v,S){this.bubble||(this.bubble=new Pt(this,this.bubbleHeight)),this.bubble.openDialogWindow(v,S||0)},o.prototype.playAnimation=function(v,S,A){var E=this;this.endAnimTimer.hasComponent($)&&this.endAnimTimer.removeComponent($);var R=this.getComponent(Animator).getClip(v);S&&(R.looping=!1,A&&this.endAnimTimer.addComponentOrReplace(new $(A,(function(){R.stop(),E.idleAnim&&(E.idleAnim.play(),E.lastPlayedAnim=E.idleAnim)})))),R.play(!0),this.lastPlayedAnim=R},o.prototype.changeIdleAnim=function(v,S){this.idleAnim=new AnimationState(v,{looping:!0}),this.getComponent(Animator).addClip(this.idleAnim),S&&(this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim)},o.prototype.followPath=function(A){if(!this.hasComponent(At)){if(!A)return;this.addComponent(new At(A.path?A.path:[],A.pathLerpType))}this.faceUser&&(this.getComponent(S).active=!1);var E=this.getComponent(At);if(A){if(A.path)if(A.curve){var R=Curve3.CreateCatmullRomSpline(A.path,4*A.path.length,!!A.loop).getPoints();A.loop&&R.pop(),E.path=R}else E.path=A.path;null!=A.loop&&(E.loop=A.loop),null!=A.startingPoint&&E.setIndex(A.startingPoint),A.onFinishCallback&&(E.onFinishCallback=A.onFinishCallback),A.onReachedPointCallback&&(E.onReachedPointCallback=A.onReachedPointCallback)}var O=this.getComponent(Transform),M=O.position,B=E.path[E.origin];void 0===B&&log("WARNING npc.utils lerpOriginPath is null",B,E.origin,E.target,E.path),(0==E.fraction&&B.subtract(M).lengthSquared()>.1||E.fraction>0&&M.subtract(B).normalize()==E.path[E.target].subtract(B).normalize())&&(E.path.splice(E.origin,0,M),E.fraction=0),void 0===E.path[E.target]&&log("npc.utils lerp.path[lerp.target] is null",B,E.origin,E.target,E.path),O.lookAt(E.path[E.target]);for(var W=0,H=[],V=0;V<E.path.length-1;V++){var X;W+=X=Vector3.Distance(E.path[V],E.path[V+1]),H.push(X)}for(E.loop&&(W+=X=Vector3.Distance(E.path[E.path.length-1],E.path[0]),H.push(X)),A&&A.totalDuration?E.totalDuration=A.totalDuration:A&&A.speed?E.totalDuration=W/A.speed:E.totalDuration||(E.totalDuration=W/this.walkingSpeed),E.speed=[],V=0;V<H.length;V++)E.speed.push(1/(H[V]/W*E.totalDuration));this.walkingAnim&&(this.endAnimTimer.hasComponent($)&&this.endAnimTimer.removeComponent($),this.walkingAnim.play(),this.lastPlayedAnim=this.walkingAnim),this.state=v.NPCState.FOLLOWPATH},o.prototype.stopWalking=function(S){var A=this;this.state=v.NPCState.STANDING,this.walkingAnim&&(this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim),S&&this.pauseWalkingTimer.addComponentOrReplace(new $(S,(function(){A.dialog&&A.dialog.isDialogOpen||(A.lastPlayedAnim.stop(),A.walkingAnim&&(A.walkingAnim.play(),A.lastPlayedAnim=A.walkingAnim),A.endAnimTimer.hasComponent($)&&A.endAnimTimer.removeComponent($),A.state=v.NPCState.FOLLOWPATH)})))},o}(Entity);v.CustomDialogButton=bt,v.DialogTypeInSystem=vt,v.DialogWindow=ft,v.NPC=Nt,v.NPCDelay=$,v.NPCLerpData=At,v.NPCTriggerComponent=St,v.SFFont=H,v.SFHeavyFont=V,v.TrackUserFlag=S,v.TriggerBoxShape=j,v.TriggerSphereShape=q,v.canvas=O,v.darkTheme=Q,v.lightTheme=X,Object.defineProperty(v,"__esModule",{value:!0})}));var __awaiter=this&&this.__awaiter||function(v,S,A,E){return new(A||(A=Promise))((function(R,O){function fulfilled(v){try{step(E.next(v))}catch(v){O(v)}}function rejected(v){try{step(E.throw(v))}catch(v){O(v)}}function step(v){var S;v.done?R(v.value):(S=v.value,S instanceof A?S:new A((function(v){v(S)}))).then(fulfilled,rejected)}step((E=E.apply(v,S||[])).next())}))},__generator=this&&this.__generator||function(v,S){var A,E,R,O,M={label:0,sent:function(){if(1&R[0])throw R[1];return R[1]},trys:[],ops:[]};return O={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function verb(B){return function(W){return function(B){if(A)throw new TypeError("Generator is already executing.");for(;O&&(O=0,B[0]&&(M=0)),M;)try{if(A=1,E&&(R=2&B[0]?E.return:B[0]?E.throw||((R=E.return)&&R.call(E),0):E.next)&&!(R=R.call(E,B[1])).done)return R;switch(E=0,R&&(B=[2&B[0],R.value]),B[0]){case 0:case 1:R=B;break;case 4:return M.label++,{value:B[1],done:!1};case 5:M.label++,E=B[1],B=[0];continue;case 7:B=M.ops.pop(),M.trys.pop();continue;default:if(!((R=(R=M.trys).length>0&&R[R.length-1])||6!==B[0]&&2!==B[0])){M=0;continue}if(3===B[0]&&(!R||B[1]>R[0]&&B[1]<R[3])){M.label=B[1];break}if(6===B[0]&&M.label<R[1]){M.label=R[1],R=B;break}if(R&&M.label<R[2]){M.label=R[2],M.ops.push(B);break}R[2]&&M.ops.pop(),M.trys.pop();continue}B=S.call(v,M)}catch(v){B=[6,v],E=0}finally{A=R=0}if(5&B[0])throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}([B,W])}}};define("modules3",["require","exports","@decentraland/RestrictedActions"],(function(v,S,A){Object.defineProperty(S,"__esModule",{value:!0}),S.createscreen=S.createdancearea=void 0;var E=5;S.createdancearea=function(v){var S=function(){function avataremoteSystem(){}return avataremoteSystem.prototype.update=function(S){return __awaiter(this,void 0,void 0,(function(){var R,O;return __generator(this,(function(M){if((E-=S)<=0)if(E=12,R=Camera.instance.position,log(R),R.x>v[0][0]&&R.x<v[1][0]&&R.y>v[0][1]&&R.y<v[1][1]&&R.z>v[0][2]&&R.z<v[1][2])try{O=Math.floor(5*Math.random()),(0,A.triggerEmote)({predefined:(B=O,0==B?"tektonik":1==B?"robot":2==B?"disco":3==B?"dab":4==B?"handsair":"tektonik")}),E=function(v){return 0==v||1==v||2==v?11:3==v?2:4==v?6:11}(O)}catch(v){}else E=8;var B;return[2]}))}))},avataremoteSystem}();engine.addSystem(new S)},S.createscreen=function(v,S,A,E,R,O){var M=new VideoClip(S),B=new VideoTexture(M),W=new Material;W.albedoTexture=B,W.roughness=1,W.specularIntensity=0,W.metallic=0;var H=new Entity;return H.addComponent(new PlaneShape),H.addComponent(new Transform({position:v,scale:new Vector3(E*R,R,.02),rotation:Quaternion.Euler(0,A,0)})),H.addComponent(W),B.volume=O,B.play(),H}})),define("resources",["require","exports"],(function(v,S){Object.defineProperty(S,"__esModule",{value:!0}),S.default={sounds:{alice:new AudioClip("sounds/alice.mp3")},models:{standard:{},robots:{alice:"models/robots/alice.glb",rings:new GLTFShape("models/robots/rings.glb")}},textures:{blank:new Texture("images/ui/blank.png"),buttonE:new Texture("images/ui/buttonE.png"),buttonF:new Texture("images/ui/buttonF.png"),leftClickIcon:new Texture("images/ui/leftClickIcon.png"),textPanel:new Texture("images/ui/textPanel.png")}}})),define("game",["require","exports","modules3","resources","@dcl/npc-scene-utils","@dcl/ecs-scene-utils"],(function(v,S,A,E,R,O){Object.defineProperty(S,"__esModule",{value:!0}),S.Alice=S.AliceDialog=void 0;var M=new Entity("_scene");engine.addEntity(M);var B=new Transform({position:new Vector3(0,0,0),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});M.addComponentOrReplace(B);var W=(0,A.createscreen)(new Vector3(16,8,1.7),"",0,16/9,7,1);W.setParent(M),engine.addEntity(W),(0,A.createdancearea)([[12.11,3,9.15],[19.78,20,13.48]]),S.AliceDialog=[{text:"First Line Here"},{text:"Second Line Here"},{text:"Third Line Here"},{text:"Fourth Line Here",isEndOfDialog:!0,triggeredByNext:function(){S.Alice.playAnimation("Goodbye",!0,2)}}],S.Alice=new R.NPC({position:new Vector3(24.96,.91,14.23),rotation:Quaternion.Euler(0,0,0)},E.default.models.robots.alice,(function(){S.Alice.playAnimation("Hello",!0,2);var v=new Entity;v.addComponent(new R.NPCDelay(2,(function(){S.Alice.playAnimation("Talk")}))),engine.addEntity(v),S.Alice.addComponentOrReplace(new AudioSource(E.default.sounds.alice)),S.Alice.getComponent(AudioSource).playOnce(),S.Alice.talk(S.AliceDialog)}),{faceUser:!0,reactDistance:3,coolDownDuration:3,portrait:{path:"images/portraits/alice.png",height:256,width:256,section:{sourceHeight:512,sourceWidth:512}},onWalkAway:function(){S.Alice.playAnimation("Goodbye",!0,2),(0,O.setTimeout)(2e3,(function(){}))}});var H=E.default.models.robots.rings,V=new Entity;V.addComponent(H),V.addComponent(new Transform({position:new Vector3(0,-.65,0)})),V.setParent(S.Alice),(0,O.setTimeout)(1e3,(function(){}));var X=new Entity("Building");X.setParent(M),X.addComponent(new GLTFShape("Models/Stage 1 Final.glb")),X.addComponent(new Transform({position:new Vector3(16,0,8),rotation:Quaternion.Euler(0,0,0),scale:new Vector3(1,1,1)})),engine.addEntity(X);var Q=new Entity("Building");Q.setParent(M),Q.addComponent(new GLTFShape("Models/Lights.glb")),Q.addComponent(new Transform({position:new Vector3(16,0,8),rotation:Quaternion.Euler(0,0,0),scale:new Vector3(1,1,1)})),engine.addEntity(Q)}));